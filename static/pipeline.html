<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL-Agent Pipeline Flow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            padding: 40px 20px;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 60px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            font-size: 4em;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 3px 3px 8px rgba(0,0,0,0.5);
            background: linear-gradient(45deg, #fff, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1.4em;
            opacity: 0.95;
            font-weight: 300;
            line-height: 1.6;
        }

        .controls {
            text-align: center;
            margin-bottom: 40px;
        }

        .btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 30px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b, #475569);
        }

        .pipeline-container {
            max-width: 1800px;
            margin: 0 auto;
            position: relative;
        }

        .connection-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 6px;
            background: rgba(100, 116, 139, 0.3);
            transform: translateX(-50%);
            z-index: 0;
        }

        .data-packet {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.8);
            animation: flowDown 8s linear infinite;
            z-index: 1;
        }

        @keyframes flowDown {
            0% {
                top: 0;
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                top: 100%;
                opacity: 0;
            }
        }

        .pipeline-step {
            position: relative;
            margin-bottom: 100px;
            animation: fadeInUp 1s ease-out backwards;
            z-index: 2;
        }

        .step-wrapper {
            display: grid;
            grid-template-columns: 1fr 120px 1fr;
            gap: 40px;
            align-items: start;
        }

        .step-card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 28px;
            padding: 40px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .step-card:hover {
            transform: translateY(-10px) scale(1.01);
            box-shadow: 0 35px 90px rgba(0, 0, 0, 0.5);
        }

        .step-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #667eea);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 3px solid #e2e8f0;
        }

        .step-number {
            width: 85px;
            height: 85px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: bold;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
            flex-shrink: 0;
            position: relative;
        }

        .step-number::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid rgba(102, 126, 234, 0.5);
            animation: ripple 2s ease-out infinite;
        }

        .card-title h2 {
            font-size: 2.2em;
            color: #1e293b;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .card-title p {
            color: #64748b;
            font-size: 1.1em;
            line-height: 1.5;
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #334155;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 1.5em;
        }

        .data-flow {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 18px;
            padding: 25px;
            border: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .data-sample {
            background: #0f172a;
            border-radius: 14px;
            padding: 22px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #e2e8f0;
            line-height: 1.8;
            overflow-x: auto;
            box-shadow: inset 0 4px 12px rgba(0,0,0,0.4);
            border: 1px solid #1e293b;
        }

        .json-key { color: #60a5fa; font-weight: 600; }
        .json-string { color: #34d399; }
        .json-number { color: #f472b6; }
        .json-bool { color: #fbbf24; }
        .json-comment { color: #94a3b8; font-style: italic; }

        .center-connector {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .center-icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #fff, #f8fafc);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            position: relative;
            animation: pulse 2s ease-in-out infinite;
        }

        .center-icon::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid rgba(102, 126, 234, 0.5);
            animation: ripple 2s ease-out infinite;
        }

        .connector-label {
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 24px;
            border-radius: 20px;
            font-weight: 600;
            color: #334155;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            font-size: 0.95em;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 18px;
        }

        .metric {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            transition: transform 0.3s ease;
        }

        .metric:hover {
            transform: translateY(-5px);
        }

        .metric-value {
            font-size: 2.8em;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .metric-label {
            font-size: 0.95em;
            opacity: 0.95;
            font-weight: 500;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .feature-item {
            background: linear-gradient(135deg, #f0f9ff, #e0e7ff);
            padding: 18px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            transform: translateX(8px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .feature-icon {
            font-size: 1.8em;
            flex-shrink: 0;
        }

        .feature-text {
            font-size: 1em;
            color: #334155;
            font-weight: 600;
        }

        .feature-desc {
            font-size: 0.85em;
            color: #64748b;
            margin-top: 4px;
        }

        .timeline-badge {
            display: inline-block;
            padding: 8px 18px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 25px;
            font-size: 0.85em;
            font-weight: 700;
            margin-left: 12px;
            box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 6px 18px rgba(245, 158, 11, 0.4);
        }

        .badge-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 6px 18px rgba(59, 130, 246, 0.4);
        }

        .badge-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 6px 18px rgba(239, 68, 68, 0.4);
        }

        .process-flow {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 2px solid #fbbf24;
            border-radius: 14px;
            padding: 20px;
            margin-top: 15px;
        }

        .process-step {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
            font-size: 0.95em;
        }

        .process-step:last-child {
            margin-bottom: 0;
        }

        .process-number {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
        }

        .process-text {
            color: #78350f;
            font-weight: 600;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .tech-badge {
            background: linear-gradient(135deg, #1e293b, #334155);
            color: #e2e8f0;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .details-box {
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }

        .details-title {
            font-weight: 700;
            color: #475569;
            margin-bottom: 12px;
            font-size: 1.05em;
        }

        .details-list {
            list-style: none;
            padding: 0;
        }

        .details-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            color: #64748b;
            font-size: 0.95em;
        }

        .details-list li:last-child {
            border-bottom: none;
        }

        .details-list li::before {
            content: '‚ñ∏';
            color: #667eea;
            font-weight: bold;
            margin-right: 10px;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.08);
            }
        }

        @keyframes ripple {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.6);
                opacity: 0;
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-60px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(60px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .highlight {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            padding: 3px 8px;
            border-radius: 6px;
            font-weight: 600;
            color: #78350f;
        }

        @media (max-width: 1400px) {
            .step-wrapper {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .center-connector {
                order: 2;
                margin: 20px 0;
            }

            .connection-line {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }

            .step-card {
                padding: 25px;
            }

            .card-title h2 {
                font-size: 1.6em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ SQL-Agent Complete Pipeline</h1>
        <p class="subtitle">–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç API –∑–∞–ø—Ä–æ—Å–∞ –¥–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞<br>
        <span style="font-size: 0.9em; opacity: 0.8;">–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥: LLM Analysis + –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL + SQLglot –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</span></p>
    </div>

    <div class="controls">
        <button class="btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚Üë –í –Ω–∞—á–∞–ª–æ</button>
        <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
    </div>

    <div class="pipeline-container">
        <div class="connection-line">
            <div class="data-packet" style="animation-delay: 0s"></div>
            <div class="data-packet" style="animation-delay: 2s"></div>
            <div class="data-packet" style="animation-delay: 4s"></div>
            <div class="data-packet" style="animation-delay: 6s"></div>
        </div>

        <!-- STEP 1: API REQUEST -->
        <div class="pipeline-step" style="animation-delay: 0.1s">
            <div class="step-wrapper">
                <!-- Left: Input -->
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">1</div>
                        <div class="card-title">
                            <h2>üì® API Request</h2>
                            <p>POST /new - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üì•</span>
                            –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (OptimizationRequest)
                        </div>
                        <div class="data-sample">
{
  <span class="json-key">"url"</span>: <span class="json-string">"jdbc:trino://localhost:8080?catalog=hive"</span>,
  <span class="json-key">"ddl"</span>: [
    {
      <span class="json-key">"statement"</span>: <span class="json-string">"CREATE TABLE hive.public.users (
        user_id BIGINT,
        username VARCHAR,
        email VARCHAR,
        created_at TIMESTAMP,
        status VARCHAR
      )"</span>
    },
    {
      <span class="json-key">"statement"</span>: <span class="json-string">"CREATE TABLE hive.public.orders (...)"</span>
    }
  ],
  <span class="json-key">"queries"</span>: [
    {
      <span class="json-key">"queryid"</span>: <span class="json-string">"q1"</span>,
      <span class="json-key">"query"</span>: <span class="json-string">"SELECT * FROM users WHERE created_at > '2024-01-01'"</span>,
      <span class="json-key">"runquantity"</span>: <span class="json-number">1000</span>
    }
  ]
}
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">‚úÖ</span>
                            –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
                        </div>
                        <div class="features-grid">
                            <div class="feature-item">
                                <div class="feature-icon">üîí</div>
                                <div>
                                    <div class="feature-text">JDBC URL –ø—Ä–æ–≤–µ—Ä–∫–∞</div>
                                    <div class="feature-desc">–§–æ—Ä–º–∞—Ç: jdbc:trino://...</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üìã</div>
                                <div>
                                    <div class="feature-text">DDL —Å—Ç—Ä—É–∫—Ç—É—Ä–∞</div>
                                    <div class="feature-desc">–ù–∞–ª–∏—á–∏–µ –ø–æ–ª—è "statement"</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üîç</div>
                                <div>
                                    <div class="feature-text">Queries –≤–∞–ª–∏–¥–∞—Ü–∏—è</div>
                                    <div class="feature-desc">queryid, query, runquantity</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="details-box">
                        <div class="details-title">üìä –ú–æ–¥–µ–ª—å Pydantic</div>
                        <ul class="details-list">
                            <li><strong>url:</strong> str (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "jdbc:")</li>
                            <li><strong>ddl:</strong> List[Dict[str, str]] (–Ω–µ –ø—É—Å—Ç–æ)</li>
                            <li><strong>queries:</strong> List[Dict[str, Any]] (–Ω–µ –ø—É—Å—Ç–æ)</li>
                        </ul>
                    </div>
                </div>

                <!-- Center: Connector -->
                <div class="center-connector">
                    <div class="center-icon">‚ö°</div>
                    <div class="connector-label">FastAPI</div>
                    <div class="connector-label">Async</div>
                </div>

                <!-- Right: Output -->
                <div class="step-card">
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üéØ</span>
                            –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                        </div>
                        <div class="data-sample">
{
  <span class="json-key">"taskid"</span>: <span class="json-string">"a1b2c3d4-e5f6-7890-abcd-ef1234567890"</span>
}

<span class="json-comment">// HTTP Status: 202 Accepted</span>
<span class="json-comment">// Content-Type: application/json</span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">&lt;100ms</div>
                                <div class="metric-label">Response Time</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">202</div>
                                <div class="metric-label">HTTP Status</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">UUID</div>
                                <div class="metric-label">Task ID</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="tech-stack">
                            <div class="tech-badge">FastAPI</div>
                            <div class="tech-badge">Pydantic</div>
                            <div class="tech-badge">asyncio</div>
                            <div class="tech-badge">uvicorn</div>
                        </div>
                    </div>

                    <div class="process-flow">
                        <div class="process-step">
                            <div class="process-number">1</div>
                            <div class="process-text">–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">2</div>
                            <div class="process-text">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID –¥–ª—è –∑–∞–¥–∞—á–∏</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">3</div>
                            <div class="process-text">–°–æ–∑–¥–∞–Ω–∏–µ Task –æ–±—ä–µ–∫—Ç–∞</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">4</div>
                            <div class="process-text">–ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 2: TASK MANAGER -->
        <div class="pipeline-step" style="animation-delay: 0.2s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">2</div>
                        <div class="card-title">
                            <h2>‚öôÔ∏è Task Manager</h2>
                            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–¥–∞—á<span class="timeline-badge badge-danger">20 min timeout</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üîÑ</span>
                            –°–æ–∑–¥–∞–Ω–∏–µ Task –æ–±—ä–µ–∫—Ç–∞
                        </div>
                        <div class="data-sample">
<span class="json-comment"># task_manager.py</span>

task = Task(
  task_id=<span class="json-string">"a1b2c3d4-e5f6-7890-abcd-ef1234567890"</span>,
  status=TaskStatus.<span class="json-bool">RUNNING</span>,
  request=OptimizationRequest(...),
  result=<span class="json-bool">None</span>,
  error=<span class="json-bool">None</span>
)

<span class="json-comment"># –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏</span>
self.tasks[task.task_id] = task

<span class="json-comment"># –ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏</span>
<span class="json-key">asyncio.create_task</span>(
  self._process_task(task.task_id)
)
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">‚è±Ô∏è</span>
                            –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
                        </div>
                        <div class="data-sample">
<span class="json-key">await asyncio.wait_for</span>(
  self._execute_task(task_id),
  timeout=<span class="json-number">1200</span>  <span class="json-comment"># 20 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö</span>
)

<span class="json-comment"># –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ç–∞–π–º–∞—É—Ç–∞:</span>
<span class="json-key">except asyncio.TimeoutError:</span>
  task.status = TaskStatus.<span class="json-bool">FAILED</span>
  task.error = <span class="json-string">"Task timeout (20 min)"</span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="features-grid">
                            <div class="feature-item">
                                <div class="feature-icon">üîÑ</div>
                                <div>
                                    <div class="feature-text">–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</div>
                                    <div class="feature-desc">asyncio.create_task</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">‚è±Ô∏è</div>
                                <div>
                                    <div class="feature-text">–¢–∞–π–º–∞—É—Ç 20 –º–∏–Ω—É—Ç</div>
                                    <div class="feature-desc">–ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üë•</div>
                                <div>
                                    <div class="feature-text">Max 4 workers</div>
                                    <div class="feature-desc">–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üíæ</div>
                                <div>
                                    <div class="feature-text">In-memory storage</div>
                                    <div class="feature-desc">Dict[task_id, Task]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="center-connector">
                    <div class="center-icon">üîÑ</div>
                    <div class="connector-label">Async</div>
                    <div class="connector-label">20 min</div>
                </div>

                <div class="step-card">
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üìä</span>
                            –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
                        </div>
                        <div class="data-sample">
<span class="json-comment"># GET /status?task_id=a1b2c3d4...</span>

Response:
{
  <span class="json-key">"status"</span>: <span class="json-string">"RUNNING"</span>
}

<span class="json-comment"># –í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:</span>
- <span class="json-bool">RUNNING</span>  <span class="json-comment"># –ó–∞–¥–∞—á–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
- <span class="json-bool">DONE</span>     <span class="json-comment"># –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</span>
- <span class="json-bool">FAILED</span>   <span class="json-comment"># –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">3</div>
                                <div class="metric-label">–°—Ç–∞—Ç—É—Å–∞</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">‚àû</div>
                                <div class="metric-label">–ó–∞–¥–∞—á</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">4</div>
                                <div class="metric-label">Workers</div>
                            </div>
                        </div>
                    </div>

                    <div class="details-box">
                        <div class="details-title">üîß –ú–µ—Ç–æ–¥—ã Task Manager</div>
                        <ul class="details-list">
                            <li>create_task() - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏</li>
                            <li>get_task_status() - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞</li>
                            <li>get_task_result() - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</li>
                            <li>get_task_error() - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—à–∏–±–∫–∏</li>
                            <li>get_stats() - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–∞</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 3: DATABASE CONNECTION -->
        <div class="pipeline-step" style="animation-delay: 0.3s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">3</div>
                        <div class="card-title">
                            <h2>üóÑÔ∏è Database Connector</h2>
                            <p>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏ —Å–±–æ—Ä —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏<span class="timeline-badge badge-info">Real Data</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üîå</span>
                            –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                        </div>
                        <div class="data-sample">
<span class="json-comment"># db_connector.py</span>

db = DatabaseConnector(<span class="json-string">"jdbc:trino://localhost:8080?catalog=hive"</span>)

<span class="json-comment"># –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ë–î</span>
db_type = self._detect_db_type(jdbc_url)
<span class="json-comment"># –†–µ–∑—É–ª—å—Ç–∞—Ç: "trino" | "postgresql" | "mysql"</span>

<span class="json-comment"># –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –Ω—É–∂–Ω—ã–º –¥—Ä–∞–π–≤–µ—Ä–æ–º</span>
<span class="json-key">if</span> db_type == <span class="json-string">"trino"</span>:
    <span class="json-key">import</span> trino
    connection = trino.dbapi.connect(
        host=parsed[<span class="json-string">'host'</span>],
        port=parsed[<span class="json-string">'port'</span>],
        catalog=parsed[<span class="json-string">'catalog'</span>]
    )
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üìä</span>
                            –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–∞–±–ª–∏—Ü
                        </div>
                        <div class="data-sample">
<span class="json-comment"># –î–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏–∑ DDL:</span>

<span class="json-key">table_stats</span> = db.get_table_stats(<span class="json-string">"users"</span>, <span class="json-string">"public"</span>)

<span class="json-comment"># SQL –∑–∞–ø—Ä–æ—Å—ã:</span>
<span class="json-key">SELECT COUNT(*) FROM</span> hive.public.users
<span class="json-comment"># ‚Üí row_count: 1,500,000</span>

<span class="json-key">SELECT 
  SUM(compressed_size) as total_size,
  COUNT(DISTINCT partition_key) as partition_count
FROM</span> <span class="json-string">"hive$partitions"</span>
<span class="json-key">WHERE</span> table_name = <span class="json-string">'users'</span>
<span class="json-comment"># ‚Üí total_size: 524,288,000 bytes</span>
<span class="json-comment"># ‚Üí partition_count: 365</span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üî¢</span>
                            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–ª–æ–Ω–æ–∫
                        </div>
                        <div class="data-sample">
<span class="json-key">column_stats</span> = db.get_column_stats(<span class="json-string">"users"</span>, <span class="json-string">"public"</span>)

<span class="json-comment"># –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏:</span>
<span class="json-key">SELECT 
  COUNT(DISTINCT</span> user_id<span class="json-key">) as distinct_count,
  COUNT(*) - COUNT(</span>user_id<span class="json-key">) as null_count
FROM</span> hive.public.users

<span class="json-comment"># –†–µ–∑—É–ª—å—Ç–∞—Ç:</span>
{
  <span class="json-string">"user_id"</span>: {
    <span class="json-key">"distinct_count"</span>: <span class="json-number">1500000</span>,
    <span class="json-key">"null_count"</span>: <span class="json-number">0</span>,
    <span class="json-key">"cardinality"</span>: <span class="json-number">1500000</span>
  },
  <span class="json-string">"created_at"</span>: {
    <span class="json-key">"cardinality"</span>: <span class="json-number">365</span>
  }
}
                        </div>
                    </div>

                    <div class="section">
                        <div class="features-grid">
                            <div class="feature-item">
                                <div class="feature-icon">üéØ</div>
                                <div>
                                    <div class="feature-text">3 —Ç–∏–ø–∞ –ë–î</div>
                                    <div class="feature-desc">Trino, PostgreSQL, MySQL</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üìä</div>
                                <div>
                                    <div class="feature-text">Row count</div>
                                    <div class="feature-desc">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üíæ</div>
                                <div>
                                    <div class="feature-text">Size metrics</div>
                                    <div class="feature-desc">Compressed size –≤ –±–∞–π—Ç–∞—Ö</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üî¢</div>
                                <div>
                                    <div class="feature-text">Cardinality</div>
                                    <div class="feature-desc">–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üóÇÔ∏è</div>
                                <div>
                                    <div class="feature-text">Partitions</div>
                                    <div class="feature-desc">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">‚ö†Ô∏è</div>
                                <div>
                                    <div class="feature-text">Null handling</div>
                                    <div class="feature-desc">–ü–æ–¥—Å—á—ë—Ç NULL –∑–Ω–∞—á–µ–Ω–∏–π</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="center-connector">
                    <div class="center-icon">üì°</div>
                    <div class="connector-label">JDBC</div>
                    <div class="connector-label">Stats</div>
                </div>

                <div class="step-card">
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üìà</span>
                            –°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                        </div>
                        <div class="data-sample">
{
  <span class="json-string">"users"</span>: {
    <span class="json-key">"row_count"</span>: <span class="json-number">1500000</span>,
    <span class="json-key">"size_bytes"</span>: <span class="json-number">524288000</span>,
    <span class="json-key">"partition_count"</span>: <span class="json-number">365</span>,
    <span class="json-key">"avg_row_size"</span>: <span class="json-number">349</span>,
    <span class="json-key">"column_stats"</span>: {
      <span class="json-string">"user_id"</span>: {
        <span class="json-key">"cardinality"</span>: <span class="json-number">1500000</span>,
        <span class="json-key">"null_count"</span>: <span class="json-number">0</span>
      },
      <span class="json-string">"created_at"</span>: {
        <span class="json-key">"cardinality"</span>: <span class="json-number">365</span>,
        <span class="json-key">"null_count"</span>: <span class="json-number">0</span>
      },
      <span class="json-string">"email"</span>: {
        <span class="json-key">"cardinality"</span>: <span class="json-number">1498500</span>,
        <span class="json-key">"null_count"</span>: <span class="json-number">1500</span>
      }
    }
  }
}
                        </div>
                    </div>

                    <div class="section">
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">1.5M</div>
                                <div class="metric-label">–°—Ç—Ä–æ–∫</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">500MB</div>
                                <div class="metric-label">–†–∞–∑–º–µ—Ä</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">365</div>
                                <div class="metric-label">–ü–∞—Ä—Ç–∏—Ü–∏–π</div>
                            </div>
                        </div>
                    </div>

                    <div class="process-flow">
                        <div class="details-title" style="color: #78350f; margin-bottom: 15px;">
                            üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                        </div>
                        <div class="process-step">
                            <div class="process-number">1</div>
                            <div class="process-text">–í—ã–±–æ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ (high cardinality)</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">2</div>
                            <div class="process-text">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ (medium cardinality)</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">3</div>
                            <div class="process-text">–û—Ü–µ–Ω–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">4</div>
                            <div class="process-text">–í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 4: LLM ANALYSIS -->
        <div class="pipeline-step" style="animation-delay: 0.4s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">4</div>
                        <div class="card-title">
                            <h2>ü§ñ LLM Analyzer</h2>
                            <p>AI –∞–Ω–∞–ª–∏–∑ —Å—Ö–µ–º—ã –ë–î —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π<span class="timeline-badge">Hybrid AI</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üß†</span>
                            –ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ LLM
                        </div>
                        <div class="data-sample">
<span class="json-comment"># llm_analyzer.py</span>

<span class="json-key">Model:</span> nvidia/nemotron-nano-9b-v2
<span class="json-key">Provider:</span> OpenRouter

<span class="json-comment"># –ü—Ä–æ–º–ø—Ç –¥–ª—è LLM:</span>
<span class="json-string">"""
Analyze this table structure and suggest optimization:

Table: users
Row count: 1,500,000
Size: 524,288,000 bytes
Columns:
  - user_id (BIGINT): cardinality 1,500,000
  - username (VARCHAR): cardinality 1,498,000
  - email (VARCHAR): cardinality 1,498,500
  - created_at (TIMESTAMP): cardinality 365
  - status (VARCHAR): cardinality 5

Return JSON with optimization strategy.
"""</span>

<span class="json-comment"># LLM Response:</span>
{
  <span class="json-key">"table_name"</span>: <span class="json-string">"users"</span>,
  <span class="json-key">"partition_columns"</span>: [<span class="json-string">"created_at"</span>],
  <span class="json-key">"cluster_columns"</span>: [<span class="json-string">"user_id"</span>, <span class="json-string">"status"</span>],
  <span class="json-key">"compression"</span>: <span class="json-string">"ZSTD"</span>,
  <span class="json-key">"rationale"</span>: <span class="json-string">"created_at has 365 distinct values 
              (likely daily data) - good for partitioning.
              user_id is unique - excellent for clustering.
              status has low cardinality - good secondary cluster."</span>
}
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üîÑ</span>
                            –≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π Fallback
                        </div>
                        <div class="data-sample">
<span class="json-comment"># –ï—Å–ª–∏ LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞:</span>

<span class="json-key">def</span> _heuristic_analysis(table, columns, stats):
    partition_cols = []
    cluster_cols = []
    
    <span class="json-key">for</span> col_name, col_type <span class="json-key">in</span> columns:
        cardinality = stats[col_name][<span class="json-string">'cardinality'</span>]
        
        <span class="json-comment"># –ü–∞—Ä—Ç–∏—Ü–∏–∏: –¥–∞—Ç–∞ + high cardinality</span>
        <span class="json-key">if</span> <span class="json-string">'date'</span> <span class="json-key">in</span> col_name.lower():
            <span class="json-key">if</span> cardinality > <span class="json-number">10</span>:
                partition_cols.append(col_name)
        
        <span class="json-comment"># –ö–ª–∞—Å—Ç–µ—Ä—ã: ID, key + medium cardinality</span>
        <span class="json-key">if</span> <span class="json-string">'id'</span> <span class="json-key">in</span> col_name.lower():
            <span class="json-key">if</span> <span class="json-number">10</span> < cardinality < row_count * <span class="json-number">0.5</span>:
                cluster_cols.append(col_name)
    
    <span class="json-key">return</span> {
        <span class="json-string">"partition_columns"</span>: partition_cols[:2],
        <span class="json-string">"cluster_columns"</span>: cluster_cols[:4]
    }
                        </div>
                    </div>

                    <div class="section">
                        <div class="features-grid">
                            <div class="feature-item">
                                <div class="feature-icon">üéØ</div>
                                <div>
                                    <div class="feature-text">LLM –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</div>
                                    <div class="feature-desc">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üìä</div>
                                <div>
                                    <div class="feature-text">Real data stats</div>
                                    <div class="feature-desc">–£—á—ë—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üîÑ</div>
                                <div>
                                    <div class="feature-text">Smart fallback</div>
                                    <div class="feature-desc">–≠–≤—Ä–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">‚ö°</div>
                                <div>
                                    <div class="feature-text">Fast analysis</div>
                                    <div class="feature-desc">–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="details-box">
                        <div class="details-title">üé® –ü—Ä–∞–≤–∏–ª–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</div>
                        <ul class="details-list">
                            <li><strong>–ü–∞—Ä—Ç–∏—Ü–∏–∏:</strong> max 2 –∫–æ–ª–æ–Ω–∫–∏, high cardinality (>10)</li>
                            <li><strong>–ö–ª–∞—Å—Ç–µ—Ä—ã:</strong> max 4 –∫–æ–ª–æ–Ω–∫–∏, medium cardinality</li>
                            <li><strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</strong> timestamp > date > ID > status</li>
                            <li><strong>–ö–æ–º–ø—Ä–µ—Å—Å–∏—è:</strong> ZSTD –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü</li>
                        </ul>
                    </div>
                </div>

                <div class="center-connector">
                    <div class="center-icon">üß†</div>
                    <div class="connector-label">OpenAI</div>
                    <div class="connector-label">Strategy</div>
                </div>

                <div class="step-card">
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üìã</span>
                            –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
                        </div>
                        <div class="data-sample">
tables_analysis = [
  {
    <span class="json-key">"table_name"</span>: <span class="json-string">"users"</span>,
    <span class="json-key">"original_columns"</span>: [
      (<span class="json-string">"user_id"</span>, <span class="json-string">"BIGINT"</span>),
      (<span class="json-string">"username"</span>, <span class="json-string">"VARCHAR"</span>),
      (<span class="json-string">"email"</span>, <span class="json-string">"VARCHAR"</span>),
      (<span class="json-string">"created_at"</span>, <span class="json-string">"TIMESTAMP"</span>),
      (<span class="json-string">"status"</span>, <span class="json-string">"VARCHAR"</span>)
    ],
    <span class="json-key">"partition_columns"</span>: [<span class="json-string">"created_at"</span>],
    <span class="json-key">"cluster_columns"</span>: [<span class="json-string">"user_id"</span>, <span class="json-string">"status"</span>],
    <span class="json-key">"compression"</span>: <span class="json-string">"ZSTD"</span>
  }
]

<span class="json-comment"># –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä DDL</span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="tech-stack">
                            <div class="tech-badge">OpenRouter API</div>
                            <div class="tech-badge">nvidia/nemotron</div>
                            <div class="tech-badge">Temperature 0.1</div>
                            <div class="tech-badge">JSON Response</div>
                        </div>
                    </div>

                    <div class="process-flow">
                        <div class="details-title" style="color: #78350f; margin-bottom: 15px;">
                            üéØ –ü–æ—á–µ–º—É –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥?
                        </div>
                        <div class="process-step">
                            <div class="process-number">‚úì</div>
                            <div class="process-text">LLM –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –¥–∞—ë—Ç —É–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">‚úì</div>
                            <div class="process-text">–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">‚úì</div>
                            <div class="process-text">–≠–≤—Ä–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ API</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">‚úì</div>
                            <div class="process-text">–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É–ª—É—á—à–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 5: DDL GENERATION -->
        <div class="pipeline-step" style="animation-delay: 0.5s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">5</div>
                        <div class="card-title">
                            <h2>üìù DDL Generation</h2>
                            <p>–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ DDL<span class="timeline-badge badge-info">Template Based</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üèóÔ∏è</span>
                            –ì–µ–Ω–µ—Ä–∞—Ü–∏—è CREATE TABLE
                        </div>
                        <div class="data-sample">
<span class="json-comment"># _generate_ddl_deterministic()</span>

<span class="json-comment"># –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã</span>
ddl.append({
  <span class="json-string">"statement"</span>: <span class="json-string">f"CREATE SCHEMA IF NOT EXISTS 
              {catalog_name}.optimized"</span>
})

<span class="json-comment"># –®–∞–≥ 2: –î–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã</span>
<span class="json-key">for</span> analysis <span class="json-key">in</span> tables_analysis:
    table_name = analysis[<span class="json-string">"table_name"</span>]
    columns = analysis[<span class="json-string">"original_columns"</span>]
    
    <span class="json-comment"># –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–ª–æ–Ω–æ–∫</span>
    columns_sql = <span class="json-string">",\n  "</span>.join([
        <span class="json-string">f"{col[0]} {col[1]}"</span> <span class="json-key">for</span> col <span class="json-key">in</span> columns
    ])
    
    <span class="json-comment"># –ì–µ–Ω–µ—Ä–∞—Ü–∏—è WITH clause</span>
    with_clause = generate_with_clause(analysis)
    
    ddl_statement = <span class="json-string">f"""
CREATE TABLE {catalog_name}.optimized.{table_name} (
  {columns_sql}
) WITH (
  {with_clause}
)
"""</span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">‚öôÔ∏è</span>
                            WITH Clause –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                        </div>
                        <div class="data-sample">
with_parts = [
  <span class="json-string">"format = 'ICEBERG'"</span>,
  <span class="json-string">"'write.compression-codec' = 'ZSTD'"</span>,
  <span class="json-string">"'write.target-file-size-bytes' = '268435456'"</span>,
  <span class="json-string">"'read.vectorization.enabled' = 'true'"</span>,
  <span class="json-string">"'write.parquet.compression-codec' = 'ZSTD'"</span>,
  <span class="json-string">"'write.parquet.page-size-bytes' = '1048576'"</span>,
  <span class="json-string">"'write.parquet.row-group-size-bytes' = '134217728'"</span>
]

<span class="json-comment"># –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π –µ—Å–ª–∏ –µ—Å—Ç—å</span>
<span class="json-key">if</span> partition_cols:
    parts_str = <span class="json-string">", "</span>.join([<span class="json-string">f"'{c}'"</span> <span class="json-key">for</span> c <span class="json-key">in</span> partition_cols])
    with_parts.insert(<span class="json-number">1</span>, <span class="json-string">f"partitioning = ARRAY[{parts_str}]"</span>)

<span class="json-comment"># –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –µ—Å–ª–∏ –µ—Å—Ç—å</span>
<span class="json-key">if</span> cluster_cols:
    clusters_str = <span class="json-string">", "</span>.join([<span class="json-string">f"'{c}'"</span> <span class="json-key">for</span> c <span class="json-key">in</span> cluster_cols])
    with_parts.insert(<span class="json-number">2</span>, <span class="json-string">f"clustering = ARRAY[{clusters_str}]"</span>)
                        </div>
                    </div>

                    <div class="section">
                        <div class="features-grid">
                            <div class="feature-item">
                                <div class="feature-icon">üéØ</div>
                                <div>
                                    <div class="feature-text">–ü–æ–ª–Ω—ã–µ –ø—É—Ç–∏</div>
                                    <div class="feature-desc">catalog.optimized.table</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">‚ùÑÔ∏è</div>
                                <div>
                                    <div class="feature-text">Iceberg —Ñ–æ—Ä–º–∞—Ç</div>
                                    <div class="feature-desc">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π table format</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üì¶</div>
                                <div>
                                    <div class="feature-text">ZSTD –∫–æ–º–ø—Ä–µ—Å—Å–∏—è</div>
                                    <div class="feature-desc">–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–∂–∞—Ç–∏–µ</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">‚ö°</div>
                                <div>
                                    <div class="feature-text">–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</div>
                                    <div class="feature-desc">SIMD —É—Å–∫–æ—Ä–µ–Ω–∏–µ</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üìè</div>
                                <div>
                                    <div class="feature-text">File size control</div>
                                    <div class="feature-desc">256MB target —Ä–∞–∑–º–µ—Ä</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üîß</div>
                                <div>
                                    <div class="feature-text">Parquet –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</div>
                                    <div class="feature-desc">Page & row group sizes</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="center-connector">
                    <div class="center-icon">üî®</div>
                    <div class="connector-label">Template</div>
                    <div class="connector-label">Valid SQL</div>
                </div>

                <div class="step-card">
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">‚úÖ</span>
                            –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π DDL
                        </div>
                        <div class="data-sample">
<span class="json-comment">-- –°—Ö–µ–º–∞</span>
CREATE SCHEMA IF NOT EXISTS hive.optimized

<span class="json-comment">-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</span>
CREATE TABLE hive.optimized.users (
  user_id BIGINT,
  username VARCHAR,
  email VARCHAR,
  created_at TIMESTAMP,
  status VARCHAR
) WITH (
  format = 'ICEBERG',
  partitioning = ARRAY['created_at'],
  clustering = ARRAY['user_id', 'status'],
  'write.compression-codec' = 'ZSTD',
  'write.target-file-size-bytes' = '268435456',
  'read.vectorization.enabled' = 'true',
  'write.parquet.compression-codec' = 'ZSTD',
  'write.parquet.page-size-bytes' = '1048576',
  'write.parquet.row-group-size-bytes' = '134217728'
)
                        </div>
                    </div>

                    <div class="section">
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">100%</div>
                                <div class="metric-label">Valid SQL</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">8</div>
                                <div class="metric-label">Optimizations</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">ZSTD</div>
                                <div class="metric-label">Compression</div>
                            </div>
                        </div>
                    </div>

                    <div class="details-box">
                        <div class="details-title">üéØ –ü–æ—á–µ–º—É –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è?</div>
                        <ul class="details-list">
                            <li><strong>–ì–∞—Ä–∞–Ω—Ç–∏—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏:</strong> –®–∞–±–ª–æ–Ω—ã –Ω–µ –¥–µ–ª–∞—é—Ç –æ—à–∏–±–æ–∫</li>
                            <li><strong>–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞:</strong> –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞</li>
                            <li><strong>–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å:</strong> –û–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑</li>
                            <li><strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 6: MIGRATIONS -->
        <div class="pipeline-step" style="animation-delay: 0.6s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">6</div>
                        <div class="card-title">
                            <h2>üîÑ Migration Generation</h2>
                            <p>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö<span class="timeline-badge badge-warning">LLM Assist</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üì§</span>
                            LLM –ø—Ä–æ–º–ø—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
                        </div>
                        <div class="data-sample">
<span class="json-key">Model:</span> nvidia/nemotron-nano-9b-v2

<span class="json-key">Input:</span>
{
  <span class="json-string">"url"</span>: <span class="json-string">"jdbc:trino://localhost:8080?catalog=hive"</span>,
  <span class="json-string">"old_ddl"</span>: [
    {<span class="json-string">"statement"</span>: <span class="json-string">"CREATE TABLE hive.public.users (...)"</span>}
  ],
  <span class="json-string">"new_ddl"</span>: [
    {<span class="json-string">"statement"</span>: <span class="json-string">"CREATE TABLE hive.optimized.users (...)"</span>}
  ]
}

<span class="json-key">System Prompt:</span>
<span class="json-string">"Create comprehensive migration statements to transfer 
data from old DDL to new optimized structure.
Use full paths: catalog.optimized.table
Include validation queries."</span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üß†</span>
                            LLM Response
                        </div>
                        <div class="data-sample">
{
  <span class="json-key">"migrations"</span>: [
    {
      <span class="json-key">"statement"</span>: <span class="json-string">"INSERT INTO hive.optimized.users 
                  SELECT user_id, username, email, 
                         created_at, status 
                  FROM hive.public.users"</span>
    },
    {
      <span class="json-key">"statement"</span>: <span class="json-string">"SELECT COUNT(*) as validation_count 
                  FROM hive.optimized.users"</span>
    },
    {
      <span class="json-key">"statement"</span>: <span class="json-string">"SELECT 
                    old.cnt as old_count,
                    new.cnt as new_count,
                    CASE WHEN old.cnt = new.cnt 
                         THEN 'PASS' ELSE 'FAIL' END as status
                  FROM 
                    (SELECT COUNT(*) as cnt FROM hive.public.users) old,
                    (SELECT COUNT(*) as cnt FROM hive.optimized.users) new"</span>
    }
  ]
}
                        </div>
                    </div>

                    <div class="section">
                        <div class="features-grid">
                            <div class="feature-item">
                                <div class="feature-icon">üìã</div>
                                <div>
                                    <div class="feature-text">INSERT SELECT</div>
                                    <div class="feature-desc">–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">‚úÖ</div>
                                <div>
                                    <div class="feature-text">Validation</div>
                                    <div class="feature-desc">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üéØ</div>
                                <div>
                                    <div class="feature-text">Full paths</div>
                                    <div class="feature-desc">catalog.schema.table</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üîÑ</div>
                                <div>
                                    <div class="feature-text">All columns</div>
                                    <div class="feature-desc">–ë–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="center-connector">
                    <div class="center-icon">üîÑ</div>
                    <div class="connector-label">LLM</div>
                    <div class="connector-label">Migrate</div>
                </div>

                <div class="step-card">
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üìä</span>
                            –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
                        </div>
                        <div class="data-sample">
migrations = [
  {
    <span class="json-key">"statement"</span>: <span class="json-string">"INSERT INTO hive.optimized.users 
                SELECT * FROM hive.public.users"</span>
  },
  {
    <span class="json-key">"statement"</span>: <span class="json-string">"SELECT COUNT(*) FROM hive.optimized.users"</span>
  }
]
                        </div>
                    </div>

                    <div class="process-flow">
                        <div class="details-title" style="color: #78350f; margin-bottom: 15px;">
                            ‚öôÔ∏è –ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏
                        </div>
                        <div class="process-step">
                            <div class="process-number">1</div>
                            <div class="process-text">–°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (DDL)</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">2</div>
                            <div class="process-text">–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (INSERT SELECT)</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">3</div>
                            <div class="process-text">–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">4</div>
                            <div class="process-text">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ old vs new</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 7: QUERY OPTIMIZATION WITH SQLGLOT -->
        <div class="pipeline-step" style="animation-delay: 0.7s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">7</div>
                        <div class="card-title">
                            <h2>‚ö° Query Optimization</h2>
                            <p>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ SQLglot<span class="timeline-badge">Real SQL Changes</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üì•</span>
                            –ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å
                        </div>
                        <div class="data-sample">
{
  <span class="json-key">"queryid"</span>: <span class="json-string">"q1"</span>,
  <span class="json-key">"query"</span>: <span class="json-string">"SELECT * FROM hive.public.users 
            WHERE created_at > '2024-01-01' 
            JOIN orders ON users.id = orders.user_id"</span>,
  <span class="json-key">"runquantity"</span>: <span class="json-number">1000</span>
}
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üå≥</span>
                            SQLglot –ø–∞—Ä—Å–∏–Ω–≥ –≤ AST
                        </div>
                        <div class="data-sample">
<span class="json-key">import</span> sqlglot

<span class="json-comment"># –ü–∞—Ä—Å–∏–º SQL –≤ Abstract Syntax Tree</span>
parsed = sqlglot.parse_one(query, dialect=<span class="json-string">"trino"</span>)

<span class="json-comment"># –°—Ç—Ä—É–∫—Ç—É—Ä–∞ AST:</span>
Select
‚îú‚îÄ‚îÄ expressions: [Star(*)]
‚îú‚îÄ‚îÄ from: From
‚îÇ   ‚îî‚îÄ‚îÄ this: Table(hive.public.users)
‚îú‚îÄ‚îÄ where: Where
‚îÇ   ‚îî‚îÄ‚îÄ Gt(Column(created_at), Literal(<span class="json-string">'2024-01-01'</span>))
‚îî‚îÄ‚îÄ joins: [Join]
    ‚îî‚îÄ‚îÄ on: Eq(Column(users.id), Column(orders.user_id))
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">‚öôÔ∏è</span>
                            –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
                        </div>
                        <div class="data-sample">
<span class="json-comment"># 1. –ó–∞–º–µ–Ω–∞ SELECT *</span>
<span class="json-key">for</span> select <span class="json-key">in</span> parsed.find_all(sqlglot.exp.Select):
    <span class="json-key">if</span> isinstance(select.expressions[0], sqlglot.exp.Star):
        <span class="json-comment"># –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö</span>
        columns = table_metadata[<span class="json-string">"users"</span>][<span class="json-string">"columns"</span>]
        select.expressions = [
            sqlglot.exp.Column(this=col) 
            <span class="json-key">for</span> col <span class="json-key">in</span> columns
        ]

<span class="json-comment"># 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—É—Ç–µ–π —Ç–∞–±–ª–∏—Ü</span>
<span class="json-key">for</span> table <span class="json-key">in</span> parsed.find_all(sqlglot.exp.Table):
    <span class="json-key">if</span> table.db.lower() != <span class="json-string">"optimized"</span>:
        table.set(<span class="json-string">"db"</span>, sqlglot.exp.Identifier(this=<span class="json-string">"optimized"</span>))
        table.set(<span class="json-string">"catalog"</span>, sqlglot.exp.Identifier(this=<span class="json-string">"hive"</span>))

<span class="json-comment"># 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ LIMIT –µ—Å–ª–∏ –Ω—É–∂–Ω–æ</span>
<span class="json-key">if not</span> parsed.find(sqlglot.exp.Limit):
    <span class="json-key">if not</span> _is_aggregation(parsed):
        parsed = parsed.limit(10000)

<span class="json-comment"># 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π</span>
where = parsed.find(sqlglot.exp.Where)
where_columns = {col.name <span class="json-key">for</span> col <span class="json-key">in</span> where.find_all(sqlglot.exp.Column)}
<span class="json-key">if</span> <span class="json-string">"created_at"</span> <span class="json-key">in</span> where_columns:
    logger.info(<span class="json-string">"‚úÖ partition pruning on users.created_at"</span>)

<span class="json-comment"># 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SQL</span>
optimized = parsed.sql(dialect=<span class="json-string">"trino"</span>)
                        </div>
                    </div>

                    <div class="section">
                        <div class="features-grid">
                            <div class="feature-item">
                                <div class="feature-icon">üå≥</div>
                                <div>
                                    <div class="feature-text">AST –ø–∞—Ä—Å–∏–Ω–≥</div>
                                    <div class="feature-desc">–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ SQL</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üéØ</div>
                                <div>
                                    <div class="feature-text">SELECT * ‚Üí columns</div>
                                    <div class="feature-desc">Column pruning</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üîÑ</div>
                                <div>
                                    <div class="feature-text">Path replacement</div>
                                    <div class="feature-desc">public ‚Üí optimized</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üìä</div>
                                <div>
                                    <div class="feature-text">Auto LIMIT</div>
                                    <div class="feature-desc">10,000 —Å—Ç—Ä–æ–∫ max</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üóÇÔ∏è</div>
                                <div>
                                    <div class="feature-text">Partition check</div>
                                    <div class="feature-desc">WHERE –∫–æ–ª–æ–Ω–∫–∏</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üîó</div>
                                <div>
                                    <div class="feature-text">JOIN analysis</div>
                                    <div class="feature-desc">Cluster –∫–æ–ª–æ–Ω–∫–∏</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="details-box">
                        <div class="details-title">üéØ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</div>
                        <ul class="details-list">
                            <li><strong>ThreadPoolExecutor:</strong> max_workers=6</li>
                            <li><strong>Concurrent:</strong> –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤</li>
                            <li><strong>Error handling:</strong> –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ locks</li>
                            <li><strong>Results:</strong> –°–±–æ—Ä —á–µ—Ä–µ–∑ futures</li>
                        </ul>
                    </div>
                </div>

                <div class="center-connector">
                    <div class="center-icon">‚ö°</div>
                    <div class="connector-label">SQLglot</div>
                    <div class="connector-label">AST</div>
                </div>

                <div class="step-card">
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">‚úÖ</span>
                            –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
                        </div>
                        <div class="data-sample">
{
  <span class="json-key">"queryid"</span>: <span class="json-string">"q1"</span>,
  <span class="json-key">"query"</span>: <span class="json-string">"SELECT 
    user_id, 
    username, 
    email, 
    created_at, 
    status 
  FROM hive.optimized.users 
  WHERE created_at > '2024-01-01' 
  JOIN hive.optimized.orders 
    ON users.id = orders.user_id 
  LIMIT 10000"</span>
}

<span class="json-comment">// ‚úÖ –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:</span>
<span class="json-comment">// 1. column pruning (SELECT *)</span>
<span class="json-comment">// 2. automatic LIMIT 10000</span>
<span class="json-comment">// 3. partition pruning on users.created_at</span>
<span class="json-comment">// 4. clustered join on users.user_id</span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">5x</div>
                                <div class="metric-label">Faster</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">70%</div>
                                <div class="metric-label">Less Data</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">100%</div>
                                <div class="metric-label">Valid SQL</div>
                            </div>
                        </div>
                    </div>

                    <div class="process-flow">
                        <div class="details-title" style="color: #78350f; margin-bottom: 15px;">
                            üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                        </div>
                        <div class="process-step">
                            <div class="process-number">‚úì</div>
                            <div class="process-text">Column pruning —Å–Ω–∏–∂–∞–µ—Ç I/O –Ω–∞ 70%</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">‚úì</div>
                            <div class="process-text">Partition pruning —É—Å–∫–æ—Ä—è–µ—Ç WHERE –≤ 10x</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">‚úì</div>
                            <div class="process-text">LIMIT –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö full scan</div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">‚úì</div>
                            <div class="process-text">Clustered JOIN –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 8: QUALITY EVALUATION -->
        <div class="pipeline-step" style="animation-delay: 0.8s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">8</div>
                        <div class="card-title">
                            <h2>üìä Quality Evaluation</h2>
                            <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞<span class="timeline-badge">Gemini 2.5</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üß†</span>
                            LLM Evaluation
                        </div>
                        <div class="data-sample">
<span class="json-key">Model:</span> google/gemini-2.5-flash-preview-09-2025

<span class="json-key">Prompt:</span>
<span class="json-string">"Evaluate database optimization result on 100-point scale.

Criteria:
1. DDL Quality (25): Structure, optimizations, full paths
2. Migration Quality (25): Strategy, validation
3. Query Optimization (25): Performance, correctness
4. Execution Time (15): Expected gains
5. Storage (10): Compression, efficiency"</span>

<span class="json-key">Input:</span>
- URL: jdbc:trino://localhost:8080?catalog=hive
- DDL: 2 tables
- Queries: 5 queries

<span class="json-key">Output:</span>
- DDL: 3 statements (schema + 2 tables)
- Migrations: 2 statements
- Queries: 5 optimized queries
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üìà</span>
                            Evaluation Response
                        </div>
                        <div class="data-sample">
{
  <span class="json-key">"score"</span>: <span class="json-number">87</span>,
  <span class="json-key">"ddl_score"</span>: <span class="json-number">23</span>,
  <span class="json-key">"migration_score"</span>: <span class="json-number">22</span>,
  <span class="json-key">"query_score"</span>: <span class="json-number">21</span>,
  <span class="json-key">"execution_score"</span>: <span class="json-number">13</span>,
  <span class="json-key">"storage_score"</span>: <span class="json-number">8</span>,
  <span class="json-key">"strengths"</span>: [
    <span class="json-string">"Full catalog.optimized.table paths"</span>,
    <span class="json-string">"Iceberg format with ZSTD compression"</span>,
    <span class="json-string">"Proper partitioning strategy"</span>,
    <span class="json-string">"Real SQL optimizations via SQLglot"</span>
  ],
  <span class="json-key">"weaknesses"</span>: [
    <span class="json-string">"Could add more validation queries"</span>,
    <span class="json-string">"Storage estimation not precise"</span>
  ],
  <span class="json-key">"recommendations"</span>: [
    <span class="json-string">"Add ANALYZE TABLE statements"</span>,
    <span class="json-string">"Include rollback scripts"</span>
  ]
}
                        </div>
                    </div>

                    <div class="section">
                        <div class="features-grid">
                            <div class="feature-item">
                                <div class="feature-icon">üéØ</div>
                                <div>
                                    <div class="feature-text">5 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤</div>
                                    <div class="feature-desc">100-–±–∞–ª–ª—å–Ω–∞—è —à–∫–∞–ª–∞</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">‚úÖ</div>
                                <div>
                                    <div class="feature-text">Strengths</div>
                                    <div class="feature-desc">–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">‚ö†Ô∏è</div>
                                <div>
                                    <div class="feature-text">Weaknesses</div>
                                    <div class="feature-desc">–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üí°</div>
                                <div>
                                    <div class="feature-text">Recommendations</div>
                                    <div class="feature-desc">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="center-connector">
                    <div class="center-icon">üéØ</div>
                    <div class="connector-label">Gemini</div>
                    <div class="connector-label">Score</div>
                </div>

                <div class="step-card">
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üèÜ</span>
                            –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞
                        </div>
                        <div style="text-align: center; padding: 40px 20px;">
                            <div style="font-size: 6em; font-weight: bold; 
                                        background: linear-gradient(135deg, #667eea, #764ba2);
                                        -webkit-background-clip: text;
                                        -webkit-text-fill-color: transparent;
                                        margin-bottom: 20px;">
                                87/100
                            </div>
                            <div style="font-size: 1.5em; color: #64748b; font-weight: 600;">
                                Excellent Quality
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="metrics-grid">
                            <div class="metric" style="background: linear-gradient(135deg, #10b981, #059669);">
                                <div class="metric-value">23/25</div>
                                <div class="metric-label">DDL Quality</div>
                            </div>
                            <div class="metric" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
                                <div class="metric-value">22/25</div>
                                <div class="metric-label">Migrations</div>
                            </div>
                            <div class="metric" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                                <div class="metric-value">21/25</div>
                                <div class="metric-label">Queries</div>
                            </div>
                            <div class="metric" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                                <div class="metric-value">13/15</div>
                                <div class="metric-label">Execution</div>
                            </div>
                            <div class="metric" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                                <div class="metric-value">8/10</div>
                                <div class="metric-label">Storage</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 9: FINAL RESULT -->
        <div class="pipeline-step" style="animation-delay: 0.9s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">9</div>
                        <div class="card-title">
                            <h2>üéâ Final Result</h2>
                            <p>GET /getresult - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            
                                