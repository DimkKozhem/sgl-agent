<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL-Agent Deep Dive Pipeline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ */
        html, body {
            overflow-x: hidden;
            max-width: 100vw;
        }

        /* –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—Ç —Ä–æ–¥–∏—Ç–µ–ª—è */
        .step-card > * {
            max-width: 100%;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 25%, #2d1b4e 50%, #1a1f3a 75%, #0a0e27 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            padding: 40px 20px;
            overflow-x: hidden;
            color: #e2e8f0;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 60px;
            animation: fadeInDown 1s ease-out;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(96, 165, 250, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(40px);
            z-index: -1;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); opacity: 0.5; }
            50% { transform: translateX(-50%) scale(1.2); opacity: 0.8; }
        }

        .header h1 {
            font-size: 4.5em;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(96, 165, 250, 0.5), 3px 3px 8px rgba(0,0,0,0.5);
            background: linear-gradient(135deg, #fff 0%, #60a5fa 30%, #a78bfa 60%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -2px;
        }

        .header .subtitle {
            font-size: 1.5em;
            opacity: 0.95;
            font-weight: 300;
            line-height: 1.8;
            max-width: 1200px;
            margin: 0 auto 20px;
        }

        .tech-badges {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .tech-badge {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.95em;
            font-weight: 600;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .tech-badge:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.6);
            transform: translateY(-2px);
        }

        .controls {
            text-align: center;
            margin-bottom: 50px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 30px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        .btn-secondary:hover {
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.6);
        }

        .pipeline-container {
            max-width: 1800px;
            margin: 0 auto;
            position: relative;
            padding: 0 20px;
            overflow-x: hidden;
        }

        .connection-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(to bottom, 
                rgba(59, 130, 246, 0.3), 
                rgba(139, 92, 246, 0.3), 
                rgba(236, 72, 153, 0.3));
            transform: translateX(-50%);
            z-index: 0;
        }

        .data-packet {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            border-radius: 50%;
            animation: dataFlow 8s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.8);
        }

        @keyframes dataFlow {
            0% { top: 0; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        .pipeline-step {
            margin-bottom: 80px;
            animation: fadeInUp 0.8s ease-out both;
            position: relative;
            z-index: 1;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-60px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(60px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-wrapper {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 40px;
            align-items: start;
        }

        .step-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            transition: all 0.4s ease;
            position: relative;
            overflow: visible;
            max-width: 100%;
        }

        .step-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .step-card:hover::before {
            opacity: 1;
        }

        .step-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
            border-color: rgba(139, 92, 246, 0.5);
        }

        .card-header {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
        }

        .step-number {
            min-width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: 900;
            color: white;
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
            position: relative;
        }

        .step-number::after {
            content: '';
            position: absolute;
            inset: -5px;
            border-radius: 50%;
            border: 2px solid rgba(59, 130, 246, 0.3);
            animation: ripple 2s infinite;
        }

        @keyframes ripple {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.3); opacity: 0; }
        }

        .card-title h2 {
            font-size: 2.2em;
            margin-bottom: 8px;
            color: #f1f5f9;
            font-weight: 800;
        }

        .card-title p {
            color: #94a3b8;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .timeline-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 4px 14px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 700;
            margin-left: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .timeline-badge.badge-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .timeline-badge.badge-info {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .section {
            margin-bottom: 30px;
            max-width: 100%;
            overflow-x: auto;
        }

        .section::-webkit-scrollbar {
            height: 8px;
        }

        .section::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 4px;
        }

        .section::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.4);
            border-radius: 4px;
        }

        .section::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.6);
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 20px;
            color: #f1f5f9;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(100, 116, 139, 0.3);
        }

        .section-icon {
            font-size: 1.3em;
        }

        .data-sample {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%);
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-left: 4px solid #3b82f6;
            border-radius: 12px;
            padding: 24px;
            font-family: 'Fira Code', 'JetBrains Mono', 'Consolas', monospace;
            font-size: 0.95em;
            line-height: 1.8;
            overflow-x: auto;
            color: #e2e8f0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(59, 130, 246, 0.1);
            position: relative;
            white-space: pre;
            word-wrap: normal;
        }

        .data-sample::before {
            content: '';
            position: absolute;
            top: 0;
            left: 4px;
            right: 0;
            height: 2px;
            background: linear-gradient(to right, #3b82f6, transparent);
            opacity: 0.6;
        }

        .data-sample::-webkit-scrollbar {
            height: 8px;
        }

        .data-sample::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 4px;
        }

        .data-sample::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.4);
            border-radius: 4px;
            border: 2px solid rgba(15, 23, 42, 0.5);
        }

        .data-sample::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.6);
        }

        /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ - —É–ª—É—á—à–µ–Ω–Ω–∞—è */
        .json-key { 
            color: #60a5fa; 
            font-weight: 600; 
            text-shadow: 0 0 10px rgba(96, 165, 250, 0.3);
        }
        
        .json-string { 
            color: #34d399; 
            text-shadow: 0 0 8px rgba(52, 211, 153, 0.2);
        }
        
        .json-number { 
            color: #fbbf24; 
            font-weight: 500;
            text-shadow: 0 0 8px rgba(251, 191, 36, 0.2);
        }
        
        .json-comment { 
            color: #94a3b8; 
            font-style: italic; 
            opacity: 0.8;
        }

        /* SQL –ø–æ–¥—Å–≤–µ—Ç–∫–∞ */
        .sql-keyword {
            color: #c084fc;
            font-weight: 700;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(192, 132, 252, 0.3);
        }

        .sql-function {
            color: #60a5fa;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(96, 165, 250, 0.2);
        }

        .sql-type {
            color: #a78bfa;
            font-weight: 500;
        }

        .sql-operator {
            color: #f472b6;
            font-weight: 600;
        }

        .sql-constant {
            color: #fb923c;
        }

        /* Python –ø–æ–¥—Å–≤–µ—Ç–∫–∞ */
        .py-keyword {
            color: #c084fc;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(192, 132, 252, 0.3);
        }

        .py-function {
            color: #fbbf24;
            font-weight: 600;
        }

        .py-class {
            color: #60a5fa;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(96, 165, 250, 0.3);
        }

        .py-decorator {
            color: #f472b6;
            font-weight: 600;
        }

        .py-builtin {
            color: #34d399;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-item {
            background: rgba(51, 65, 85, 0.5);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            background: rgba(51, 65, 85, 0.7);
            border-color: rgba(139, 92, 246, 0.5);
            transform: translateX(5px);
        }

        .feature-icon {
            font-size: 2em;
            min-width: 50px;
            text-align: center;
        }

        .feature-text {
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 4px;
            font-size: 1.05em;
        }

        .feature-desc {
            color: #94a3b8;
            font-size: 0.9em;
        }

        .process-flow {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 16px;
            padding: 24px;
            margin-top: 20px;
        }

        .details-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #fbbf24;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .process-step {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #3b82f6;
            transition: all 0.3s ease;
        }

        .process-step:hover {
            background: rgba(30, 41, 59, 0.9);
            border-left-color: #8b5cf6;
            transform: translateX(8px);
        }

        .process-number {
            min-width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: white;
            font-size: 1.1em;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .process-text {
            flex: 1;
            font-size: 1.05em;
            color: #e2e8f0;
        }

        .center-connector {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 30px 0;
        }

        .center-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            box-shadow: 0 12px 36px rgba(139, 92, 246, 0.5);
            animation: float 3s ease-in-out infinite;
            position: relative;
        }

        .center-icon::before {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            opacity: 0.3;
            animation: rotate 4s linear infinite;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .connector-label {
            color: #cbd5e1;
            font-size: 0.95em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .details-box {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 16px;
            padding: 24px;
            margin-top: 20px;
        }

        .details-list {
            list-style: none;
            padding-left: 0;
        }

        .details-list li {
            padding: 12px 0 12px 30px;
            position: relative;
            color: #cbd5e1;
            line-height: 1.7;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        }

        .details-list li:last-child {
            border-bottom: none;
        }

        .details-list li::before {
            content: '‚ñ∏';
            position: absolute;
            left: 8px;
            color: #3b82f6;
            font-weight: bold;
        }

        .highlight {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            padding: 3px 10px;
            border-radius: 6px;
            font-weight: 700;
            color: #78350f;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .metric {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
        }

        .metric:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 32px rgba(59, 130, 246, 0.5);
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: 900;
            color: white;
            margin-bottom: 8px;
        }

        .metric-label {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .architecture-diagram {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            max-width: 100%;
            overflow-x: auto;
        }

        .architecture-diagram::-webkit-scrollbar {
            height: 8px;
        }

        .architecture-diagram::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 4px;
        }

        .architecture-diagram::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.4);
            border-radius: 4px;
        }

        .architecture-diagram::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.6);
        }

        .diagram-title {
            text-align: center;
            font-size: 1.6em;
            font-weight: 800;
            color: #60a5fa;
            margin-bottom: 30px;
        }

        .flow-diagram {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 100%;
            overflow-x: auto;
        }

        .flow-diagram::-webkit-scrollbar {
            height: 8px;
        }

        .flow-diagram::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 4px;
        }

        .flow-diagram::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.4);
            border-radius: 4px;
        }

        .flow-diagram::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.6);
        }

        .flow-box {
            background: rgba(30, 41, 59, 0.9);
            border: 2px solid rgba(59, 130, 246, 0.5);
            border-radius: 16px;
            padding: 24px;
            min-width: 200px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .flow-box:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #60a5fa;
            transform: scale(1.05);
        }

        .flow-arrow {
            font-size: 2em;
            color: #8b5cf6;
            animation: arrowPulse 2s ease-in-out infinite;
        }

        @keyframes arrowPulse {
            0%, 100% { opacity: 0.5; transform: translateX(0); }
            50% { opacity: 1; transform: translateX(5px); }
        }

        .code-block {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 0;
            margin: 20px 0;
            overflow: hidden;
            font-family: 'Fira Code', 'JetBrains Mono', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.8;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(59, 130, 246, 0.1);
            position: relative;
            max-width: 100%;
        }

        .code-block::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(to right, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }

        .code-header {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: transparent;
        }

        .code-language {
            font-size: 0.75em;
            color: #60a5fa;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .copy-button {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            color: #60a5fa;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .copy-button:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.6);
            transform: translateY(-1px);
        }

        .copy-button:active {
            transform: translateY(0);
        }

        .copy-button.copied {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.4);
            color: #34d399;
        }

        .code-content {
            padding: 20px;
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre;
            word-wrap: normal;
        }

        .code-content::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .code-content::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
        }

        .code-content::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.3);
            border-radius: 5px;
        }

        .code-content::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.5);
        }

        .code-line {
            display: flex;
            padding: 2px 0;
            transition: background 0.2s ease;
        }

        .code-line:hover {
            background: rgba(59, 130, 246, 0.08);
        }

        .line-number {
            user-select: none;
            padding-right: 20px;
            padding-left: 10px;
            color: #475569;
            text-align: right;
            min-width: 50px;
            border-right: 2px solid rgba(59, 130, 246, 0.2);
            margin-right: 20px;
            font-weight: 500;
        }

        .line-content {
            flex: 1;
            white-space: pre;
            color: #e2e8f0;
            word-wrap: normal;
            overflow-x: visible;
        }

        .tab-container {
            margin: 30px 0;
            max-width: 100%;
            overflow-x: auto;
        }

        .tab-container::-webkit-scrollbar {
            height: 8px;
        }

        .tab-container::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 4px;
        }

        .tab-container::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.4);
            border-radius: 4px;
        }

        .tab-container::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.6);
        }

        .tabs {
            display: flex;
            gap: 8px;
            border-bottom: 2px solid rgba(100, 116, 139, 0.3);
            margin-bottom: 20px;
        }

        .tab {
            background: rgba(51, 65, 85, 0.5);
            border: none;
            padding: 12px 24px;
            border-radius: 8px 8px 0 0;
            color: #94a3b8;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: rgba(59, 130, 246, 0.3);
            color: #60a5fa;
            border-bottom: 2px solid #60a5fa;
        }

        .tab:hover {
            background: rgba(51, 65, 85, 0.8);
            color: #cbd5e1;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
            color: #fbbf24;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
            color: #60a5fa;
        }

        .success-box {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid #10b981;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
            color: #34d399;
        }

        .error-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
            color: #f87171;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
            max-width: 100%;
            overflow-x: auto;
        }

        .comparison-grid::-webkit-scrollbar {
            height: 8px;
        }

        .comparison-grid::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 4px;
        }

        .comparison-grid::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.4);
            border-radius: 4px;
        }

        .comparison-grid::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.6);
        }

        .comparison-box {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 12px;
            padding: 20px;
        }

        .comparison-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 15px;
            color: #f1f5f9;
        }

        .ast-tree {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Fira Code', monospace;
            font-size: 0.85em;
        }

        .tree-node {
            margin-left: 20px;
            padding: 5px 0;
            position: relative;
            max-width: 100%;
            overflow-x: auto;
            word-wrap: break-word;
        }

        .tree-node::before {
            content: '‚îú‚îÄ';
            position: absolute;
            left: -20px;
            color: #60a5fa;
        }

        .tree-node:last-child::before {
            content: '‚îî‚îÄ';
        }

        .code-highlight {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.25), rgba(139, 92, 246, 0.25));
            border: 1px solid rgba(59, 130, 246, 0.5);
            border-radius: 6px;
            padding: 3px 10px;
            font-family: 'Fira Code', 'JetBrains Mono', 'Consolas', monospace;
            font-size: 0.9em;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            display: inline-block;
        }

        .code-highlight:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.35), rgba(139, 92, 246, 0.35));
            border-color: rgba(59, 130, 246, 0.7);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞ */
        @keyframes codeBlockAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .code-block {
            animation: codeBlockAppear 0.5s ease-out;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Å—Ç—Ä–æ–∫—É –∫–æ–¥–∞ */
        .code-line:hover .line-number {
            color: #60a5fa;
            border-right-color: rgba(59, 130, 246, 0.5);
        }

        /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ */
        .code-line.highlighted {
            background: rgba(251, 191, 36, 0.15);
            border-left: 3px solid #fbbf24;
            padding-left: 5px;
        }

        /* –†–µ–∂–∏–º –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫ */
        .data-sample.wrap-mode {
            white-space: pre-wrap;
            word-break: break-word;
        }

        .code-content.wrap-mode {
            white-space: pre-wrap;
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ */
        .wrap-toggle {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.4);
            color: #a78bfa;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .wrap-toggle:hover {
            background: rgba(139, 92, 246, 0.3);
            border-color: rgba(139, 92, 246, 0.6);
            transform: translateY(-1px);
        }

        .wrap-toggle:active {
            transform: translateY(0);
        }

        .wrap-toggle.active {
            background: rgba(139, 92, 246, 0.4);
            color: #c084fc;
            border-color: rgba(139, 92, 246, 0.6);
        }

        @media (max-width: 1400px) {
            .step-wrapper {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .center-connector {
                order: 2;
                margin: 20px 0;
            }

            .connection-line {
                display: none;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.8em;
            }

            .step-card {
                padding: 25px;
            }

            .card-title h2 {
                font-size: 1.8em;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .data-sample {
                font-size: 0.85em;
                padding: 16px;
                white-space: pre-wrap;
                word-break: break-word;
            }

            .code-content {
                font-size: 0.85em;
                padding: 12px;
                white-space: pre-wrap;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ SQL-Agent Deep Dive</h1>
        <p class="subtitle">–ü–æ–ª–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ë–î<br>
        <span style="font-size: 0.85em; opacity: 0.8;">–û—Ç –≤—Ö–æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ SQL —á–µ—Ä–µ–∑ AST —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏</span></p>
        
        <div class="tech-badges">
            <div class="tech-badge">üß† LLM: Nvidia Nemotron / Gemini 2.5</div>
            <div class="tech-badge">‚ö° SQLglot AST Parser</div>
            <div class="tech-badge">‚ùÑÔ∏è Apache Iceberg</div>
            <div class="tech-badge">üîß FastAPI + Uvicorn</div>
            <div class="tech-badge">üìä Trino/PostgreSQL/MySQL</div>
            <div class="tech-badge">üéØ ZSTD Compression</div>
            <div class="tech-badge">üîÑ Async Task Manager</div>
            <div class="tech-badge">üìù I/O Logging</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚Üë –í –Ω–∞—á–∞–ª–æ</button>
        <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
        <button class="btn" onclick="toggleAll()">üìã –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å—ë</button>
    </div>

    <div class="pipeline-container">
        <div class="connection-line">
            <div class="data-packet" style="animation-delay: 0s"></div>
            <div class="data-packet" style="animation-delay: 2s"></div>
            <div class="data-packet" style="animation-delay: 4s"></div>
            <div class="data-packet" style="animation-delay: 6s"></div>
        </div>

        <!-- STEP 1: API REQUEST - DETAILED -->
        <div class="pipeline-step" style="animation-delay: 0.1s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">1</div>
                        <div class="card-title">
                            <h2>üì• API Request Handler</h2>
                            <p>POST /analyze - FastAPI endpoint —Å Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π<span class="timeline-badge">Entry Point</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üìù</span>
                            –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Ö–æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                        </div>
                        <div class="data-sample">
POST /analyze HTTP/1.1
Host: localhost:8001
Content-Type: application/json

{
  <span class="json-key">"url"</span>: <span class="json-string">"jdbc:trino://localhost:8080?catalog=hive&user=admin"</span>,
  <span class="json-key">"ddl"</span>: [
    {
      <span class="json-string">"statement"</span>: <span class="json-string">"CREATE TABLE hive.public.users (
        user_id BIGINT,
        username VARCHAR(255),
        email VARCHAR(255),
        created_at TIMESTAMP,
        status VARCHAR(50)
      )"</span>
    },
    {
      <span class="json-string">"statement"</span>: <span class="json-string">"CREATE TABLE hive.public.orders (
        order_id BIGINT,
        user_id BIGINT,
        amount DECIMAL(10,2),
        order_date DATE
      )"</span>
    }
  ],
  <span class="json-key">"queries"</span>: [
    {
      <span class="json-string">"queryid"</span>: <span class="json-string">"q1"</span>,
      <span class="json-string">"query"</span>: <span class="json-string">"SELECT * FROM users WHERE created_at > TIMESTAMP '2024-01-01'"</span>,
      <span class="json-string">"runquantity"</span>: <span class="json-number">1000</span>
    },
    {
      <span class="json-string">"queryid"</span>: <span class="json-string">"q2"</span>,
      <span class="json-string">"query"</span>: <span class="json-string">"SELECT user_id, COUNT(*) FROM orders GROUP BY user_id"</span>,
      <span class="json-string">"runquantity"</span>: <span class="json-number">500</span>
    }
  ]
}
                        </div>
                    </div>

                    <div class="architecture-diagram">
                        <div class="diagram-title">üèóÔ∏è –î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</div>
                        <div class="flow-diagram">
                            <div class="flow-box">
                                <div style="font-size: 2em; margin-bottom: 10px;">üì°</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">HTTP Request</div>
                                <div style="font-size: 0.85em; color: #94a3b8;">Client ‚Üí Server</div>
                                <div style="font-size: 0.75em; color: #64748b; margin-top: 5px;">Content-Type: JSON</div>
                            </div>
                            <div class="flow-arrow">‚Üí</div>
                            <div class="flow-box">
                                <div style="font-size: 2em; margin-bottom: 10px;">üîç</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Pydantic Validator</div>
                                <div style="font-size: 0.85em; color: #94a3b8;">OptimizationRequest</div>
                                <div style="font-size: 0.75em; color: #64748b; margin-top: 5px;">Type checking</div>
                            </div>
                            <div class="flow-arrow">‚Üí</div>
                            <div class="flow-box">
                                <div style="font-size: 2em; margin-bottom: 10px;">‚öôÔ∏è</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Task Manager</div>
                                <div style="font-size: 0.85em; color: #94a3b8;">create_task()</div>
                                <div style="font-size: 0.75em; color: #64748b; margin-top: 5px;">UUID generation</div>
                            </div>
                            <div class="flow-arrow">‚Üí</div>
                            <div class="flow-box">
                                <div style="font-size: 2em; margin-bottom: 10px;">üéØ</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">202 Accepted</div>
                                <div style="font-size: 0.85em; color: #94a3b8;">{"task_id": "..."}</div>
                                <div style="font-size: 0.75em; color: #64748b; margin-top: 5px;">Async processing</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üîê</span>
                            Pydantic –º–æ–¥–µ–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                        </div>
                        <div class="data-sample">
<span class="json-key">from</span> pydantic <span class="json-key">import</span> BaseModel, Field, validator

<span class="json-key">class</span> DDLStatement(BaseModel):
    statement: <span class="json-key">str</span> = Field(..., min_length=<span class="json-number">10</span>)
    
    <span class="json-comment"># –í–∞–ª–∏–¥–∞—Ü–∏—è SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞</span>
    @validator(<span class="json-string">'statement'</span>)
    <span class="json-key">def</span> validate_sql(cls, v):
        <span class="json-key">if not</span> v.strip().upper().startswith(<span class="json-string">'CREATE'</span>):
            <span class="json-key">raise</span> ValueError(<span class="json-string">'DDL must start with CREATE'</span>)
        <span class="json-key">return</span> v

<span class="json-key">class</span> QueryItem(BaseModel):
    queryid: <span class="json-key">str</span> = Field(..., min_length=<span class="json-number">1</span>)
    query: <span class="json-key">str</span> = Field(..., min_length=<span class="json-number">5</span>)
    runquantity: <span class="json-key">int</span> = Field(..., ge=<span class="json-number">1</span>)
    
    @validator(<span class="json-string">'query'</span>)
    <span class="json-key">def</span> validate_query(cls, v):
        <span class="json-key">if not</span> v.strip().upper().startswith(<span class="json-string">'SELECT'</span>):
            <span class="json-key">raise</span> ValueError(<span class="json-string">'Query must be SELECT'</span>)
        <span class="json-key">return</span> v

<span class="json-key">class</span> OptimizationRequest(BaseModel):
    url: <span class="json-key">str</span> = Field(..., regex=<span class="json-string">r'^jdbc:'</span>)
    ddl: List[DDLStatement]
    queries: List[QueryItem]
                        </div>
                    </div>

                    <div class="tab-container">
                        <div class="tabs">
                            <button class="tab active" onclick="switchTab(event, 'validation-success')">‚úÖ Success</button>
                            <button class="tab" onclick="switchTab(event, 'validation-error')">‚ùå Errors</button>
                            <button class="tab" onclick="switchTab(event, 'edge-cases')">‚ö†Ô∏è Edge Cases</button>
                        </div>

                        <div id="validation-success" class="tab-content active">
                            <div class="success-box">
                                <strong>‚úÖ –£—Å–ø–µ—à–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è</strong>
                                <div class="data-sample" style="margin-top: 10px;">
{
  <span class="json-key">"task_id"</span>: <span class="json-string">"550e8400-e29b-41d4-a716-446655440000"</span>,
  <span class="json-key">"status"</span>: <span class="json-string">"PENDING"</span>,
  <span class="json-key">"message"</span>: <span class="json-string">"Task created successfully"</span>,
  <span class="json-key">"estimated_time"</span>: <span class="json-string">"30-60 seconds"</span>
}
                                </div>
                            </div>
                        </div>

                        <div id="validation-error" class="tab-content">
                            <div class="error-box">
                                <strong>‚ùå –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏</strong>
                                <div class="data-sample" style="margin-top: 10px;">
<span class="json-comment">// –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JDBC URL</span>
{
  <span class="json-key">"error"</span>: <span class="json-string">"Validation Error"</span>,
  <span class="json-key">"detail"</span>: [
    {
      <span class="json-string">"loc"</span>: [<span class="json-string">"body"</span>, <span class="json-string">"url"</span>],
      <span class="json-string">"msg"</span>: <span class="json-string">"string does not match regex '^jdbc:'"</span>,
      <span class="json-string">"type"</span>: <span class="json-string">"value_error.str.regex"</span>
    }
  ]
}

<span class="json-comment">// –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π DDL</span>
{
  <span class="json-key">"error"</span>: <span class="json-string">"Validation Error"</span>,
  <span class="json-key">"detail"</span>: <span class="json-string">"DDL must start with CREATE"</span>
}

<span class="json-comment">// –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–∞ –≤–º–µ—Å—Ç–æ –∑–∞–ø—Ä–æ—Å–∞</span>
{
  <span class="json-key">"error"</span>: <span class="json-string">"Bad Request"</span>,
  <span class="json-key">"detail"</span>: <span class="json-string">"–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ñ–∞–π–ª –ª–æ–≥–∞ –∑–∞–¥–∞—á–∏ –≤–º–µ—Å—Ç–æ –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞"</span>,
  <span class="json-key">"hint"</span>: <span class="json-string">"–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏: url, ddl, queries"</span>
}
                                </div>
                            </div>
                        </div>

                        <div id="edge-cases" class="tab-content">
                            <div class="warning-box">
                                <strong>‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases</strong>
                                <ul class="details-list" style="margin-top: 10px;">
                                    <li><strong>–ë–æ–ª—å—à–∏–µ JSON (>100MB):</strong> –£–≤–µ–ª–∏—á–µ–Ω h11_max_incomplete_event_size –¥–æ 100MB</li>
                                    <li><strong>–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:</strong> timeout_keep_alive=300s –¥–ª—è —Ç—É–Ω–Ω–µ–ª–µ–π (tuna)</li>
                                    <li><strong>–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏:</strong> max_queue_size=100, –≤–æ–∑–≤—Ä–∞—Ç 413</li>
                                    <li><strong>–î—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–¥–∞—á:</strong> –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Ö–µ—à—É request_data</li>
                                    <li><strong>Trailing commas –≤ JSON:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ regex</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="details-box">
                        <div class="details-title">üõ°Ô∏è –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫</div>
                        <div class="data-sample">
<span class="json-comment"># api.py - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π</span>

@app.exception_handler(RequestValidationError)
<span class="json-key">async def</span> validation_exception_handler(request, exc):
    <span class="json-comment"># –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥</span>
    body = <span class="json-key">await</span> request.body()
    data = json.loads(body)
    
    <span class="json-key">if</span> all(k <span class="json-key">in</span> data <span class="json-key">for</span> k <span class="json-key">in</span> [<span class="json-string">'task_id'</span>, <span class="json-string">'timestamp'</span>, <span class="json-string">'input'</span>, <span class="json-string">'output'</span>]):
        <span class="json-key">return</span> JSONResponse(
            status_code=<span class="json-number">400</span>,
            content={<span class="json-string">"error"</span>: <span class="json-string">"–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ª–æ–≥ –≤–º–µ—Å—Ç–æ –∑–∞–ø—Ä–æ—Å–∞"</span>}
        )
    
    <span class="json-key">return</span> JSONResponse(status_code=<span class="json-number">400</span>, content=...)

@app.exception_handler(json.JSONDecodeError)
<span class="json-key">async def</span> json_decode_exception_handler(request, exc):
    <span class="json-comment"># –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON —Å–∏–Ω—Ç–∞–∫—Å–∏—Å</span>
    <span class="json-key">return</span> JSONResponse(
        status_code=<span class="json-number">400</span>,
        content={<span class="json-string">"error"</span>: <span class="json-string">"Invalid JSON syntax"</span>}
    )

@app.exception_handler(Exception)
<span class="json-key">async def</span> global_exception_handler(request, exc):
    <span class="json-comment"># –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞–∑—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ!</span>
    logger.exception(<span class="json-string">f"Unhandled: {request.url.path}"</span>)
    <span class="json-key">return</span> JSONResponse(
        status_code=<span class="json-number">500</span>,
        content={<span class="json-string">"error"</span>: <span class="json-string">"internal-error"</span>, <span class="json-string">"detail"</span>: str(exc)}
    )
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 2: TASK MANAGER - ULTRA DETAILED -->
        <div class="pipeline-step" style="animation-delay: 0.2s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">2</div>
                        <div class="card-title">
                            <h2>‚öôÔ∏è Async Task Manager</h2>
                            <p>SimpleTaskManager - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º<span class="timeline-badge">Concurrency Control</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üéØ</span>
                            –ü–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Task Manager
                        </div>
                        <div class="data-sample">
<span class="json-comment"># task_manager.py</span>

<span class="json-key">class</span> SimpleTaskManager:
    <span class="json-key">def</span> __init__(
        self,
        max_workers: <span class="json-key">int</span> = <span class="json-number">10</span>,
        task_timeout_minutes: <span class="json-key">int</span> = <span class="json-number">15</span>,
        use_llm: <span class="json-key">bool</span> = <span class="json-key">True</span>,
        max_queue_size: <span class="json-key">int</span> = <span class="json-number">100</span>,
        cleanup_after_hours: <span class="json-key">int</span> = <span class="json-number">72</span>
    ):
        self.tasks: Dict[str, Task] = {}
        self.max_workers = max_workers
        self.task_timeout_minutes = task_timeout_minutes
        self._running_tasks = <span class="json-number">0</span>
        
        <span class="json-comment"># –°–µ–º–∞—Ñ–æ—Ä –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏</span>
        self._semaphore = asyncio.Semaphore(max_workers)
        
        <span class="json-comment"># –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫</span>
        self.error_stats = {
            <span class="json-string">"timeout_errors"</span>: <span class="json-number">0</span>,
            <span class="json-string">"llm_errors"</span>: <span class="json-number">0</span>,
            <span class="json-string">"validation_errors"</span>: <span class="json-number">0</span>,
            <span class="json-string">"database_errors"</span>: <span class="json-number">0</span>,
            <span class="json-string">"total_errors"</span>: <span class="json-number">0</span>,
            <span class="json-string">"queue_full_errors"</span>: <span class="json-number">0</span>
        }
        
        <span class="json-comment"># LLM –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä</span>
        <span class="json-key">if</span> use_llm:
            self.llm_analyzer = LLMAnalyzer()
            logger.info(<span class="json-string">"‚úÖ LLM analyzer initialized"</span>)
                        </div>
                    </div>

                    <div class="architecture-diagram">
                        <div class="diagram-title">üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á–∏</div>
                        <div class="process-flow">
                            <div class="process-step">
                                <div class="process-number">1</div>
                                <div class="process-text">
                                    <strong>PENDING</strong> - –°–æ–∑–¥–∞–Ω–∏–µ UUID, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ self.tasks
                                    <div style="font-size: 0.85em; color: #94a3b8; margin-top: 5px;">
                                        task_id = str(uuid.uuid4())
                                    </div>
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="process-number">2</div>
                                <div class="process-text">
                                    <strong>RUNNING</strong> - –ó–∞—Ö–≤–∞—Ç —Å–µ–º–∞—Ñ–æ—Ä–∞, –∑–∞–ø—É—Å–∫ async –∑–∞–¥–∞—á–∏
                                    <div style="font-size: 0.85em; color: #94a3b8; margin-top: 5px;">
                                        async with self._semaphore: ...
                                    </div>
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="process-number">3</div>
                                <div class="process-text">
                                    <strong>PROCESSING</strong> - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ LLM –ø–∞–π–ø–ª–∞–π–Ω–∞ (4 —ç—Ç–∞–ø–∞)
                                    <div style="font-size: 0.85em; color: #94a3b8; margin-top: 5px;">
                                        result = await asyncio.wait_for(llm_analyzer.analyze(...), timeout)
                                    </div>
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="process-number">4</div>
                                <div class="process-text">
                                    <strong>COMPLETED</strong> - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ + I/O –ª–æ–≥
                                    <div style="font-size: 0.85em; color: #94a3b8; margin-top: 5px;">
                                        save_task_io(task_id, input, output)
                                    </div>
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="process-number">5</div>
                                <div class="process-text">
                                    <strong>CLEANUP</strong> - –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 72 —á–∞—Å–∞
                                    <div style="font-size: 0.85em; color: #94a3b8; margin-top: 5px;">
                                        Background task: every 1 hour
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-container">
                        <div class="tabs">
                            <button class="tab active" onclick="switchTab(event, 'task-creation')">–°–æ–∑–¥–∞–Ω–∏–µ</button>
                            <button class="tab" onclick="switchTab(event, 'task-execution')">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</button>
                            <button class="tab" onclick="switchTab(event, 'task-cleanup')">–û—á–∏—Å—Ç–∫–∞</button>
                            <button class="tab" onclick="switchTab(event, 'task-errors')">–û—à–∏–±–∫–∏</button>
                        </div>

                        <div id="task-creation" class="tab-content active">
                            <div class="section">
                                <div class="section-title">
                                    <span class="section-icon">üÜï</span>
                                    –ú–µ—Ç–æ–¥ create_task()
                                </div>
                                <div class="data-sample">
<span class="json-key">async def</span> create_task(self, request_data: Dict) -> str:
    <span class="json-comment"># –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏</span>
    <span class="json-key">if</span> self.max_queue_size > <span class="json-number">0</span> <span class="json-key">and</span> len(self.tasks) >= self.max_queue_size:
        self.error_stats[<span class="json-string">"queue_full_errors"</span>] += <span class="json-number">1</span>
        <span class="json-key">raise</span> HTTPException(
            status_code=<span class="json-number">413</span>,
            detail=<span class="json-string">f"Queue full: {len(self.tasks)}/{self.max_queue_size}"</span>
        )
    
    <span class="json-comment"># –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID</span>
    task_id = str(uuid.uuid4())
    
    <span class="json-comment"># –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∑–∞–¥–∞—á–∏</span>
    task = Task(
        task_id=task_id,
        status=TaskStatus.PENDING,
        created_at=datetime.utcnow(),
        request_data=request_data
    )
    
    self.tasks[task_id] = task
    
    <span class="json-comment"># –ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</span>
    asyncio.create_task(self._execute_task(task_id, request_data))
    
    logger.info(<span class="json-string">f"‚úÖ Task {task_id} created"</span>)
    <span class="json-key">return</span> task_id
                                </div>
                            </div>
                        </div>

                        <div id="task-execution" class="tab-content">
                            <div class="section">
                                <div class="section-title">
                                    <span class="section-icon">‚ö°</span>
                                    –ú–µ—Ç–æ–¥ _execute_task() —Å —Ç–∞–π–º–∞—É—Ç–æ–º
                                </div>
                                <div class="data-sample">
<span class="json-key">async def</span> _execute_task(self, task_id: str, request_data: Dict):
    task = self.tasks[task_id]
    
    <span class="json-key">async with</span> self._semaphore:  <span class="json-comment"># –ó–∞—Ö–≤–∞—Ç —Å–µ–º–∞—Ñ–æ—Ä–∞</span>
        self._running_tasks += <span class="json-number">1</span>
        task.status = TaskStatus.RUNNING
        task.started_at = datetime.utcnow()
        
        <span class="json-key">try</span>:
            <span class="json-comment"># –¢–∞–π–º–∞—É—Ç –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</span>
            timeout = self.task_timeout_minutes * <span class="json-number">60</span>
            
            result = <span class="json-key">await</span> asyncio.wait_for(
                self._run_llm_pipeline(request_data),
                timeout=timeout
            )
            
            <span class="json-comment"># –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</span>
            task.status = TaskStatus.COMPLETED
            task.result = result
            task.completed_at = datetime.utcnow()
            
            <span class="json-comment"># –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ I/O</span>
            save_task_io(task_id, request_data, result)
            
            logger.info(<span class="json-string">f"‚úÖ Task {task_id} completed"</span>)
            
        <span class="json-key">except</span> asyncio.TimeoutError:
            task.status = TaskStatus.FAILED
            task.error = <span class="json-string">f"Timeout after {self.task_timeout_minutes}m"</span>
            self.error_stats[<span class="json-string">"timeout_errors"</span>] += <span class="json-number">1</span>
            logger.error(<span class="json-string">f"‚ùå Task {task_id} timeout"</span>)
            
        <span class="json-key">except</span> Exception <span class="json-key">as</span> e:
            task.status = TaskStatus.FAILED
            task.error = str(e)
            self._categorize_error(e)
            logger.exception(<span class="json-string">f"‚ùå Task {task_id} failed"</span>)
            
        <span class="json-key">finally</span>:
            self._running_tasks -= <span class="json-number">1</span>
                                </div>
                            </div>
                        </div>

                        <div id="task-cleanup" class="tab-content">
                            <div class="section">
                                <div class="section-title">
                                    <span class="section-icon">üßπ</span>
                                    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–¥–∞—á
                                </div>
                                <div class="data-sample">
<span class="json-key">async def</span> _cleanup_old_tasks(self):
    <span class="json-string">"""–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á"""</span>
    <span class="json-key">while</span> <span class="json-key">True</span>:
        <span class="json-key">await</span> asyncio.sleep(<span class="json-number">3600</span>)  <span class="json-comment"># –ö–∞–∂–¥—ã–π —á–∞—Å</span>
        
        cutoff = datetime.utcnow() - timedelta(hours=self.cleanup_after_hours)
        tasks_to_delete = []
        
        <span class="json-key">for</span> task_id, task <span class="json-key">in</span> self.tasks.items():
            <span class="json-comment"># –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ/–æ—à–∏–±–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏</span>
            <span class="json-key">if</span> task.status <span class="json-key">in</span> [TaskStatus.COMPLETED, TaskStatus.FAILED]:
                <span class="json-key">if</span> task.completed_at <span class="json-key">and</span> task.completed_at < cutoff:
                    tasks_to_delete.append(task_id)
        
        <span class="json-comment"># –£–¥–∞–ª–µ–Ω–∏–µ</span>
        <span class="json-key">for</span> task_id <span class="json-key">in</span> tasks_to_delete:
            <span class="json-key">del</span> self.tasks[task_id]
            logger.info(<span class="json-string">f"üóëÔ∏è Cleaned up task {task_id}"</span>)
        
        <span class="json-key">if</span> tasks_to_delete:
            logger.info(<span class="json-string">f"üßπ Cleaned {len(tasks_to_delete)} old tasks"</span>)

<span class="json-comment"># –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span>
@app.on_event(<span class="json-string">"startup"</span>)
<span class="json-key">async def</span> startup_event():
    task_manager.start_cleanup_task()
    logger.info(<span class="json-string">"‚úÖ Cleanup task started"</span>)
                                </div>
                            </div>
                        </div>

                        <div id="task-errors" class="tab-content">
                            <div class="section">
                                <div class="section-title">
                                    <span class="section-icon">üìä</span>
                                    –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫
                                </div>
                                <div class="data-sample">
<span class="json-key">def</span> _categorize_error(self, error: Exception):
    <span class="json-string">"""–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""</span>
    error_msg = str(error).lower()
    
    <span class="json-key">if</span> <span class="json-string">"llm"</span> <span class="json-key">in</span> error_msg <span class="json-key">or</span> <span class="json-string">"openai"</span> <span class="json-key">in</span> error_msg:
        self.error_stats[<span class="json-string">"llm_errors"</span>] += <span class="json-number">1</span>
    <span class="json-key">elif</span> <span class="json-string">"validation"</span> <span class="json-key">in</span> error_msg <span class="json-key">or</span> <span class="json-string">"invalid"</span> <span class="json-key">in</span> error_msg:
        self.error_stats[<span class="json-string">"validation_errors"</span>] += <span class="json-number">1</span>
    <span class="json-key">elif</span> <span class="json-string">"database"</span> <span class="json-key">in</span> error_msg <span class="json-key">or</span> <span class="json-string">"jdbc"</span> <span class="json-key">in</span> error_msg:
        self.error_stats[<span class="json-string">"database_errors"</span>] += <span class="json-number">1</span>
    
    self.error_stats[<span class="json-string">"total_errors"</span>] += <span class="json-number">1</span>

<span class="json-comment"># GET /health endpoint</span>
@app.get(<span class="json-string">"/health"</span>)
<span class="json-key">async def</span> health_check():
    stats = task_manager.get_stats()
    error_rate = stats[<span class="json-string">"failed_tasks"</span>] / stats[<span class="json-string">"total_tasks"</span>] <span class="json-key">if</span> stats[<span class="json-string">"total_tasks"</span>] > <span class="json-number">0</span> <span class="json-key">else</span> <span class="json-number">0</span>
    
    health_status = <span class="json-string">"healthy"</span>
    <span class="json-key">if</span> error_rate > <span class="json-number">0.5</span>:
        health_status = <span class="json-string">"critical"</span>
    <span class="json-key">elif</span> error_rate > <span class="json-number">0.2</span>:
        health_status = <span class="json-string">"degraded"</span>
    
    <span class="json-key">return</span> {
        <span class="json-string">"health"</span>: health_status,
        <span class="json-string">"errors"</span>: task_manager.error_stats
    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric" style="background: linear-gradient(135deg, #10b981, #059669);">
                            <div class="metric-value">15m</div>
                            <div class="metric-label">Task Timeout</div>
                        </div>
                        <div class="metric" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
                            <div class="metric-value">10</div>
                            <div class="metric-label">Max Workers</div>
                        </div>
                        <div class="metric" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                            <div class="metric-value">100</div>
                            <div class="metric-label">Queue Size</div>
                        </div>
                        <div class="metric" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                            <div class="metric-value">72h</div>
                            <div class="metric-label">Auto Cleanup</div>
                        </div>
                    </div>

                    <div class="info-box">
                        <strong>üí° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:</strong> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç asyncio.Semaphore –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏. –ú–∞–∫—Å–∏–º—É–º 10 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∂–¥—É—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Å–ª–æ—Ç–∞. –¢–∞–π–º–∞—É—Ç 15 –º–∏–Ω—É—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–µ. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–∞–∂–¥—ã–π —á–∞—Å —É–¥–∞–ª—è–µ—Ç –∑–∞–¥–∞—á–∏ —Å—Ç–∞—Ä—à–µ 72 —á–∞—Å–æ–≤.
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 3: DATABASE CONNECTOR - ULTRA DETAILED -->
        <div class="pipeline-step" style="animation-delay: 0.3s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">3</div>
                        <div class="card-title">
                            <h2>üóÑÔ∏è Database Connector</h2>
                            <p>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏ —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏<span class="timeline-badge badge-info">Multi-DB Support</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üîå</span>
                            JDBC URL –ø–∞—Ä—Å–∏–Ω–≥ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ë–î
                        </div>
                        <div class="data-sample">
<span class="json-comment"># db_connector.py</span>

<span class="json-key">def</span> _detect_db_type(jdbc_url: str) -> str:
    <span class="json-string">"""–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ë–î –∏–∑ JDBC URL"""</span>
    url_lower = jdbc_url.lower()
    
    <span class="json-key">if</span> <span class="json-string">'trino'</span> <span class="json-key">in</span> url_lower <span class="json-key">or</span> <span class="json-string">'presto'</span> <span class="json-key">in</span> url_lower:
        <span class="json-key">return</span> <span class="json-string">'trino'</span>
    <span class="json-key">elif</span> <span class="json-string">'postgresql'</span> <span class="json-key">in</span> url_lower <span class="json-key">or</span> <span class="json-string">'postgres'</span> <span class="json-key">in</span> url_lower:
        <span class="json-key">return</span> <span class="json-string">'postgresql'</span>
    <span class="json-key">elif</span> <span class="json-string">'mysql'</span> <span class="json-key">in</span> url_lower:
        <span class="json-key">return</span> <span class="json-string">'mysql'</span>
    <span class="json-key">else</span>:
        <span class="json-key">raise</span> ValueError(<span class="json-string">f"Unsupported DB: {jdbc_url}"</span>)

<span class="json-comment"># –ü—Ä–∏–º–µ—Ä—ã URL</span>
jdbc:trino://localhost:8080?catalog=hive&user=admin
jdbc:postgresql://localhost:5432/mydb?user=postgres&password=secret
jdbc:mysql://localhost:3306/mydb?user=root
                        </div>
                    </div>

                    <div class="tab-container">
                        <div class="tabs">
                            <button class="tab active" onclick="switchTab(event, 'trino-conn')">Trino</button>
                            <button class="tab" onclick="switchTab(event, 'postgres-conn')">PostgreSQL</button>
                            <button class="tab" onclick="switchTab(event, 'mysql-conn')">MySQL</button>
                        </div>

                        <div id="trino-conn" class="tab-content active">
                            <div class="section">
                                <div class="section-title">
                                    <span class="section-icon">üéØ</span>
                                    –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Trino
                                </div>
                                <div class="data-sample">
<span class="json-key">import</span> trino
<span class="json-key">from</span> urllib.parse <span class="json-key">import</span> urlparse, parse_qs

<span class="json-key">def</span> _connect_trino(jdbc_url: str):
    <span class="json-comment"># –ü–∞—Ä—Å–∏–Ω–≥ JDBC URL</span>
    url = jdbc_url.replace(<span class="json-string">'jdbc:trino://'</span>, <span class="json-string">'http://'</span>)
    parsed = urlparse(url)
    params = parse_qs(parsed.query)
    
    <span class="json-comment"># –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</span>
    connection = trino.dbapi.connect(
        host=parsed.hostname,
        port=parsed.port <span class="json-key">or</span> <span class="json-number">8080</span>,
        user=params.get(<span class="json-string">'user'</span>, [<span class="json-string">'admin'</span>])[<span class="json-number">0</span>],
        catalog=params.get(<span class="json-string">'catalog'</span>, [<span class="json-string">'hive'</span>])[<span class="json-number">0</span>],
        schema=params.get(<span class="json-string">'schema'</span>, [<span class="json-string">'default'</span>])[<span class="json-number">0</span>]
    )
    
    logger.info(<span class="json-string">f"‚úÖ Connected to Trino: {parsed.hostname}:{parsed.port}"</span>)
    <span class="json-key">return</span> connection

<span class="json-comment"># –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–∞–±–ª–∏—Ü—ã</span>
<span class="json-key">def</span> get_table_stats_trino(conn, catalog, schema, table):
    cursor = conn.cursor()
    
    <span class="json-comment"># 1. Row count</span>
    cursor.execute(<span class="json-string">f"SELECT COUNT(*) FROM {catalog}.{schema}.{table}"</span>)
    row_count = cursor.fetchone()[<span class="json-number">0</span>]
    
    <span class="json-comment"># 2. Table size (Iceberg specific)</span>
    cursor.execute(<span class="json-string">f"""
        SELECT SUM(\"$data_size_in_bytes\") 
        FROM \"{catalog}\".\"{schema}\".\"{table}$files\"
    """</span>)
    size_bytes = cursor.fetchone()[<span class="json-number">0</span>] <span class="json-key">or</span> <span class="json-number">0</span>
    
    <span class="json-comment"># 3. Column cardinality (approximate for speed)</span>
    cursor.execute(<span class="json-string">f"SHOW COLUMNS FROM {catalog}.{schema}.{table}"</span>)
    columns = [row[<span class="json-number">0</span>] <span class="json-key">for</span> row <span class="json-key">in</span> cursor.fetchall()]
    
    column_stats = {}
    <span class="json-key">for</span> col <span class="json-key">in</span> columns:
        cursor.execute(<span class="json-string">f"""
            SELECT APPROX_DISTINCT({col}) 
            FROM {catalog}.{schema}.{table}
        """</span>)
        cardinality = cursor.fetchone()[<span class="json-number">0</span>]
        column_stats[col] = {<span class="json-string">'cardinality'</span>: cardinality}
    
    <span class="json-key">return</span> {
        <span class="json-string">'row_count'</span>: row_count,
        <span class="json-string">'size_bytes'</span>: size_bytes,
        <span class="json-string">'columns'</span>: column_stats
    }
                                </div>
                            </div>
                        </div>

                        <div id="postgres-conn" class="tab-content">
                            <div class="section">
                                <div class="section-title">
                                    <span class="section-icon">üêò</span>
                                    –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
                                </div>
                                <div class="data-sample">
<span class="json-key">import</span> psycopg2

<span class="json-key">def</span> _connect_postgresql(jdbc_url: str):
    <span class="json-comment"># –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è JDBC URL –≤ PostgreSQL connection string</span>
    pg_url = jdbc_url.replace(<span class="json-string">'jdbc:postgresql://'</span>, <span class="json-string">'postgresql://'</span>)
    
    connection = psycopg2.connect(pg_url)
    logger.info(<span class="json-string">"‚úÖ Connected to PostgreSQL"</span>)
    <span class="json-key">return</span> connection

<span class="json-comment"># –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ pg_stat</span>
<span class="json-key">def</span> get_table_stats_postgres(conn, schema, table):
    cursor = conn.cursor()
    
    <span class="json-comment"># 1. Row count –∏ size –∏–∑ pg_stat</span>
    cursor.execute(<span class="json-string">f"""
        SELECT 
            reltuples::BIGINT as row_count,
            pg_total_relation_size('{schema}.{table}')::BIGINT as size_bytes
        FROM pg_class c
        JOIN pg_namespace n ON n.oid = c.relnamespace
        WHERE c.relname = '{table}' AND n.nspname = '{schema}'
    """</span>)
    row_count, size_bytes = cursor.fetchone()
    
    <span class="json-comment"># 2. Column statistics</span>
    cursor.execute(<span class="json-string">f"""
        SELECT 
            attname,
            n_distinct,
            null_frac
        FROM pg_stats
        WHERE schemaname = '{schema}' AND tablename = '{table}'
    """</span>)
    
    column_stats = {}
    <span class="json-key">for</span> col_name, n_distinct, null_frac <span class="json-key">in</span> cursor.fetchall():
        column_stats[col_name] = {
            <span class="json-string">'cardinality'</span>: abs(int(n_distinct * row_count)) <span class="json-key">if</span> n_distinct < <span class="json-number">0</span> <span class="json-key">else</span> int(n_distinct),
            <span class="json-string">'null_percent'</span>: null_frac * <span class="json-number">100</span>
        }
    
    <span class="json-key">return</span> {
        <span class="json-string">'row_count'</span>: row_count,
        <span class="json-string">'size_bytes'</span>: size_bytes,
        <span class="json-string">'columns'</span>: column_stats
    }
                                </div>
                            </div>
                        </div>

                        <div id="mysql-conn" class="tab-content">
                            <div class="section">
                                <div class="section-title">
                                    <span class="section-icon">üê¨</span>
                                    –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MySQL
                                </div>
                                <div class="data-sample">
<span class="json-key">import</span> mysql.connector

<span class="json-key">def</span> _connect_mysql(jdbc_url: str):
    parsed = urlparse(jdbc_url.replace(<span class="json-string">'jdbc:mysql://'</span>, <span class="json-string">'http://'</span>))
    params = parse_qs(parsed.query)
    
    connection = mysql.connector.connect(
        host=parsed.hostname,
        port=parsed.port <span class="json-key">or</span> <span class="json-number">3306</span>,
        user=params.get(<span class="json-string">'user'</span>, [<span class="json-string">'root'</span>])[<span class="json-number">0</span>],
        password=params.get(<span class="json-string">'password'</span>, [<span class="json-string">''</span>])[<span class="json-number">0</span>],
        database=parsed.path.lstrip(<span class="json-string">'/'</span>)
    )
    
    logger.info(<span class="json-string">"‚úÖ Connected to MySQL"</span>)
    <span class="json-key">return</span> connection

<span class="json-comment"># –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ INFORMATION_SCHEMA</span>
<span class="json-key">def</span> get_table_stats_mysql(conn, database, table):
    cursor = conn.cursor()
    
    <span class="json-comment"># 1. Table size</span>
    cursor.execute(<span class="json-string">f"""
        SELECT 
            TABLE_ROWS,
            DATA_LENGTH + INDEX_LENGTH as size_bytes
        FROM INFORMATION_SCHEMA.TABLES
        WHERE TABLE_SCHEMA = '{database}' 
        AND TABLE_NAME = '{table}'
    """</span>)
    row_count, size_bytes = cursor.fetchone()
    
    <span class="json-comment"># 2. Column cardinality (approximate)</span>
    cursor.execute(<span class="json-string">f"""
        SELECT COLUMN_NAME, CARDINALITY
        FROM INFORMATION_SCHEMA.STATISTICS
        WHERE TABLE_SCHEMA = '{database}' 
        AND TABLE_NAME = '{table}'
        GROUP BY COLUMN_NAME
    """</span>)
    
    column_stats = {}
    <span class="json-key">for</span> col, card <span class="json-key">in</span> cursor.fetchall():
        column_stats[col] = {<span class="json-string">'cardinality'</span>: card <span class="json-key">or</span> <span class="json-number">0</span>}
    
    <span class="json-key">return</span> {
        <span class="json-string">'row_count'</span>: row_count,
        <span class="json-string">'size_bytes'</span>: size_bytes,
        <span class="json-string">'columns'</span>: column_stats
    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="architecture-diagram">
                        <div class="diagram-title">üìä –°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏</div>
                        <div class="features-grid">
                            <div class="feature-item">
                                <div class="feature-icon">üìè</div>
                                <div>
                                    <div class="feature-text">Row Count</div>
                                    <div class="feature-desc">SELECT COUNT(*) FROM table</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üíæ</div>
                                <div>
                                    <div class="feature-text">Table Size</div>
                                    <div class="feature-desc">Compressed bytes (DATA + INDEX)</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üî¢</div>
                                <div>
                                    <div class="feature-text">Cardinality</div>
                                    <div class="feature-desc">APPROX_DISTINCT per column</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">‚ö†Ô∏è</div>
                                <div>
                                    <div class="feature-text">NULL Percent</div>
                                    <div class="feature-desc">–î–æ–ª—è NULL –∑–Ω–∞—á–µ–Ω–∏–π</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üóÇÔ∏è</div>
                                <div>
                                    <div class="feature-text">Partitions</div>
                                    <div class="feature-desc">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π (Iceberg)</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üìä</div>
                                <div>
                                    <div class="feature-text">Column Types</div>
                                    <div class="feature-desc">Data types –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="success-box">
                        <strong>‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:</strong>
                        <div class="data-sample" style="margin-top: 10px;">
{
  <span class="json-key">"catalog"</span>: <span class="json-string">"hive"</span>,
  <span class="json-key">"schema"</span>: <span class="json-string">"public"</span>,
  <span class="json-key">"table"</span>: <span class="json-string">"users"</span>,
  <span class="json-key">"row_count"</span>: <span class="json-number">5000000</span>,
  <span class="json-key">"size_bytes"</span>: <span class="json-number">2147483648</span>,
  <span class="json-key">"partitions"</span>: <span class="json-number">365</span>,
  <span class="json-key">"columns"</span>: {
    <span class="json-string">"user_id"</span>: {<span class="json-key">"type"</span>: <span class="json-string">"BIGINT"</span>, <span class="json-key">"cardinality"</span>: <span class="json-number">5000000</span>, <span class="json-key">"null_percent"</span>: <span class="json-number">0.0</span>},
    <span class="json-string">"created_at"</span>: {<span class="json-key">"type"</span>: <span class="json-string">"TIMESTAMP"</span>, <span class="json-key">"cardinality"</span>: <span class="json-number">365</span>, <span class="json-key">"null_percent"</span>: <span class="json-number">0.1</span>},
    <span class="json-string">"status"</span>: {<span class="json-key">"type"</span>: <span class="json-string">"VARCHAR"</span>, <span class="json-key">"cardinality"</span>: <span class="json-number">5</span>, <span class="json-key">"null_percent"</span>: <span class="json-number">2.3</span>}
  }
}
                        </div>
                    </div>
                </div>

                <div class="center-connector">
                    <div class="center-icon">üì°</div>
                    <div class="connector-label">JDBC</div>
                    <div class="connector-label">Statistics</div>
                </div>

                <div class="step-card">
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü:</strong>
                        <ul class="details-list" style="margin-top: 10px;">
                            <li><strong>APPROX_DISTINCT –≤–º–µ—Å—Ç–æ COUNT(DISTINCT):</strong> –î–ª—è —Ç–∞–±–ª–∏—Ü >1M —Å—Ç—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HyperLogLog</li>
                            <li><strong>Sampling –¥–ª—è NULL percent:</strong> –ê–Ω–∞–ª–∏–∑ 10% —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ —Å–∫–∞–Ω–∞</li>
                            <li><strong>Metadata-only queries:</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (pg_stats, INFORMATION_SCHEMA)</li>
                            <li><strong>–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:</strong> –î–æ 3 –º–µ—Ç—Ä–∏–∫ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</li>
                            <li><strong>–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞ 1 —á–∞—Å</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 4: LLM ANALYSIS - COMPREHENSIVE -->
        <div class="pipeline-step" style="animation-delay: 0.4s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">4</div>
                        <div class="card-title">
                            <h2>üß† LLM Strategy Analysis</h2>
                            <p>–ê–Ω–∞–ª–∏–∑ —Å—Ö–µ–º—ã –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏<span class="timeline-badge badge-warning">Nvidia Nemotron</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">ü§ñ</span>
                            –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LLM –º–æ–¥–µ–ª–µ–π
                        </div>
                        <div class="data-sample">
<span class="json-comment"># llm_analyzer.py</span>

<span class="json-key">class</span> LLMAnalyzer:
    <span class="json-key">def</span> __init__(self):
        <span class="json-comment"># –ú–æ–¥–µ–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ DDL –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</span>
        self.analysis_model = <span class="json-string">"nvidia/nemotron-nano-9b-v2"</span>
        
        <span class="json-comment"># –ú–æ–¥–µ–ª—å –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞</span>
        self.evaluation_model = <span class="json-string">"google/gemini-2.5-flash-preview-09-2025"</span>
        
        <span class="json-comment"># API –∫–ª–∏–µ–Ω—Ç (OpenRouter)</span>
        self.client = OpenAI(
            base_url=<span class="json-string">"https://openrouter.ai/api/v1"</span>,
            api_key=os.getenv(<span class="json-string">"OPEN_ROUTER"</span>)
        )
        
        <span class="json-comment"># –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</span>
        self.temperature = <span class="json-number">0.1</span>  <span class="json-comment"># –ù–∏–∑–∫–∞—è –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞</span>
        self.max_tokens = <span class="json-number">4000</span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üìã</span>
                            System Prompt –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ö–µ–º—ã
                        </div>
                        <div class="data-sample">
<span class="json-key">SYSTEM_PROMPT_ANALYSIS</span> = <span class="json-string">"""
You are a database optimization expert specializing in Apache Iceberg 
and Trino query engines.

Your task: Analyze table schemas and suggest optimal partitioning and 
clustering strategies.

Rules for partitioning:
1. Maximum 2 partition columns
2. High cardinality columns (>10 unique values)
3. Frequently used in WHERE clauses
4. Priority: TIMESTAMP > DATE > ID columns

Rules for clustering:
1. Maximum 4 cluster columns
2. Medium cardinality (5-1000 unique values)
3. Used in JOINs or GROUP BY
4. Avoid low cardinality (<5 values)

Output: JSON with partition_columns, cluster_columns, and reasoning.
"""</span>

<span class="json-comment"># –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞</span>
response = client.chat.completions.create(
    model=self.analysis_model,
    messages=[
        {<span class="json-string">"role"</span>: <span class="json-string">"system"</span>, <span class="json-string">"content"</span>: SYSTEM_PROMPT_ANALYSIS},
        {<span class="json-string">"role"</span>: <span class="json-string">"user"</span>, <span class="json-string">"content"</span>: table_stats_json}
    ],
    temperature=<span class="json-number">0.1</span>,
    max_tokens=<span class="json-number">2000</span>
)
                        </div>
                    </div>

                    <div class="comparison-grid">
                        <div class="comparison-box">
                            <div class="comparison-title">üì§ Input –¥–ª—è LLM</div>
                            <div class="data-sample">
{
  <span class="json-key">"tables"</span>: [{
    <span class="json-string">"table_name"</span>: <span class="json-string">"users"</span>,
    <span class="json-string">"row_count"</span>: <span class="json-number">5000000</span>,
    <span class="json-string">"size_bytes"</span>: <span class="json-number">2147483648</span>,
    <span class="json-string">"columns"</span>: [
      {
        <span class="json-string">"name"</span>: <span class="json-string">"user_id"</span>,
        <span class="json-string">"type"</span>: <span class="json-string">"BIGINT"</span>,
        <span class="json-string">"cardinality"</span>: <span class="json-number">5000000</span>,
        <span class="json-string">"null_percent"</span>: <span class="json-number">0</span>
      },
      {
        <span class="json-string">"name"</span>: <span class="json-string">"created_at"</span>,
        <span class="json-string">"type"</span>: <span class="json-string">"TIMESTAMP"</span>,
        <span class="json-string">"cardinality"</span>: <span class="json-number">365</span>,
        <span class="json-string">"null_percent"</span>: <span class="json-number">0.1</span>
      },
      {
        <span class="json-string">"name"</span>: <span class="json-string">"status"</span>,
        <span class="json-string">"type"</span>: <span class="json-string">"VARCHAR"</span>,
        <span class="json-string">"cardinality"</span>: <span class="json-number">5</span>,
        <span class="json-string">"null_percent"</span>: <span class="json-number">2.3</span>
      }
    ]
  }],
  <span class="json-key">"queries"</span>: [{
    <span class="json-string">"query"</span>: <span class="json-string">"SELECT * FROM users WHERE created_at > ..."</span>,
    <span class="json-string">"frequency"</span>: <span class="json-number">1000</span>
  }]
}
                            </div>
                        </div>

                        <div class="comparison-box">
                            <div class="comparison-title">üì• Output –æ—Ç LLM</div>
                            <div class="data-sample">
{
  <span class="json-key">"tables_analysis"</span>: [{
    <span class="json-string">"table_name"</span>: <span class="json-string">"users"</span>,
    <span class="json-string">"partition_columns"</span>: [
      <span class="json-string">"created_at"</span>
    ],
    <span class="json-string">"cluster_columns"</span>: [
      <span class="json-string">"user_id"</span>,
      <span class="json-string">"status"</span>
    ],
    <span class="json-string">"reasoning"</span>: <span class="json-string">"created_at has 365 
    unique values, perfect for daily 
    partitioning. user_id (5M cardinality) 
    is ideal for clustering. status has 
    low cardinality (5) but is frequently 
    used in WHERE clauses."</span>
  }],
  <span class="json-key">"optimization_strategy"</span>: <span class="json-string">"Use 
  time-based partitioning for efficient 
  partition pruning. Cluster by user_id 
  for fast point lookups."</span>
}
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üîÑ</span>
                            Retry –ª–æ–≥–∏–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
                        </div>
                        <div class="data-sample">
<span class="json-key">def</span> _call_with_retries(self, system_prompt, user_input, max_retries=<span class="json-number">3</span>):
    <span class="json-string">"""LLM –≤—ã–∑–æ–≤ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏"""</span>
    
    <span class="json-key">for</span> attempt <span class="json-key">in</span> range(max_retries):
        <span class="json-key">try</span>:
            response = self.client.chat.completions.create(
                model=self.analysis_model,
                messages=[
                    {<span class="json-string">"role"</span>: <span class="json-string">"system"</span>, <span class="json-string">"content"</span>: system_prompt},
                    {<span class="json-string">"role"</span>: <span class="json-string">"user"</span>, <span class="json-string">"content"</span>: user_input}
                ],
                temperature=<span class="json-number">0.1</span>,
                max_tokens=<span class="json-number">2000</span>
            )
            
            <span class="json-comment"># –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –ø–∞—Ä—Å–∏–Ω–≥ JSON</span>
            content = response.choices[<span class="json-number">0</span>].message.content
            json_str = self._extract_json(content)
            result = json.loads(json_str)
            
            logger.info(<span class="json-string">f"‚úÖ LLM call successful (attempt {attempt+1})"</span>)
            <span class="json-key">return</span> result
            
        <span class="json-key">except</span> json.JSONDecodeError <span class="json-key">as</span> e:
            logger.warning(<span class="json-string">f"‚ö†Ô∏è JSON parse error (attempt {attempt+1}): {e}"</span>)
            <span class="json-key">if</span> attempt == max_retries - <span class="json-number">1</span>:
                <span class="json-key">raise</span> LLMAnalyzerError(<span class="json-string">"Failed to parse LLM response"</span>)
            time.sleep(<span class="json-number">2</span> ** attempt)  <span class="json-comment"># Exponential backoff</span>
            
        <span class="json-key">except</span> Exception <span class="json-key">as</span> e:
            logger.error(<span class="json-string">f"‚ùå LLM call failed (attempt {attempt+1}): {e}"</span>)
            <span class="json-key">if</span> attempt == max_retries - <span class="json-number">1</span>:
                <span class="json-key">raise</span>
            time.sleep(<span class="json-number">2</span> ** attempt)
                        </div>
                    </div>

                    <div class="info-box">
                        <strong>üí° –†–æ–±–∞—Å—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ JSON:</strong> LLM –∏–Ω–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å markdown –±–ª–æ–∫–∞–º–∏, trailing commas –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–º –¥–æ/–ø–æ—Å–ª–µ. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ _extract_json() –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —á–∏—Å—Ç–æ–≥–æ JSON —á–µ—Ä–µ–∑ regex –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∫–æ–±–æ–∫.
                    </div>
                </div>

                <div class="center-connector">
                    <div class="center-icon">üß†</div>
                    <div class="connector-label">OpenRouter API</div>
                    <div class="connector-label">Strategy</div>
                </div>

                <div class="step-card">
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üéØ</span>
                            –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                        </div>
                        <div class="process-flow">
                            <div class="process-step">
                                <div class="process-number">1</div>
                                <div class="process-text">
                                    <strong>–ü–∞—Ä—Ç–∏—Ü–∏–∏:</strong> Max 2 –∫–æ–ª–æ–Ω–∫–∏, cardinality >10, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç TIMESTAMP > DATE > ID
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="process-number">2</div>
                                <div class="process-text">
                                    <strong>–ö–ª–∞—Å—Ç–µ—Ä—ã:</strong> Max 4 –∫–æ–ª–æ–Ω–∫–∏, cardinality 5-1000, —á–∞—Å—Ç–æ –≤ WHERE/JOIN
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="process-number">3</div>
                                <div class="process-text">
                                    <strong>–ö–æ–º–ø—Ä–µ—Å—Å–∏—è:</strong> ZSTD –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (–ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç—å/—Ä–∞–∑–º–µ—Ä)
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="process-number">4</div>
                                <div class="process-text">
                                    <strong>–§–æ—Ä–º–∞—Ç:</strong> Iceberg –¥–ª—è time-travel, ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, schema evolution
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="process-number">5</div>
                                <div class="process-text">
                                    <strong>–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:</strong> –í–∫–ª—é—á–µ–Ω–∞ –¥–ª—è SIMD —É—Å–∫–æ—Ä–µ–Ω–∏—è —á—Ç–µ–Ω–∏—è Parquet —Ñ–∞–π–ª–æ–≤
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 5: DDL GENERATION - TEMPLATE BASED -->
        <div class="pipeline-step" style="animation-delay: 0.5s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">5</div>
                        <div class="card-title">
                            <h2>üî® DDL Generation Engine</h2>
                            <p>–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö DDL<span class="timeline-badge">Template-Based</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üìê</span>
                            –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥: LLM + Template
                        </div>
                        <div class="data-sample">
<span class="json-comment"># llm_analyzer.py - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DDL</span>

<span class="json-key">def</span> _generate_optimized_ddl(
    table_analysis: Dict,
    original_ddl: str,
    catalog_name: str,
    schema_name: str
) -> str:
    <span class="json-string">"""
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ DDL –Ω–∞ –æ—Å–Ω–æ–≤–µ:
    1. LLM –∞–Ω–∞–ª–∏–∑–∞ (–ø–∞—Ä—Ç–∏—Ü–∏–∏, –∫–ª–∞—Å—Ç–µ—Ä—ã)
    2. –í–∞–ª–∏–¥–Ω–æ–≥–æ SQL —à–∞–±–ª–æ–Ω–∞
    3. –†–µ–∞–ª—å–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –∏–∑ original_ddl
    """</span>
    
    <span class="json-comment"># –®–∞–≥ 1: –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ DDL —á–µ—Ä–µ–∑ SQLglot</span>
    parsed = sqlglot.parse_one(original_ddl, dialect=<span class="json-string">"trino"</span>)
    table_name = parsed.find(sqlglot.exp.Table).name
    
    <span class="json-comment"># –®–∞–≥ 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫</span>
    columns = []
    <span class="json-key">for</span> col_def <span class="json-key">in</span> parsed.find_all(sqlglot.exp.ColumnDef):
        columns.append({
            <span class="json-string">'name'</span>: col_def.name,
            <span class="json-string">'type'</span>: col_def.kind.sql()
        })
    
    <span class="json-comment"># –®–∞–≥ 3: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ columns SQL</span>
    columns_sql = <span class="json-string">",\n  "</span>.join([
        <span class="json-string">f"{col['name']} {col['type']}"</span> 
        <span class="json-key">for</span> col <span class="json-key">in</span> columns
    ])
    
    <span class="json-comment"># –®–∞–≥ 4: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π LLM</span>
    partition_cols = table_analysis.get(<span class="json-string">'partition_columns'</span>, [])
    cluster_cols = table_analysis.get(<span class="json-string">'cluster_columns'</span>, [])
    
    <span class="json-comment"># –®–∞–≥ 5: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ WITH clause</span>
    with_parts = [
        <span class="json-string">"format = 'ICEBERG'"</span>,
    ]
    
    <span class="json-key">if</span> partition_cols:
        parts_str = <span class="json-string">", "</span>.join([<span class="json-string">f"'{c}'"</span> <span class="json-key">for</span> c <span class="json-key">in</span> partition_cols])
        with_parts.append(<span class="json-string">f"partitioning = ARRAY[{parts_str}]"</span>)
    
    <span class="json-key">if</span> cluster_cols:
        cluster_str = <span class="json-string">", "</span>.join([<span class="json-string">f"'{c}'"</span> <span class="json-key">for</span> c <span class="json-key">in</span> cluster_cols])
        with_parts.append(<span class="json-string">f"sorted_by = ARRAY[{cluster_str}]"</span>)
    
    <span class="json-comment"># –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π</span>
    with_parts.extend([
        <span class="json-string">"'write.compression-codec' = 'ZSTD'"</span>,
        <span class="json-string">"'write.target-file-size-bytes' = '268435456'"</span>,  <span class="json-comment"># 256MB</span>
        <span class="json-string">"'read.vectorization.enabled' = 'true'"</span>,
        <span class="json-string">"'write.parquet.compression-codec' = 'ZSTD'"</span>,
        <span class="json-string">"'write.parquet.page-size-bytes' = '1048576'"</span>,      <span class="json-comment"># 1MB</span>
        <span class="json-string">"'write.parquet.row-group-size-bytes' = '134217728'"</span> <span class="json-comment"># 128MB</span>
    ])
    
    with_clause = <span class="json-string">",\n  "</span>.join(with_parts)
    
    <span class="json-comment"># –®–∞–≥ 6: –§–∏–Ω–∞–ª—å–Ω—ã–π DDL</span>
    ddl = <span class="json-string">f"""CREATE TABLE {catalog_name}.{schema_name}.{table_name} (
  {columns_sql}
) WITH (
  {with_clause}
)"""</span>
    
    <span class="json-key">return</span> ddl
                        </div>
                    </div>

                    <div class="architecture-diagram">
                        <div class="diagram-title">üîÑ –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DDL</div>
                        <div class="flow-diagram">
                            <div class="flow-box">
                                <div style="font-size: 2em; margin-bottom: 10px;">üìã</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Original DDL</div>
                                <div style="font-size: 0.85em; color: #94a3b8;">CREATE TABLE users...</div>
                            </div>
                            <div class="flow-arrow">‚Üí</div>
                            <div class="flow-box">
                                <div style="font-size: 2em; margin-bottom: 10px;">üå≥</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">SQLglot Parse</div>
                                <div style="font-size: 0.85em; color: #94a3b8;">AST extraction</div>
                            </div>
                            <div class="flow-arrow">‚Üí</div>
                            <div class="flow-box">
                                <div style="font-size: 2em; margin-bottom: 10px;">üß†</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">LLM Strategy</div>
                                <div style="font-size: 0.85em; color: #94a3b8;">Partition/Cluster</div>
                            </div>
                            <div class="flow-arrow">‚Üí</div>
                            <div class="flow-box">
                                <div style="font-size: 2em; margin-bottom: 10px;">üî®</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Template Engine</div>
                                <div style="font-size: 0.85em; color: #94a3b8;">Valid SQL generation</div>
                            </div>
                            <div class="flow-arrow">‚Üí</div>
                            <div class="flow-box">
                                <div style="font-size: 2em; margin-bottom: 10px;">‚úÖ</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Optimized DDL</div>
                                <div style="font-size: 0.85em; color: #94a3b8;">Iceberg + ZSTD</div>
                            </div>
                        </div>
                    </div>

                    <div class="comparison-grid">
                        <div class="comparison-box">
                            <div class="comparison-title">üìã –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π DDL</div>
                            <div class="data-sample">
CREATE TABLE hive.public.users (
  user_id BIGINT,
  username VARCHAR(255),
  email VARCHAR(255),
  created_at TIMESTAMP,
  status VARCHAR(50)
)
                            </div>
                        </div>

                        <div class="comparison-box">
                            <div class="comparison-title">‚ú® –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π DDL</div>
                            <div class="data-sample">
CREATE TABLE hive.optimized_20241019_a3f2b1.users (
  user_id BIGINT,
  username VARCHAR(255),
  email VARCHAR(255),
  created_at TIMESTAMP,
  status VARCHAR(50)
) WITH (
  format = <span class="json-string">'ICEBERG'</span>,
  partitioning = ARRAY[<span class="json-string">'created_at'</span>],
  sorted_by = ARRAY[<span class="json-string">'user_id'</span>, <span class="json-string">'status'</span>],
  <span class="json-string">'write.compression-codec'</span> = <span class="json-string">'ZSTD'</span>,
  <span class="json-string">'write.target-file-size-bytes'</span> = <span class="json-string">'268435456'</span>,
  <span class="json-string">'read.vectorization.enabled'</span> = <span class="json-string">'true'</span>
)
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üéØ</span>
                            –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Å—Ö–µ–º—ã
                        </div>
                        <div class="data-sample">
<span class="json-key">def</span> _generate_unique_schema_name(catalog_name: str, request_data: Dict) -> str:
    <span class="json-string">"""
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ —Å—Ö–µ–º—ã –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
    –§–æ—Ä–º–∞—Ç: optimized_YYYYMMDDHHMMSS_HASH
    """</span>
    
    <span class="json-comment"># Timestamp –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYYMMDDHHmmSS</span>
    timestamp = datetime.now().strftime(<span class="json-string">"%Y%m%d%H%M%S"</span>)
    
    <span class="json-comment"># –ö–æ—Ä–æ—Ç–∫–∏–π —Ö–µ—à –æ—Ç request_data</span>
    request_str = json.dumps(request_data, sort_keys=<span class="json-key">True</span>)
    short_hash = hashlib.md5(request_str.encode()).hexdigest()[:<span class="json-number">6</span>]
    
    schema_name = <span class="json-string">f"optimized_{timestamp}_{short_hash}"</span>
    
    logger.info(<span class="json-string">f"‚úÖ Generated schema: {catalog_name}.{schema_name}"</span>)
    <span class="json-key">return</span> schema_name

<span class="json-comment"># –ü—Ä–∏–º–µ—Ä—ã:</span>
<span class="json-comment"># optimized_20241019151234_a3f2b1</span>
<span class="json-comment"># optimized_20241019151235_b4e3c2</span>
                        </div>
                    </div>

                    <div class="details-box">
                        <div class="details-title">üí° –ü–æ—á–µ–º—É –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è?</div>
                        <ul class="details-list">
                            <li><strong>–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏:</strong> LLM –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π SQL</li>
                            <li><strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> –®–∞–±–ª–æ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ 10x –±—ã—Å—Ç—Ä–µ–µ —á–µ–º LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è</li>
                            <li><strong>–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:</strong> –û–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li>
                            <li><strong>–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:</strong> –õ–µ–≥–∫–æ –ø–æ–∫—Ä—ã—Ç—å unit-—Ç–µ—Å—Ç–∞–º–∏ –≤—Å–µ edge cases</li>
                            <li><strong>–í–∞–ª–∏–¥–∞—Ü–∏—è:</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SQLglot –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π SQL –Ω–∞ –≤—ã—Ö–æ–¥–µ</li>
                        </ul>
                    </div>
                </div>

                <div class="center-connector">
                    <div class="center-icon">üî®</div>
                    <div class="connector-label">Template</div>
                    <div class="connector-label">Valid SQL</div>
                </div>

                <div class="step-card">
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">‚öôÔ∏è</span>
                            WITH Clause –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                        </div>
                        <div class="features-grid">
                            <div class="feature-item">
                                <div class="feature-icon">‚ùÑÔ∏è</div>
                                <div>
                                    <div class="feature-text">format = 'ICEBERG'</div>
                                    <div class="feature-desc">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π table format</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üì¶</div>
                                <div>
                                    <div class="feature-text">compression = 'ZSTD'</div>
                                    <div class="feature-desc">–õ—É—á—à–µ–µ —Å–∂–∞—Ç–∏–µ/—Å–∫–æ—Ä–æ—Å—Ç—å</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üìè</div>
                                <div>
                                    <div class="feature-text">target-file-size = 256MB</div>
                                    <div class="feature-desc">–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">‚ö°</div>
                                <div>
                                    <div class="feature-text">vectorization = true</div>
                                    <div class="feature-desc">SIMD —É—Å–∫–æ—Ä–µ–Ω–∏–µ</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üìÑ</div>
                                <div>
                                    <div class="feature-text">page-size = 1MB</div>
                                    <div class="feature-desc">Parquet page size</div>
                                </div>
                            </div>
                            <div class="feature-item">
                                <div class="feature-icon">üìä</div>
                                <div>
                                    <div class="feature-text">row-group = 128MB</div>
                                    <div class="feature-desc">Parquet row group</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 6: MIGRATIONS -->
        <div class="pipeline-step" style="animation-delay: 0.6s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">6</div>
                        <div class="card-title">
                            <h2>üîÑ Migration Generator</h2>
                            <p>LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö<span class="timeline-badge badge-warning">LLM Assist</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üì§</span>
                            System Prompt –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
                        </div>
                        <div class="data-sample">
<span class="json-key">SYSTEM_PROMPT_MIGRATIONS</span> = <span class="json-string">"""
Generate comprehensive migration statements to transfer data from old schema 
to new optimized schema.

Requirements:
1. Use FULL table paths: catalog.schema.table
2. Create schema IF NOT EXISTS
3. Include data transfer: INSERT INTO new SELECT * FROM old
4. Add validation queries: COUNT(*) comparison
5. Include rollback plan
6. Use explicit column lists (no SELECT *)

Output format: JSON array of migration objects with:
- statement: SQL command
- description: What this step does
- rollback: How to undo this step
"""</span>

<span class="json-comment"># Input –¥–ª—è LLM</span>
{
  <span class="json-key">"catalog_name"</span>: <span class="json-string">"hive"</span>,
  <span class="json-key">"schema_name"</span>: <span class="json-string">"optimized_20241019_a3f2b1"</span>,
  <span class="json-key">"old_ddl"</span>: [{<span class="json-string">"statement"</span>: <span class="json-string">"CREATE TABLE hive.public.users ..."</span>}],
  <span class="json-key">"new_ddl"</span>: [{<span class="json-string">"statement"</span>: <span class="json-string">"CREATE TABLE hive.optimized.users ..."</span>}]
}
                        </div>
                    </div>

                    <div class="process-flow">
                        <div class="details-title">‚öôÔ∏è –≠—Ç–∞–ø—ã –º–∏–≥—Ä–∞—Ü–∏–∏</div>
                        <div class="process-step">
                            <div class="process-number">1</div>
                            <div class="process-text">
                                <strong>CREATE SCHEMA</strong> - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ö–µ–º—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
                                <div style="font-size: 0.85em; color: #94a3b8; margin-top: 5px;">
                                    CREATE SCHEMA IF NOT EXISTS hive.optimized_20241019_a3f2b1
                                </div>
                            </div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">2</div>
                            <div class="process-text">
                                <strong>CREATE TABLES</strong> - –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –∏–∑ DDL
                                <div style="font-size: 0.85em; color: #94a3b8; margin-top: 5px;">
                                    –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö DDL —Å Iceberg format
                                </div>
                            </div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">3</div>
                            <div class="process-text">
                                <strong>INSERT DATA</strong> - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç–∞—Ä—ã—Ö —Ç–∞–±–ª–∏—Ü
                                <div style="font-size: 0.85em; color: #94a3b8; margin-top: 5px;">
                                    INSERT INTO new_table SELECT col1, col2, ... FROM old_table
                                </div>
                            </div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">4</div>
                            <div class="process-text">
                                <strong>VALIDATE</strong> - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫ –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
                                <div style="font-size: 0.85em; color: #94a3b8; margin-top: 5px;">
                                    SELECT COUNT(*) FROM old = SELECT COUNT(*) FROM new
                                </div>
                            </div>
                        </div>
                        <div class="process-step">
                            <div class="process-number">5</div>
                            <div class="process-text">
                                <strong>ROLLBACK PLAN</strong> - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                                <div style="font-size: 0.85em; color: #94a3b8; margin-top: 5px;">
                                    DROP TABLE new_table; DROP SCHEMA new_schema;
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üìú</span>
                            –ü—Ä–∏–º–µ—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
                        </div>
                        <div class="data-sample">
{
  <span class="json-key">"migrations"</span>: [
    {
      <span class="json-string">"statement"</span>: <span class="json-string">"CREATE SCHEMA IF NOT EXISTS hive.optimized_20241019_a3f2b1"</span>,
      <span class="json-string">"description"</span>: <span class="json-string">"Create new schema for optimized tables"</span>,
      <span class="json-string">"rollback"</span>: <span class="json-string">"DROP SCHEMA hive.optimized_20241019_a3f2b1 CASCADE"</span>
    },
    {
      <span class="json-string">"statement"</span>: <span class="json-string">"CREATE TABLE hive.optimized_20241019_a3f2b1.users (...)"</span>,
      <span class="json-string">"description"</span>: <span class="json-string">"Create optimized users table with Iceberg format"</span>,
      <span class="json-string">"rollback"</span>: <span class="json-string">"DROP TABLE hive.optimized_20241019_a3f2b1.users"</span>
    },
    {
      <span class="json-string">"statement"</span>: <span class="json-string">"INSERT INTO hive.optimized_20241019_a3f2b1.users 
                  SELECT user_id, username, email, created_at, status 
                  FROM hive.public.users"</span>,
      <span class="json-string">"description"</span>: <span class="json-string">"Copy all data from old to new table"</span>,
      <span class="json-string">"rollback"</span>: <span class="json-string">"TRUNCATE TABLE hive.optimized_20241019_a3f2b1.users"</span>
    },
    {
      <span class="json-string">"statement"</span>: <span class="json-string">"SELECT COUNT(*) FROM hive.public.users"</span>,
      <span class="json-string">"description"</span>: <span class="json-string">"Validate old table row count"</span>,
      <span class="json-string">"rollback"</span>: <span class="json-string">"N/A - validation only"</span>
    },
    {
      <span class="json-string">"statement"</span>: <span class="json-string">"SELECT COUNT(*) FROM hive.optimized_20241019_a3f2b1.users"</span>,
      <span class="json-string">"description"</span>: <span class="json-string">"Validate new table row count"</span>,
      <span class="json-string">"rollback"</span>: <span class="json-string">"N/A - validation only"</span>
    }
  ]
}
                        </div>
                    </div>

                    <div class="warning-box">
                        <strong>‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏:</strong>
                        <ul class="details-list" style="margin-top: 10px;">
                            <li><strong>–Ø–≤–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –∫–æ–ª–æ–Ω–æ–∫:</strong> –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º SELECT * –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –ø–æ—Ä—è–¥–∫–æ–º</li>
                            <li><strong>–ü–æ–ª–Ω—ã–µ –ø—É—Ç–∏ —Ç–∞–±–ª–∏—Ü:</strong> –í—Å–µ–≥–¥–∞ catalog.schema.table –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏</li>
                            <li><strong>IF NOT EXISTS:</strong> –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å - –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ</li>
                            <li><strong>–í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞:</strong> COUNT(*) –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º</li>
                            <li><strong>Rollback –ø–ª–∞–Ω:</strong> –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–º–µ–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –æ—Ç–∫–∞—Ç–∞</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 7: QUERY OPTIMIZATION -->
        <div class="pipeline-step" style="animation-delay: 0.7s">
            <div class="step-wrapper">
                <div class="step-card">
                    <div class="card-header">
                        <div class="step-number">7</div>
                        <div class="card-title">
                            <h2>‚ö° Query Optimizer</h2>
                            <p>SQLglot AST —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏<span class="timeline-badge">AST Transform</span></p>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üå≥</span>
                            SQLglot - –ø–∞—Ä—Å–∏–Ω–≥ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è SQL
                        </div>
                        <div class="data-sample">
<span class="json-key">import</span> sqlglot
<span class="json-key">from</span> sqlglot <span class="json-key">import</span> exp

<span class="json-key">def</span> optimize_query(query: str, catalog: str, schema: str) -> str:
    <span class="json-string">"""–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ AST —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏"""</span>
    
    <span class="json-comment"># 1. –ü–∞—Ä—Å–∏–Ω–≥ SQL –≤ AST</span>
    parsed = sqlglot.parse_one(query, dialect=<span class="json-string">"trino"</span>)
    
    <span class="json-comment"># 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—É—Ç–µ–π —Ç–∞–±–ª–∏—Ü –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</span>
    <span class="json-key">for</span> table <span class="json-key">in</span> parsed.find_all(exp.Table):
        table.set(<span class="json-string">"catalog"</span>, exp.Identifier(this=catalog))
        table.set(<span class="json-string">"db"</span>, exp.Identifier(this=schema))
    
    <span class="json-comment"># 3. –ó–∞–º–µ–Ω–∞ SELECT * –Ω–∞ —è–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏</span>
    <span class="json-key">if</span> _has_select_star(parsed):
        explicit_columns = _get_table_columns(catalog, schema, table_name)
        _replace_select_star(parsed, explicit_columns)
    
    <span class="json-comment"># 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ LIMIT –µ—Å–ª–∏ –Ω–µ—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–π</span>
    <span class="json-key">if not</span> parsed.find(exp.Limit):
        <span class="json-key">if not</span> _is_aggregation(parsed):
            parsed = parsed.limit(<span class="json-number">10000</span>)
            logger.info(<span class="json-string">"‚úÖ Added LIMIT 10000"</span>)
    
    <span class="json-comment"># 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ partition pruning</span>
    where_clause = parsed.find(exp.Where)
    <span class="json-key">if</span> where_clause:
        where_cols = {col.name <span class="json-key">for</span> col <span class="json-key">in</span> where_clause.find_all(exp.Column)}
        <span class="json-key">if</span> <span class="json-string">'created_at'</span> <span class="json-key">in</span> where_cols:
            logger.info(<span class="json-string">"‚úÖ Partition pruning on created_at"</span>)
    
    <span class="json-comment"># 6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SQL</span>
    optimized_sql = parsed.sql(dialect=<span class="json-string">"trino"</span>)
    
    <span class="json-key">return</span> optimized_sql
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">üîç</span>
                            AST –∞–Ω–∞–ª–∏–∑ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
                        </div>
                        <div class="ast-tree">
<span class="json-comment"># –ü—Ä–∏–º–µ—Ä AST –¥–ª—è: SELECT * FROM users WHERE created_at > '2024-01-01'</span>

Select
<div class="tree-node">expressions: [Star]</div>
<div class="tree-node">from: Table
  <div class="tree-node">catalog: Identifier(hive)</div>
  <div class="tree-node">db: Identifier(public)</div>
  <div class="tree-node">this: Identifier(users)</div>
</div>
<div class="tree-node">where: Where
  <div class="tree-node">this: GT (GreaterThan)
    <div class="tree-node">left: Column(created_at)</div>
    <div class="tree-node">right: Literal('2024-01-01')</div>
  </div>
</div>

<span class="json-comment"># –ü–æ—Å–ª–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏:</span>
Select
<div class="tree-node">expressions: [Column(user_id), Column(username), Column(email), ...]</div>
<div class="tree-node">from: Table
  <div class="tree-node">catalog: Identifier(hive)</div>
  <div class="tree-node">db: Identifier(optimized_20241019_a3f2b1)</div>
  <div class="tree-node">this: Identifier(users)</div>
</div>
<div class="tree-node">where: Where ...</div>
<div class="tree-node">limit: Limit
  <div class="tree-node">expression: Literal(10000)</div>
</div>
                        </div>
                    </div>

                    <div class="tab-container">
                        <div class="tabs">
                            <button class="tab active" onclick="switchTab(event, 'opt-select-star')">SELECT *</button>
                            <button class="tab" onclick="switchTab(event, 'opt-limit')">LIMIT</button>
                            <button class="tab" onclick="switchTab(event, 'opt-paths')">Table Paths</button>
                            <button class="tab" onclick="switchTab(event, 'opt-partition')">Partition Pruning</button>
                        </div>

                        <div id="opt-select-star" class="tab-content active">
                            <div class="comparison-grid">
                                <div class="comparison-box">
                                    <div class="comparison-title">‚ùå –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</div>
                                    <div class="data-sample">
SELECT * 
FROM users 
WHERE created_at > TIMESTAMP '2024-01-01'
                                    </div>
                                    <div style="margin-top: 10px; color: #f87171; font-size: 0.9em;">
                                        ‚ö†Ô∏è SELECT * –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –∏ —Å–ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã
                                    </div>
                                </div>

                                <div class="comparison-box">
                                    <div class="comparison-title">‚úÖ –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</div>
                                    <div class="data-sample">
SELECT 
  user_id, 
  username, 
  email, 
  created_at, 
  status
FROM hive.optimized_20241019_a3f2b1.users
WHERE created_at > TIMESTAMP '2024-01-01'
                                    </div>
                                    <div style="margin-top: 10px; color: #34d399; font-size: 0.9em;">
                                        ‚úÖ –Ø–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫, —É—Å—Ç–æ–π—á–∏–≤ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Å—Ö–µ–º—ã
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="opt-limit" class="tab-content">
                            <div class="comparison-grid">
                                <div class="comparison-box">
                                    <div class="comparison-title">‚ùå –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</div>
                                    <div class="data-sample">
SELECT user_id, username 
FROM users
                                    </div>
                                    <div style="margin-top: 10px; color: #f87171; font-size: 0.9em;">
                                        ‚ö†Ô∏è –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã —Å—Ç—Ä–æ–∫ –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
                                    </div>
                                </div>

                                <div class="comparison-box">
                                    <div class="comparison-title">‚úÖ –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</div>
                                    <div class="data-sample">
SELECT user_id, username 
FROM hive.optimized_20241019_a3f2b1.users
LIMIT <span class="json-number">10000</span>
                                    </div>
                                    <div style="margin-top: 10px; color: #34d399; font-size: 0.9em;">
                                        ‚úÖ LIMIT 10000 –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                                    </div>
                                </div>
                            </div>
                            <div class="info-box" style="margin-top: 15px;">
                                <strong>üí° –ö–æ–≥–¥–∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è LIMIT:</strong> –ó–∞–ø—Ä–æ—Å—ã —Å –∞–≥—Ä–µ–≥–∞—Ü–∏—è–º–∏ (COUNT, SUM, AVG), GROUP BY, HAVING —É–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                            </div>
                        </div>

                        <div id="opt-paths" class="tab-content">
                            <div class="section">
                                <div class="section-title">
                                    <span class="section-icon">üéØ</span>
                                    –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π —Ç–∞–±–ª–∏—Ü
                                </div>
                                <div class="data-sample">
<span class="json-comment"># –ú–µ—Ç–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—É—Ç–µ–π —á–µ—Ä–µ–∑ AST</span>

<span class="json-key">for</span> table <span class="json-key">in</span> parsed.find_all(sqlglot.exp.Table):
    original_path = table.sql()
    
    <span class="json-comment"># –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ —Å—Ö–µ–º—ã</span>
    table.set(<span class="json-string">"catalog"</span>, sqlglot.exp.Identifier(this=<span class="json-string">"hive"</span>))
    table.set(<span class="json-string">"db"</span>, sqlglot.exp.Identifier(this=<span class="json-string">"optimized_20241019_a3f2b1"</span>))
    
    new_path = table.sql()
    logger.info(<span class="json-string">f"‚úÖ Rewritten: {original_path} ‚Üí {new_path}"</span>)

<span class="json-comment"># –†–µ–∑—É–ª—å—Ç–∞—Ç:</span>
<span class="json-comment"># users ‚Üí hive.optimized_20241019_a3f2b1.users</span>
<span class="json-comment"># public.orders ‚Üí hive.optimized_20241019_a3f2b1.orders</span>
<span class="json-comment"># hive.public.users ‚Üí hive.optimized_20241019_a3f2b1.users</span>
                                </div>
                            </div>
                        </div>

                        <div id="opt-partition" class="tab-content">
                            <div class="section">
                                <div class="section-title">
                                    <span class="section-icon">üóÇÔ∏è</span>
                                    –ü—Ä–æ–≤–µ—Ä–∫–∞ partition pruning
                                </div>
                                <div class="data-sample">
<span class="json-key">def</span> check_partition_pruning(parsed, partition_cols: List[str]) -> Dict:
    <span class="json-string">"""–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –≤ WHERE"""</span>
    
    where = parsed.find(sqlglot.exp.Where)
    <span class="json-key">if not</span> where:
        <span class="json-key">return</span> {<span class="json-string">"pruning"</span>: <span class="json-key">False</span>, <span class="json-string">"reason"</span>: <span class="json-string">"No WHERE clause"</span>}
    
    <span class="json-comment"># –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–æ–∫ –∏–∑ WHERE</span>
    where_columns = {
        col.name 
        <span class="json-key">for</span> col <span class="json-key">in</span> where.find_all(sqlglot.exp.Column)
    }
    
    <span class="json-comment"># –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏</span>
    used_partitions = where_columns.intersection(set(partition_cols))
    
    <span class="json-key">if</span> used_partitions:
        logger.info(<span class="json-string">f"‚úÖ Partition pruning on: {used_partitions}"</span>)
        <span class="json-key">return</span> {
            <span class="json-string">"pruning"</span>: <span class="json-key">True</span>,
            <span class="json-string">"columns"</span>: list(used_partitions),
            <span class="json-string">"benefit"</span>: <span class="json-string">"Reduced data scan"</span>
        }
    <span class="json-key">else</span>:
        logger.warning(<span class="json-string">"‚ö†Ô∏è Full table scan - no partition pruning"</span>)
        <span class="json-key">return</span> {<span class="json-string">"pruning"</span>: <span class="json-key">False</span>, <span class="json-string">"reason"</span>: <span class="json-string">"No partition columns in WHERE"</span>}
                                </div>
                            </div>

                            <div class="success-box" style="margin-top: 15px;">
                                <strong>‚úÖ –ü—Ä–∏–º–µ—Ä —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ partition pruning:</strong>
                                <div class="data-sample" style="margin-top: 10px;">
<span class="json-comment">-- –¢–∞–±–ª–∏—Ü–∞ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ created_at</span>
SELECT * FROM users
WHERE created_at BETWEEN '2024-01-01' AND '2024-01-31'
  AND status = 'active'

<span class="json-comment">-- Trino –ø—Ä–æ—á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–∞—Ä—Ç–∏—Ü–∏–∏ —è–Ω–≤–∞—Ä—è 2024</span>
<span class="json-comment">-- –í–º–µ—Å—Ç–æ –≤—Å–µ—Ö 365 –ø–∞—Ä—Ç–∏—Ü–∏–π, —Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ ~31</span>
<span class="json-comment">-- –£—Å–∫–æ—Ä–µ–Ω–∏–µ: ~12x</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">‚ö°</span>
                            –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
                        </div>
                        <div class="data-sample">
<span class="json-key">def</span> _optimize_queries_parallel(
    queries: List[Dict],
    new_ddl: List[Dict],
    catalog: str,
    schema: str
) -> List[Dict]:
    <span class="json-string">"""–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–æ 6 –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ"""</span>
    
    <span class="json-key">with</span> ThreadPoolExecutor(max_workers=<span class="json-number">6</span>) <span class="json-key">as</span> executor:
        futures = {}
        
        <span class="json-key">for</span> query_obj <span class="json-key">in</span> queries:
            future = executor.submit(
                optimize_single_query,
                query_obj[<span class="json-string">'query'</span>],
                catalog,
                schema
            )
            futures[future] = query_obj[<span class="json-string">'queryid'</span>]
        
        optimized = []
        <span class="json-key">for</span> future <span class="json-key">in</span> as_completed(futures):
            queryid = futures[future]
            <span class="json-key">try</span>:
                result = future.result()
                optimized.append(result)
                logger.info(<span class="json-string">f"‚úÖ Optimized query {queryid}"</span>)
            <span class="json-key">except</span> Exception <span class="json-key">as</span> e:
                logger.error(<span class="json-string">f"‚ùå Failed to optimize {queryid}: {e}"</span>)
                optimized.append({<span class="json-string">"error"</span>: str(e)})
        
        <span class="json-key">return</span> optimized
                        </div>
                    </div>

                    <div class="info-box">
                        <strong>üí° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:</strong> –î–ª—è –±–∞—Ç—á–∞ –∏–∑ 25 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç ~2-3 —Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ ~15 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏. ThreadPoolExecutor —Å 6 –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è I/O-bound –∑–∞–¥–∞—á –ø–∞—Ä—Å–∏–Ω–≥–∞ SQL.
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å–ª–µ–¥—É–µ—Ç... -->

    </div>

    <script>
        function switchTab(event, tabId) {
            const parent = event.currentTarget.closest('.tab-container');
            const contents = parent.getElementsByClassName('tab-content');
            for (let content of contents) {
                content.classList.remove('active');
            }
            
            const tabs = parent.getElementsByClassName('tab');
            for (let tab of tabs) {
                tab.classList.remove('active');
            }
            
            parent.querySelector(`#${tabId}`).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function toggleAll() {
            const allCollapsibles = document.querySelectorAll('.details-box, .info-box, .warning-box, .success-box, .error-box');
            const isAnyHidden = Array.from(allCollapsibles).some(el => el.style.display === 'none');
            
            allCollapsibles.forEach(el => {
                el.style.display = isAnyHidden ? 'block' : (el.style.display === 'block' ? 'none' : 'block');
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
        function copyCode(button) {
            const codeBlock = button.closest('.code-block');
            const codeContent = codeBlock.querySelector('.code-content') || codeBlock.querySelector('.data-sample');
            
            let textToCopy = '';
            if (codeContent) {
                // –ï—Å–ª–∏ –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π, –±–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                const lines = codeContent.querySelectorAll('.line-content');
                if (lines.length > 0) {
                    textToCopy = Array.from(lines).map(line => line.textContent).join('\n');
                } else {
                    textToCopy = codeContent.textContent;
                }
            }
            
            // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            navigator.clipboard.writeText(textToCopy).then(() => {
                // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∏ —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏
                const originalHTML = button.innerHTML;
                button.innerHTML = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
                button.classList.add('copied');
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                button.innerHTML = '‚úó –û—à–∏–±–∫–∞';
                setTimeout(() => {
                    button.innerHTML = 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
                }, 2000);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫
        function toggleWrap(button) {
            const codeBlock = button.closest('.code-block');
            const codeContent = codeBlock.querySelector('.code-content, .data-sample');
            
            if (codeContent) {
                codeContent.classList.toggle('wrap-mode');
                button.classList.toggle('active');
                
                if (button.classList.contains('active')) {
                    button.textContent = '‚Ü©Ô∏è Wrap: ON';
                } else {
                    button.textContent = '‚Ü™Ô∏è Wrap: OFF';
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ –≤—Å–µ–º –±–ª–æ–∫–∞–º –∫–æ–¥–∞
        document.addEventListener('DOMContentLoaded', function() {
            const codeBlocks = document.querySelectorAll('.data-sample');
            codeBlocks.forEach((block, index) => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ –∫–Ω–æ–ø–∫–∏
                if (!block.previousElementSibling || !block.previousElementSibling.classList.contains('code-header')) {
                    // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –±–ª–æ–∫ –∫–æ–¥–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    const wrapper = document.createElement('div');
                    wrapper.className = 'code-block';
                    wrapper.style.position = 'relative';
                    block.parentNode.insertBefore(wrapper, block);
                    
                    // –°–æ–∑–¥–∞—ë–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏
                    const header = document.createElement('div');
                    header.className = 'code-header';
                    header.innerHTML = `
                        <span class="code-language">Code</span>
                        <div style="display: flex; gap: 8px;">
                            <button class="wrap-toggle" onclick="toggleWrap(this)">
                                ‚Ü™Ô∏è Wrap: OFF
                            </button>
                            <button class="copy-button" onclick="copyCode(this)">
                                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    `;
                    
                    wrapper.appendChild(header);
                    
                    // –ü–µ—Ä–µ–Ω–æ—Å–∏–º –±–ª–æ–∫ –∫–æ–¥–∞ –≤–Ω—É—Ç—Ä—å
                    block.classList.add('code-content');
                    wrapper.appendChild(block);
                }
            });
        });
    </script>
</body>
</html>