# üñ•Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è SQL-agent

## üìä –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞

**–¢–µ–∫—É—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã (31.172.73.121):**
- **CPU:** 1 —è–¥—Ä–æ
- **RAM:** 961 MB (~1 GB)
- **–î–∏—Å–∫:** 9.8 GB (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ 4.1 GB)
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** max_workers=10

**–¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º:**
- **–ü–∞–º—è—Ç—å:** ~90 MB (9.1% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π)
- **CPU:** 0.5%

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

### –ü–æ—á–µ–º—É 10 –≤–æ—Ä–∫–µ—Ä–æ–≤ –Ω–µ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

1. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ CPU**
   - 1 —è–¥—Ä–æ –º–æ–∂–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 1-2 –∑–∞–¥–∞—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
   - 10 –≤–æ—Ä–∫–µ—Ä–æ–≤ –±—É–¥—É—Ç –∫–æ–Ω–∫—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞ CPU ‚Üí –≤—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
   - Context switching –∑–∞–º–µ–¥–ª–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ RAM**
   - –ë–∞–∑–æ–≤–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ: ~90 MB
   - –ö–∞–∂–¥–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞–¥–∞—á–∞: ~50-150 MB (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Å—Ö–µ–º—ã)
   - **10 –∑–∞–¥–∞—á = 500-1500 MB –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ**
   - –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ 396 MB ‚Üí **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π OOM (Out of Memory)**

3. **LLM API –∑–∞–ø—Ä–æ—Å—ã**
   - –û–±–ª–∞—á–Ω—ã–π LLM —á–µ—Ä–µ–∑ OpenRouter ‚Üí –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
   - –ù–æ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è 4 –≤–æ—Ä–∫–µ—Ä–æ–≤

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã)

```
CPU:  2 —è–¥—Ä–∞ (vCPU)
RAM:  2 GB
–î–∏—Å–∫: 20 GB SSD
```

**–ü–æ—á–µ–º—É:**
- 2 CPU: –ø–æ 0.5 —è–¥—Ä–∞ –Ω–∞ –≤–æ—Ä–∫–µ—Ä + –∑–∞–ø–∞—Å –¥–ª—è —Å–∏—Å—Ç–µ–º—ã
- 2 GB RAM: 90 MB –±–∞–∑–∞ + 4 √ó 150 MB (–≤–æ—Ä–∫–µ—Ä—ã) + 500 MB —Å–∏—Å—Ç–µ–º–∞ = ~1.5 GB
- 20 GB –¥–∏—Å–∫: –ª–æ–≥–∏, task_logs —Ä–∞—Å—Ç—É—Ç —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ swap
- ‚ö†Ô∏è –ü—Ä–∏ –ø–∏–∫–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –≤–æ–∑–º–æ–∂–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã)

```
CPU:  4 —è–¥—Ä–∞ (vCPU)
RAM:  4 GB
–î–∏—Å–∫: 40 GB SSD
```

**–ü–æ—á–µ–º—É:**
- 4 CPU: –ø–æ 1 —è–¥—Ä—É –Ω–∞ –≤–æ—Ä–∫–µ—Ä ‚Üí –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- 4 GB RAM: –¥–≤–æ–π–Ω–æ–π –∑–∞–ø–∞—Å –¥–ª—è –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- 40 GB –¥–∏—Å–∫: –∑–∞–ø–∞—Å –¥–ª—è –ª–æ–≥–æ–≤, –±—ç–∫–∞–ø–æ–≤, –±—É–¥—É—â–µ–≥–æ —Ä–æ—Å—Ç–∞

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ö–µ–º (40+ —Ç–∞–±–ª–∏—Ü)
- ‚úÖ –ó–∞–ø–∞—Å –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ 6-8 –≤–æ—Ä–∫–µ—Ä–æ–≤

---

### –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏)

```
CPU:  8 —è–¥–µ—Ä (vCPU)
RAM:  8 GB
–î–∏—Å–∫: 100 GB SSD
```

**–ü–æ—á–µ–º—É:**
- 8 CPU: –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 8-10 –≤–æ—Ä–∫–µ—Ä–æ–≤
- 8 GB RAM: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 10+ –∑–∞–¥–∞—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- 100 GB –¥–∏—Å–∫: –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –∏ –∏—Å—Ç–æ—Ä–∏–∏

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ 8-10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ 50+ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å
- ‚úÖ –ù—É–ª–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–∞–∂–µ –ø—Ä–∏ –ø–∏–∫–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä (1 CPU, 1 GB RAM)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–º–µ–Ω—å—à–∏—Ç—å –¥–æ 2 –≤–æ—Ä–∫–µ—Ä–æ–≤

```python
# –í —Ñ–∞–π–ª–µ sql_agent/api.py —Å—Ç—Ä–æ–∫–∞ 164
task_manager = SimpleTaskManager(
    max_workers=2,              # ‚Üê –ò–∑–º–µ–Ω–∏—Ç—å —Å 10 –Ω–∞ 2
    task_timeout_minutes=15,
    use_llm=True,
    max_queue_size=50,          # ‚Üê –£–º–µ–Ω—å—à–∏—Ç—å –æ—á–µ—Ä–µ–¥—å
    cleanup_after_hours=72
)
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```bash
ssh root@31.172.73.121
cd /opt/sql-agent
nano sql_agent/api.py  # –ò–∑–º–µ–Ω–∏—Ç—å max_workers –Ω–∞ 2
systemctl restart sql-agent
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ OOM
- ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö (–æ—á–µ—Ä–µ–¥—å)
- ‚ö†Ô∏è 2 –∑–∞–¥–∞—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤–º–µ—Å—Ç–æ 4

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–ø–≥—Ä–µ–π–¥ –¥–æ 2 CPU, 2 GB RAM

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å 4 –≤–æ—Ä–∫–µ—Ä–∞

```python
task_manager = SimpleTaskManager(
    max_workers=4,              # ‚Üê –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ 4
    task_timeout_minutes=15,
    use_llm=True,
    max_queue_size=100,
    cleanup_after_hours=72
)
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
```bash
# –í–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
ssh root@31.172.73.121
apt-get install -y htop iotop

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å swap (–µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç RAM)
fallocate -l 2G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo '/swapfile none swap sw 0 0' >> /etc/fstab
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- ‚úÖ –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ê–ø–≥—Ä–µ–π–¥ –¥–æ 4 CPU, 4 GB RAM (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```python
task_manager = SimpleTaskManager(
    max_workers=6,              # ‚Üê 6 –≤–æ—Ä–∫–µ—Ä–æ–≤ (—Å –∑–∞–ø–∞—Å–æ–º)
    task_timeout_minutes=15,
    use_llm=True,
    max_queue_size=100,
    cleanup_after_hours=72
)
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
```python
# –í main.py - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ uvicorn
uvicorn.run(
    app,
    host="0.0.0.0",
    port=8001,
    workers=1,                  # –û—Å—Ç–∞–≤–∏—Ç—å 1 worker –¥–ª—è uvicorn
    timeout_keep_alive=300,
    limit_concurrency=200,      # –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 500
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ 6 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ó–∞–ø–∞—Å –¥–ª—è —Ä–æ—Å—Ç–∞ –Ω–∞–≥—Ä—É–∑–∫–∏

---

## üìà –†–∞—Å—á–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ –Ω–∞–≥—Ä—É–∑–∫–µ

### –§–æ—Ä–º—É–ª–∞ –¥–ª—è CPU

```
CPU_cores = max_workers √ó 0.5 + 1 (—Å–∏—Å—Ç–µ–º–∞)
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- 2 –≤–æ—Ä–∫–µ—Ä–∞: 2 √ó 0.5 + 1 = **2 —è–¥—Ä–∞**
- 4 –≤–æ—Ä–∫–µ—Ä–∞: 4 √ó 0.5 + 1 = **3 —è–¥—Ä–∞** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 4)
- 8 –≤–æ—Ä–∫–µ—Ä–æ–≤: 8 √ó 0.5 + 1 = **5 —è–¥–µ—Ä** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 8)

### –§–æ—Ä–º—É–ª–∞ –¥–ª—è RAM

```
RAM_GB = base_memory + (max_workers √ó memory_per_task) + system_overhead
       = 0.2 GB + (max_workers √ó 0.15 GB) + 0.5 GB
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- 2 –≤–æ—Ä–∫–µ—Ä–∞: 0.2 + (2 √ó 0.15) + 0.5 = **1 GB**
- 4 –≤–æ—Ä–∫–µ—Ä–∞: 0.2 + (4 √ó 0.15) + 0.5 = **1.3 GB** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2 GB)
- 8 –≤–æ—Ä–∫–µ—Ä–æ–≤: 0.2 + (8 √ó 0.15) + 0.5 = **1.9 GB** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 4 GB)

---

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–∞

```bash
ssh root@31.172.73.121

# –£–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ SQL-agent
# –î–æ–±–∞–≤–∏—Ç—å –≤ /etc/systemd/system/sql-agent.service:
[Service]
Nice=-5
IOSchedulingClass=realtime
IOSchedulingPriority=0
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Python

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Python
cd /opt/sql-agent
source venv/bin/activate
pip install --upgrade pip setuptools wheel

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Å–∫–æ—Ä–∏—Ç–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
pip install ujson  # –ë—ã—Å—Ç—Ä—ã–π JSON –ø–∞—Ä—Å–µ—Ä
pip install uvloop  # –ë—ã—Å—Ç—Ä—ã–π event loop (—É–∂–µ –µ—Å—Ç—å)
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
apt-get install -y htop iotop sysstat

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
htop
iotop

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ CPU
mpstat 1 10

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏
vmstat 1 10
```

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∞–ø–≥—Ä–µ–π–¥–∞ (–ø—Ä–∏–º–µ—Ä–Ω—ã–µ —Ü–µ–Ω—ã)

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | Fornex (RU) | Hetzner (EU) | DigitalOcean (US) |
|--------------|-------------|--------------|-------------------|
| **1 CPU, 1 GB** | ~300 ‚ÇΩ/–º–µ—Å | ~5 ‚Ç¨/–º–µ—Å | ~$6/–º–µ—Å |
| **2 CPU, 2 GB** | ~500 ‚ÇΩ/–º–µ—Å | ~10 ‚Ç¨/–º–µ—Å | ~$12/–º–µ—Å |
| **4 CPU, 4 GB** | ~900 ‚ÇΩ/–º–µ—Å | ~20 ‚Ç¨/–º–µ—Å | ~$24/–º–µ—Å |
| **8 CPU, 8 GB** | ~1800 ‚ÇΩ/–º–µ—Å | ~40 ‚Ç¨/–º–µ—Å | ~$48/–º–µ—Å |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ —Å–ª—É—á–∞—è

### –î–ª—è 4 –≤–æ—Ä–∫–µ—Ä–æ–≤ –∏ –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:

**–ú–∏–Ω–∏–º—É–º:** 2 CPU, 2 GB RAM (—Å —É–º–µ–Ω—å—à–µ–Ω–∏–µ–º max_workers –¥–æ 4)
**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** 4 CPU, 4 GB RAM (–¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã)

### –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ë–µ–∑ –∞–ø–≥—Ä–µ–π–¥–∞ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

```bash
# 1. –£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–æ 2
ssh root@31.172.73.121
cd /opt/sql-agent
nano sql_agent/api.py
# –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫—É 165: max_workers=2

# 2. –°–æ–∑–¥–∞—Ç—å swap —Ñ–∞–π–ª
fallocate -l 1G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo '/swapfile none swap sw 0 0' >> /etc/fstab

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
systemctl restart sql-agent

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
curl https://skripkahack.ru/health
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –° –∞–ø–≥—Ä–µ–π–¥–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ê–ø–≥—Ä–µ–π–¥–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å Fornex:
#    - CPU: 4 —è–¥—Ä–∞
#    - RAM: 4 GB
#    - –î–∏—Å–∫: 40 GB SSD

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å 4-6 –≤–æ—Ä–∫–µ—Ä–æ–≤
ssh root@31.172.73.121
cd /opt/sql-agent
nano sql_agent/api.py
# –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫—É 165: max_workers=6

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
systemctl restart sql-agent

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
curl https://skripkahack.ru/health
free -h
nproc
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
cat > /usr/local/bin/monitor_sql_agent.sh << 'EOF'
#!/bin/bash
echo "=== $(date) ==="
echo "CPU cores: $(nproc)"
echo "RAM total: $(free -h | grep Mem | awk '{print $2}')"
echo "RAM used: $(free -h | grep Mem | awk '{print $3}')"
echo "SQL-agent memory: $(ps aux | grep 'python.*main.py' | grep -v grep | awk '{print $6/1024 " MB"}')"
echo "Active workers: $(curl -s http://127.0.0.1:8001/metrics | jq '.tasks.running')"
echo ""
EOF

chmod +x /usr/local/bin/monitor_sql_agent.sh

# –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
echo "*/5 * * * * /usr/local/bin/monitor_sql_agent.sh >> /var/log/sql-agent-monitor.log" | crontab -
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ü–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ (2-4-8)
- [ ] –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º
- [ ] –ê–ø–≥—Ä–µ–π–¥–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å swap
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å max_workers –≤ api.py
- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ —Ä–µ—Å—É—Ä—Å–æ–≤

---

**–ò—Ç–æ–≥–æ:** –î–ª—è **4 —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤** —Å **–±—ã—Å—Ç—Ä—ã–º –æ—Ç–≤–µ—Ç–æ–º** –Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º **2 CPU –∏ 2 GB RAM**, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è **4 CPU –∏ 4 GB RAM**.

