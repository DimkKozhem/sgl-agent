# üöÄ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ SQL-agent

## –°–µ—Ä–≤–µ—Ä

- **IP –∞–¥—Ä–µ—Å:** 31.172.73.121
- **–î–æ–º–µ–Ω:** https://skripkahack.ru
- **SSH:** `ssh root@31.172.73.121`
- **–û–°:** Ubuntu 24.04 (Linux 6.8.0-83-generic)

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: 19 –æ–∫—Ç—è–±—Ä—è 2025

### ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Python 3.12** —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º
2. **Nginx** (reverse proxy —Å SSL)
3. **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç** –æ—Ç Let's Encrypt (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ 17 —è–Ω–≤–∞—Ä—è 2026)
4. **Systemd —Å–µ—Ä–≤–∏—Å** –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. **–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python** –∏–∑ requirements.txt

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
/opt/sql-agent/
‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ .env                   # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (API –∫–ª—é—á–∏)
‚îú‚îÄ‚îÄ venv/                  # –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python
‚îú‚îÄ‚îÄ sql_agent/             # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ datasets/              # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ static/                # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ logs/                  # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ä–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–π —á–∞—Å)
‚îî‚îÄ‚îÄ task_logs/             # –õ–æ–≥–∏ –∑–∞–¥–∞—á (–∏—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
```

### üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**Nginx:** `/etc/nginx/conf.d/domains/skripkahack.ru.conf`
- HTTP ‚Üí HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç
- Proxy pass –Ω–∞ –ø–æ—Ä—Ç 8001
- –¢–∞–π–º–∞—É—Ç—ã: 900s –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞: 100MB

**Systemd:** `/etc/systemd/system/sql-agent.service`
- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ systemd journal

### üåê API Endpoints

–í—Å–µ endpoints –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ HTTPS:

- **Health Check:** https://skripkahack.ru/health
- **Metrics:** https://skripkahack.ru/metrics
- **–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞:** POST https://skripkahack.ru/new
- **–°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏:** GET https://skripkahack.ru/status?task_id={id}
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** GET https://skripkahack.ru/getresult?task_id={id}

### üìä –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# Health check
curl https://skripkahack.ru/health

# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
curl -X POST https://skripkahack.ru/new \
  -H "Content-Type: application/json" \
  -d @datasets/linear_schema.json

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl "https://skripkahack.ru/status?task_id=<ID>"

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
curl "https://skripkahack.ru/getresult?task_id=<ID>"
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh root@31.172.73.121

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
systemctl status sql-agent

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (real-time)
journalctl -u sql-agent -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
systemctl restart sql-agent

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
systemctl stop sql-agent

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
systemctl start sql-agent

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Nginx
nginx -t
systemctl status nginx
```

### –õ–æ–≥–∏

**–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```bash
cd /opt/sql-agent
tail -f logs/sql_agent_*.log
```

**–õ–æ–≥–∏ Nginx:**
```bash
tail -f /var/log/nginx/sql-agent-access.log
tail -f /var/log/nginx/sql-agent-error.log
```

**Systemd –ª–æ–≥–∏:**
```bash
journalctl -u sql-agent -n 100 --no-pager
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ HTTPS —Å –≤–∞–ª–∏–¥–Ω—ã–º SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (certbot timer)
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ localhost:8001
- ‚úÖ Nginx –∫–∞–∫ reverse proxy (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
- ‚úÖ API –∫–ª—é—á–∏ –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º .env —Ñ–∞–π–ª–µ (chmod 600)
- ‚úÖ Firewall –ø—Ä–∞–≤–∏–ª–∞ (–ø–æ—Ä—Ç—ã 80, 443 –æ—Ç–∫—Ä—ã—Ç—ã, 8001 –∑–∞–∫—Ä—ã—Ç)

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@31.172.73.121

# 2. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd /opt/sql-agent

# 3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
systemctl stop sql-agent

# 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ git pull)
# –∏–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

# 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å)
source venv/bin/activate
pip install -r requirements.txt
deactivate

# 6. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
systemctl start sql-agent

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
systemctl status sql-agent
curl https://skripkahack.ru/health
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
curl -s https://skripkahack.ru/health | jq .

# –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
curl -s https://skripkahack.ru/metrics | jq .

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
systemctl status sql-agent

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
top -p $(pgrep -f "python.*main.py")
```

### –í–∞–∂–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **Uptime:** –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- **Tasks total:** –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–¥–∞—á
- **Queue size:** –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ (max 100)
- **Error rate:** –ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫
- **Memory usage:** –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

## ‚ö†Ô∏è Troubleshooting

### –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
journalctl -u sql-agent -n 50 --no-pager

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cd /opt/sql-agent
cat .env

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
ls -la /opt/sql-agent

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
cd /opt/sql-agent
source venv/bin/activate
python main.py
```

### 502 Bad Gateway

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
systemctl status sql-agent

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–ª—É—à–∞–µ—Ç –ª–∏ –ø–æ—Ä—Ç 8001
netstat -tlnp | grep 8001

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Nginx
tail -50 /var/log/nginx/sql-agent-error.log
```

### SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å—Ç—ë–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
certbot certificates

# –û–±–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é
certbot renew

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Nginx
systemctl reload nginx
```

## üìù –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ **HestiaCP** - —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∏–Ω–≥–æ–º. 
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SQL-agent —Ä–∞–∑–º–µ—â–µ–Ω–∞ –≤ `/etc/nginx/conf.d/domains/` 
–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å HestiaCP.

**–í–∞–∂–Ω–æ:** –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
nginx -t        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
systemctl reload nginx  # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

## üéØ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- Max workers: 10 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á)
- Max queue size: 100 (–∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏)
- Task timeout: 15 –º–∏–Ω—É—Ç
- Connection timeout: 900 —Å–µ–∫—É–Ω–¥ (Nginx)

**–û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ~10-30 –∑–∞–¥–∞—á –≤ –º–∏–Ω—É—Ç—É (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 100 –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –∫–∞–∂–¥—ã–π —á–∞—Å

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl -I https://skripkahack.ru
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: HTTP/2 200

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Health
curl https://skripkahack.ru/health
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å JSON —Å–æ status: "healthy"

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Metrics
curl https://skripkahack.ru/metrics
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å JSON —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL
echo | openssl s_client -connect skripkahack.ru:443 -servername skripkahack.ru 2>/dev/null | openssl x509 -noout -dates
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞—Ç—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```

---

**–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:** 19 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.2.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

