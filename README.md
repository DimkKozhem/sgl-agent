# üöÄ SQL-agent | –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

<div align="center">

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞**

[![Production Server](https://img.shields.io/badge/production-skripkahack.ru-success?style=for-the-badge)](https://skripkahack.ru)
[![Production Ready](https://img.shields.io/badge/status-ready-success?style=for-the-badge)](.)
[![Tests](https://img.shields.io/badge/tests-19%2F19%20passing-success?style=for-the-badge)](tests/)
[![Python](https://img.shields.io/badge/python-3.8%2B-blue?style=for-the-badge)](.)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.118-009688?style=for-the-badge)](.)

**[–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)** ‚Ä¢ **[Production —Å–µ—Ä–≤–µ—Ä](https://skripkahack.ru)** ‚Ä¢ **[Pipeline –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è](https://skripkahack.ru/static/pipeline.html)** ‚Ä¢ **[API](#-api-reference)** ‚Ä¢ **[Deployment](#-production-deployment)**

---

### üéØ –ü—Ä–æ–±–ª–µ–º–∞

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î —Ç—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–æ–π —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã, –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –∑–Ω–∞–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ –°–£–ë–î.

### ‚ú® –†–µ—à–µ–Ω–∏–µ

SQL-agent –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∞—à—É –ë–î –∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é** —Å –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏.

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

```
‚ö° –ó–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–µ–µ –≤ 5-10 —Ä–∞–∑
üíæ –î–∞–Ω–Ω—ã–µ –º–µ–Ω—å—à–µ –≤ 2-3 —Ä–∞–∑–∞  
üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞ 5 –º–∏–Ω—É—Ç
üñ•Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ GPU
```

</div>

---

## üìñ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

**–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**
- [–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ](#-—á—Ç–æ-—ç—Ç–æ) ‚Äî –°—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç) ‚Äî 3 –∫–æ–º–∞–Ω–¥—ã, 5 –º–∏–Ω—É—Ç
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è) ‚Äî –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

**–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
- [–õ–æ–∫–∞–ª—å–Ω—ã–π LLM –Ω–∞ Nvidia L4](#-–ª–æ–∫–∞–ª—å–Ω—ã–π-llm-–Ω–∞-nvidia-l4) ‚Äî –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- [Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#-production-deployment) ‚Äî Docker, K8s, Systemd

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#Ô∏è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞) ‚Äî –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ –≤–Ω—É—Ç—Ä–∏
- [–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã](#-–∞–ª–≥–æ—Ä–∏—Ç–º-—Ä–∞–±–æ—Ç—ã) ‚Äî 5-—à–∞–≥–æ–≤—ã–π –ø–∞–π–ø–ª–∞–π–Ω
- [LLM –º–æ–¥–µ–ª–∏](#-llm-–º–æ–¥–µ–ª–∏) ‚Äî Analysis + Evaluation
- [API Reference](#-api-reference) ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

**–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:**
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥) ‚Äî –õ–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, health checks
- [Troubleshooting](#-troubleshooting) ‚Äî –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- [FAQ](#-faq) ‚Äî –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- [–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó –õ–¶–¢ 2025](#-—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º-—Ç–∑-–ª—Ü—Ç-2025) ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

---

## üåü –ß—Ç–æ —ç—Ç–æ?

**SQL-agent** ‚Äî —ç—Ç–æ REST API —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –æ–±—ã—á–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º.

**–ö–ª—é—á–µ–≤–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∞—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ 95% –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–æ–¥–µ—Ä–∂–∞—Ç JOIN —Ç—Ä–µ—Ö —Ç–∞–±–ª–∏—Ü, —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –∏—Ö –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –∏ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤ 5-10 —Ä–∞–∑.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É –ë–î
curl -X POST http://localhost:8001/new -d @datasets/linear_schema.json

# 2. –ü–æ–ª—É—á–∞–µ—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é —Å:
#    ‚úÖ ICEBERG —Ñ–æ—Ä–º–∞—Ç–æ–º
#    ‚úÖ –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ –¥–∞—Ç–∞–º
#    ‚úÖ –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π –ø–æ –∫–ª—é—á–∞–º
#    ‚úÖ –ì–æ—Ç–æ–≤—ã–º–∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
#    ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
```

### üéÅ –ß—Ç–æ –ø–æ–ª—É—á–∏—Ç–µ

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
```sql
-- –û–±—ã—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
CREATE TABLE sales.public.orders (
  order_id INTEGER,
  user_id INTEGER,
  amount DECIMAL(10,2),
  order_date DATE
)

-- –ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å (12 —Å–µ–∫—É–Ω–¥)
SELECT * FROM sales.public.orders 
WHERE order_date >= '2024-01-01'
```

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
```sql
-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤ –Ω–æ–≤–æ–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ
CREATE TABLE sales.optimized_20241018_a3f2b1.orders (
  order_id INTEGER,
  user_id INTEGER,
  amount DECIMAL(10,2),
  order_date DATE
) WITH (
  format = 'ICEBERG',                    -- —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
  partitioning = ARRAY['order_date'],    -- ‚ö° —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
  clustering = ARRAY['order_id'],        -- üéØ —É—Å–∫–æ—Ä–µ–Ω–∏–µ JOIN
  'write.compression-codec' = 'ZSTD',    -- üíæ —ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞
  'read.vectorization.enabled' = 'true'  -- üöÄ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
)

-- –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—Ä–æ—Å (1.2 —Å–µ–∫—É–Ω–¥—ã) ‚Äî –≤ 10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!
SELECT order_id, user_id, amount, order_date 
FROM sales.optimized_20241018_a3f2b1.orders 
WHERE order_date >= DATE '2024-01-01'
LIMIT 10000
```

**–†–µ–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚ö° **5-10x –±—ã—Å—Ç—Ä–µ–µ** ‚Äî –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–∞–º (partition pruning)
- üíæ **2-3x –º–µ–Ω—å—à–µ** ‚Äî –∫–æ–º–ø—Ä–µ—Å—Å–∏—è ZSTD –≤–º–µ—Å—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–∂–∞—Ç–∏—è
- üéØ **1.5-2x –±—ã—Å—Ç—Ä–µ–µ JOIN** ‚Äî –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª—é—á–∞–º
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ** ‚Äî —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### üéØ –î–ª—è –∫–æ–≥–æ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç

**–û—Å–Ω–æ–≤–Ω–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:**

üë®‚Äçüíª **Data Engineers**
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ETL/ELT-–ø–∞–π–ø–ª–∞–π–Ω–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –≤ Iceberg, S3, Spark
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

üèóÔ∏è **Data Architects**
- –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- –†–µ—à–µ–Ω–∏—è –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é, —Ñ–æ—Ä–º–∞—Ç–∞–º —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –ø–æ–¥—Ö–æ–¥–æ–≤, –∏–∑–±–µ–∂–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ª–≥–∞

‚öôÔ∏è **Data Platform Teams**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (Trino, Spark, S3)
- –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç–æ–∏–º–æ—Å—Ç–∏, –Ω–∞–≥—Ä—É–∑–∫–∏, SLA
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ "—Ç—è–∂—ë–ª—ã—Ö" –∑–∞–ø—Ä–æ—Å–æ–≤

**–í—Ç–æ—Ä–∏—á–Ω–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:**

üìä **–ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö / BI-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏**
- –ù–∞–ø–∏—Å–∞–Ω–∏–µ SQL –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤ –∏ –¥–∞—à–±–æ—Ä–¥–æ–≤
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ –≤–ª–∏—è–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –≥–ª—É–±–æ–∫–∏—Ö –∑–Ω–∞–Ω–∏–π Spark/Iceberg

**–û—Å–æ–±–µ–Ω–Ω–æ —Ü–µ–Ω–µ–Ω –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π —Å Data Lakehouse (S3 + Iceberg + Trino/Spark), –≥–¥–µ —Ä–æ—Å—Ç –æ–±—ä—ë–º–æ–≤ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ä–æ—Å—Ç—É —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.**

---

## üí° –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### üß† –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- **LLM-–∞–Ω–∞–ª–∏–∑** —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä** —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –∫–∞—á–µ—Å—Ç–≤–∞ (analysis + evaluation –º–æ–¥–µ–ª–∏)

### üéØ –†–µ–∞–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ **ICEBERG —Ñ–æ—Ä–º–∞—Ç** –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º
- ‚úÖ **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ –¥–∞—Ç–∞–º –∏–∑ WHERE —É—Å–ª–æ–≤–∏–π
- ‚úÖ **–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è** –ø–æ –∫–ª—é—á–∞–º –∏–∑ JOIN –∏ GROUP BY
- ‚úÖ **–ö–æ–º–ø—Ä–µ—Å—Å–∏—è ZSTD** –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ (2-3x –º–µ–Ω—å—à–µ)
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤** (SELECT * ‚Üí —è–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏, LIMIT, —Ç–∏–ø—ã)
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó –õ–¶–¢ 2025:** –ø–æ–ª–Ω—ã–µ –ø—É—Ç–∏ `catalog.schema.table`, CREATE SCHEMA –∫–∞–∫ –ø–µ—Ä–≤–∞—è –∫–æ–º–∞–Ω–¥–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ queryid

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∏–∑–æ–ª—è—Ü–∏—è
- **–£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: `optimized_20241018151234_hash`
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Ä–∏—Å–∫–∞ –¥–ª—è production
- –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –≤–µ—Ä—Å–∏—è–º –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

### ‚öôÔ∏è Production-ready
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–¥–æ 10 –∑–∞–¥–∞—á –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- ‚úÖ –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (–¥–æ 100 –≤ –æ–∂–∏–¥–∞–Ω–∏–∏)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã (15 –º–∏–Ω—É—Ç –Ω–∞ –∑–∞–¥–∞—á—É)
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –∫–∞–∂–¥—ã–π —á–∞—Å
- ‚úÖ Health checks –∏ –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ CORS –∏ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ 19/19 unit-—Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ

### üñ•Ô∏è –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Nvidia L4 GPU (24GB VRAM)
- ‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ù–∏–∑–∫–∞—è latency (50-100ms vs 200-500ms –≤ –æ–±–ª–∞–∫–µ)
- ‚úÖ –í—ã—Å–æ–∫–∏–π throughput (30-50 –∑–∞–¥–∞—á/–º–∏–Ω vs 10 –∑–∞–¥–∞—á/–º–∏–Ω)

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### üåê –í–∞—Ä–∏–∞–Ω—Ç 0: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π Production —Å–µ—Ä–≤–µ—Ä (–°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π!)

**SQL-agent —É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
curl https://skripkahack.ru/health

# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
curl -X POST https://skripkahack.ru/new \
  -H "Content-Type: application/json" \
  -d @datasets/linear_schema.json

# ‚Üí {"taskid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"}
```

**–ì–æ—Ç–æ–≤–æ!** üéâ –ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [QUICKSTART.md](QUICKSTART.md) | [DEPLOYMENT.md](DEPLOYMENT.md)

---

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

- **Python 3.8+**
- **–û–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:**
  - **–í–∞—Ä–∏–∞–Ω—Ç A:** API key –¥–ª—è –æ–±–ª–∞—á–Ω–æ–≥–æ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞)
  - **–í–∞—Ä–∏–∞–Ω—Ç B:** Nvidia GPU –∫–ª–∞—Å—Å–∞ L4/L40S/A100 (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è)

### –í–∞—Ä–∏–∞–Ω—Ç A: –° –æ–±–ª–∞—á–Ω—ã–º LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd sql-agent

# 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–∞
echo "OPEN_ROUTER=your-api-key" > .env

# 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python main.py
```

**–ì–æ—Ç–æ–≤–æ!** üéâ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8001

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:**
```bash
curl http://localhost:8001/health
# ‚Üí {"status": "healthy", "version": "1.2.0", ...}
```

---

### –í–∞—Ä–∏–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω–æ –Ω–∞ GPU

**–¢—Ä–µ–±—É–µ—Ç:** Nvidia L4 (24GB VRAM), CUDA 12.0+, 32GB+ RAM

–°–º. [–ø–æ–ª–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é](#-–ª–æ–∫–∞–ª—å–Ω—ã–π-llm-–Ω–∞-nvidia-l4) –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ vLLM —Å–µ—Ä–≤–µ—Ä–∞.

**–ö—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è:**
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ó–∞–ø—É—Å–∫ vLLM —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ GPU
python -m vllm.entrypoints.openai.api_server \
  --model nvidia/nemotron-nano-9b-v2 \
  --host 127.0.0.1 \
  --port 8000 \
  --gpu-memory-utilization 0.85

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ó–∞–ø—É—Å–∫ SQL-agent
export OPENAI_API_BASE=http://localhost:8000/v1
export OPENAI_API_KEY=EMPTY
python main.py
```

---

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `datasets/`:**
- `linear_schema.json` ‚Äî –ø—Ä–æ—Å—Ç–∞—è —Å—Ö–µ–º–∞ (4 —Ç–∞–±–ª–∏—Ü—ã, 3 –∑–∞–ø—Ä–æ—Å–∞)
- `star_schema.json` ‚Äî –∑–≤–µ–∑–¥–∞ (—Ñ–∞–∫—Ç—ã + –∏–∑–º–µ—Ä–µ–Ω–∏—è)
- `network_schema.json` ‚Äî —Å–ª–æ–∂–Ω–∞—è —Å–µ—Ç—å —Å–≤—è–∑–µ–π

```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
curl -X POST http://localhost:8001/new \
  -H "Content-Type: application/json" \
  -d @datasets/linear_schema.json

# –û—Ç–≤–µ—Ç: {"taskid": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (–ø–æ–≤—Ç–æ—Ä—è–π—Ç–µ –∫–∞–∂–¥—ã–µ 2-5 —Å–µ–∫—É–Ω–¥)
curl "http://localhost:8001/status?task_id=a1b2c3d4-..."
# ‚Üí {"status": "RUNNING"} ... {"status": "DONE"}

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
curl "http://localhost:8001/getresult?task_id=a1b2c3d4-..." | jq . > result.json
```

---

## üñ•Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–π LLM –Ω–∞ Nvidia L4

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±–ª–∞—á–Ω—ã—Ö API.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–±–ª–∞—á–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä | vLLM –Ω–∞ L4 (–ª–æ–∫–∞–ª—å–Ω–æ) |
|----------|--------------------|-----------------------|
| **Latency** | 200-500ms | **50-100ms** ‚ö° |
| **Throughput** | ~10 –∑–∞–¥–∞—á/–º–∏–Ω | **30-50 –∑–∞–¥–∞—á/–º–∏–Ω** üöÄ |
| **–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å** | –î–∞–Ω–Ω—ã–µ –≤ –æ–±–ª–∞–∫–µ | **–í—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ** üîí |
| **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç** | –¢—Ä–µ–±—É–µ—Ç—Å—è | **–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** üì° |
| **–ù–∞—Å—Ç—Ä–æ–π–∫–∞** | 5 –º–∏–Ω—É—Ç | 1-2 —á–∞—Å–∞ |

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ú–∏–Ω–∏–º—É–º | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
|-----------|---------|---------------|
| **GPU** | Nvidia L4 (24GB) | Nvidia L40S (48GB) |
| **VRAM** | 18 GB | 24 GB |
| **RAM** | 32 GB | 64 GB |
| **–î–∏—Å–∫** | 50 GB | 100 GB SSD |
| **CUDA** | 12.0+ | 12.4+ |
| **–î—Ä–∞–π–≤–µ—Ä** | 535+ | 550+ |

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ GPU
nvidia-smi

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# GPU: NVIDIA L4 (–∏–ª–∏ L40S/A100)
# Memory: 23034 MiB (–∏–ª–∏ –±–æ–ª—å—à–µ)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ CUDA
nvcc --version
# ‚Üí Cuda compilation tools, release 12.4 (–∏–ª–∏ –Ω–æ–≤–µ–µ)
```

**–ï—Å–ª–∏ CUDA –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:**

```bash
# Ubuntu 22.04 / Debian
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-ubuntu2204.pin
sudo mv cuda-ubuntu2204.pin /etc/apt/preferences.d/cuda-repository-pin-600
wget https://developer.download.nvidia.com/compute/cuda/12.4.0/local_installers/cuda-repo-ubuntu2204-12-4-local_12.4.0-550.54.14-1_amd64.deb
sudo dpkg -i cuda-repo-ubuntu2204-12-4-local_12.4.0-550.54.14-1_amd64.deb
sudo cp /var/cuda-repo-ubuntu2204-12-4-local/cuda-*-keyring.gpg /usr/share/keyrings/
sudo apt-get update
sudo apt-get -y install cuda-toolkit-12-4

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ PATH
echo 'export PATH=/usr/local/cuda-12.4/bin:$PATH' >> ~/.bashrc
echo 'export LD_LIBRARY_PATH=/usr/local/cuda-12.4/lib64:$LD_LIBRARY_PATH' >> ~/.bashrc
source ~/.bashrc
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ vLLM

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è vLLM
python3 -m venv vllm-env
source vllm-env/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ vLLM (–ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è 5-10 –º–∏–Ω—É—Ç)
pip install vllm==0.6.0

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
python -c "import vllm; print(f'vLLM {vllm.__version__} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ')"
# ‚Üí vLLM 0.6.0 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
```

### –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏

vLLM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∞–µ—Ç –º–æ–¥–µ–ª—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:

```bash
# –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
python -c "from transformers import AutoModelForCausalLM; \
           AutoModelForCausalLM.from_pretrained('nvidia/nemotron-nano-9b-v2')"
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏:**
- **–†–∞–∑–º–µ—Ä:** ~18GB (FP16)
- **–í—Ä–µ–º—è:** 10-30 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ:** `~/.cache/huggingface/hub/`

### –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ vLLM —Å–µ—Ä–≤–µ—Ä–∞

**–ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–ª—è L4 —Å 24GB VRAM):**

```bash
python -m vllm.entrypoints.openai.api_server \
  --model nvidia/nemotron-nano-9b-v2 \
  --host 127.0.0.1 \
  --port 8000 \
  --tensor-parallel-size 1 \
  --gpu-memory-utilization 0.85 \
  --max-model-len 8192 \
  --dtype float16 \
  --enable-prefix-caching
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--tensor-parallel-size 1` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 1 GPU
- `--gpu-memory-utilization 0.85` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 85% VRAM (~20GB)
- `--max-model-len 8192` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `--dtype float16` ‚Äî –ø–æ–ª—É—Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
- `--enable-prefix-caching` ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –ø—Ä–æ–º–ø—Ç–æ–≤

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏):**

```bash
python -m vllm.entrypoints.openai.api_server \
  --model nvidia/nemotron-nano-9b-v2 \
  --host 127.0.0.1 \
  --port 8000 \
  --tensor-parallel-size 1 \
  --gpu-memory-utilization 0.90 \
  --max-model-len 16384 \
  --dtype float16 \
  --enable-prefix-caching \
  --max-num-batched-tokens 16384 \
  --max-num-seqs 32 \
  --swap-space 16
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--max-num-batched-tokens 16384` ‚Äî –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ batch (–≤—ã—à–µ throughput)
- `--max-num-seqs 32` ‚Äî –¥–æ 32 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- `--swap-space 16` ‚Äî 16GB swap –¥–ª—è overflow

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞:**

```bash
# –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
curl http://localhost:8000/v1/models

# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
# {
#   "object": "list",
#   "data": [{"id": "nvidia/nemotron-nano-9b-v2", ...}]
# }
```

**–õ–æ–≥–∏ vLLM:**
```bash
# –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8000
```

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SQL-agent

```bash
# –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cd /path/to/sql-agent
source venv/bin/activate  # –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ SQL-agent

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ LLM
export OPENAI_API_BASE=http://localhost:8000/v1
export OPENAI_API_KEY=EMPTY

# –ó–∞–ø—É—Å–∫ SQL-agent
python main.py
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```bash
curl http://localhost:8001/health | jq .

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# {
#   "status": "healthy",
#   "components": {
#     "llm": {
#       "status": "configured",
#       "provider": "vllm-local",
#       "model": "nvidia/nemotron-nano-9b-v2"
#     }
#   }
# }
```

### –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –∑–∞–¥–∞—á–∏ —Å –∑–∞–º–µ—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏
time curl -X POST http://localhost:8001/new \
  -H "Content-Type: application/json" \
  -d @datasets/linear_schema.json

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GPU –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
watch -n 1 nvidia-smi
```

**–û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ L4:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏: < 100ms
- –ê–Ω–∞–ª–∏–∑ —Å—Ö–µ–º—ã (4 —Ç–∞–±–ª–∏—Ü—ã): 10-15 —Å–µ–∫—É–Ω–¥
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DDL: < 1 —Å–µ–∫—É–Ω–¥–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π: 5-10 —Å–µ–∫—É–Ω–¥
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤: 5-10 —Å–µ–∫—É–Ω–¥
- –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞: 5-10 —Å–µ–∫—É–Ω–¥
- **–û–±—â–µ–µ –≤—Ä–µ–º—è:** 25-45 —Å–µ–∫—É–Ω–¥

---

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ vLLM (systemd)

–î–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ vLLM –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã —Å–æ–∑–¥–∞–π—Ç–µ `/etc/systemd/system/vllm.service`:

```ini
[Unit]
Description=vLLM OpenAI-compatible API Server
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/opt/vllm
Environment="PATH=/opt/vllm/vllm-env/bin"
Environment="CUDA_VISIBLE_DEVICES=0"
ExecStart=/opt/vllm/vllm-env/bin/python -m vllm.entrypoints.openai.api_server \
  --model nvidia/nemotron-nano-9b-v2 \
  --host 127.0.0.1 \
  --port 8000 \
  --tensor-parallel-size 1 \
  --gpu-memory-utilization 0.85 \
  --max-model-len 8192 \
  --dtype float16 \
  --enable-prefix-caching
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

**–ê–∫—Ç–∏–≤–∞—Ü–∏—è:**

```bash
sudo systemctl daemon-reload
sudo systemctl enable vllm
sudo systemctl start vllm

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status vllm

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo journalctl -u vllm -f
```

---

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö GPU

| GPU | VRAM | FP16 –°–∫–æ—Ä–æ—Å—Ç—å | Batch —Ä–∞–∑–º–µ—Ä | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|-----|------|---------------|--------------|--------------|
| **L4** | 24GB | 50-80 tok/s | 8-16 | ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª—è SQL-agent |
| **L40S** | 48GB | 80-120 tok/s | 32-64 | –î–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (50+ –∑–∞–¥–∞—á/—á–∞—Å) |
| **A100 40GB** | 40GB | 100-150 tok/s | 32-64 | –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –¥–ª—è 9B –º–æ–¥–µ–ª–∏ |
| **H100** | 80GB | 200-300 tok/s | 64-128 | –ò–∑–±—ã—Ç–æ—á–Ω–∞—è, –ª—É—á—à–µ –¥–ª—è 70B+ –º–æ–¥–µ–ª–µ–π |
| **RTX 4090** | 24GB | 60-90 tok/s | 8-16 | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ L4 (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å) |
| **RTX 3090** | 24GB | 40-60 tok/s | 4-8 | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |

**–í—ã–±–æ—Ä GPU:**
- –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Üí RTX 3090/4090
- –î–ª—è production ‚Üí **Nvidia L4** (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å)
- –î–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (100+ –∑–∞–¥–∞—á/—á–∞—Å) ‚Üí L40S –∏–ª–∏ A100

---

### –ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ VRAM

–ï—Å–ª–∏ 24GB –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ INT8 –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—é (~9GB –≤–º–µ—Å—Ç–æ 18GB):

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ AutoGPTQ
pip install auto-gptq

# –ó–∞–ø—É—Å–∫ —Å –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏–µ–π
python -m vllm.entrypoints.openai.api_server \
  --model nvidia/nemotron-nano-9b-v2 \
  --quantization gptq \
  --dtype int8 \
  --gpu-memory-utilization 0.70 \
  --max-model-len 8192
```

**–ö–æ–º–ø—Ä–æ–º–∏—Å—Å:** 
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ GPU —Å 12GB VRAM
- ‚ùå –°–∫–æ—Ä–æ—Å—Ç—å —Å–Ω–∏–∑–∏—Ç—Å—è –¥–æ 30-50 tok/s (vs 50-80 tok/s)
- ‚ùå –ö–∞—á–µ—Å—Ç–≤–æ –Ω–µ–º–Ω–æ–≥–æ —Ö—É–∂–µ

---

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GPU

```bash
# Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
watch -n 1 nvidia-smi

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (power, utilization, clock, voltage, memory, temperature)
nvidia-smi dmon -i 0 -s pucvmet

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)
nvidia-smi --query-gpu=timestamp,name,utilization.gpu,utilization.memory,memory.total,memory.used,temperature.gpu \
  --format=csv -l 5 > gpu_stats.csv
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ:**
- GPU Utilization: 80-95%
- Memory Used: 18-20GB (–∏–∑ 24GB)
- Temperature: 60-75¬∞C
- Power: 50-65W (–∏–∑ 72W max –¥–ª—è L4)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Client  ‚îÇ ‚îÄPOST‚îÄ‚Üí  ‚îÇ  FastAPI Server ‚îÇ ‚îÄasync‚îÄ‚Üí ‚îÇ Task Manager ‚îÇ
‚îÇ          ‚îÇ           ‚îÇ  (REST API)     ‚îÇ           ‚îÇ (Queue+Pool) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚Üë                                                       ‚îÇ
     ‚îÇ                                                       ‚ñº
     ‚îÇ                                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ JSON result ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  LLM Analyzer   ‚îÇ
                                                   ‚îÇ  (5-step flow)  ‚îÇ
                                                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                            ‚îÇ
                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                    ‚ñº                                    ‚ñº
                             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                             ‚îÇ DB Connector ‚îÇ                   ‚îÇ   SQLglot    ‚îÇ
                             ‚îÇ (statistics) ‚îÇ                   ‚îÇ (SQL parser) ‚îÇ
                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

| –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ |
|--------|------------|------------|
| `api.py` | REST API endpoints, CORS, exception handlers | ~411 |
| `task_manager.py` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏, –æ—á–µ—Ä–µ–¥—å, —Ç–∞–π–º–∞—É—Ç—ã, –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ | ~405 |
| `llm_analyzer.py` | LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, –∞–Ω–∞–ª–∏–∑, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è | ~1507 |
| `db_connector.py` | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ | ~278 |
| `models.py` | Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö | ~113 |
| `log_rotator.py` | –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –∫–∞–∂–¥—ã–π —á–∞—Å | ~243 |

**–í—Å–µ–≥–æ:** ~3800 —Å—Ç—Ä–æ–∫ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ Python –∫–æ–¥–∞

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –°–£–ë–î

| –°–£–ë–î | JDBC —Ñ–æ—Ä–º–∞—Ç | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π |
|------|-------------|----------------------|
| **Trino / Presto** | `jdbc:trino://host:port?catalog=name` | ‚úÖ –ü–æ–ª–Ω–∞—è (ICEBERG, –ø–∞—Ä—Ç–∏—Ü–∏–∏, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è) |
| **PostgreSQL** | `jdbc:postgresql://host:port/db` | ‚ö†Ô∏è –ë–∞–∑–æ–≤–∞—è (–±–µ–∑ ICEBERG) |
| **MySQL** | `jdbc:mysql://host:port/db` | ‚ö†Ô∏è –ë–∞–∑–æ–≤–∞—è (–±–µ–∑ ICEBERG) |

**–û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è:** Trino/Presto —Å ICEBERG —Ñ–æ—Ä–º–∞—Ç–æ–º (Data Lakehouse –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### 5-—à–∞–≥–æ–≤—ã–π –ø–∞–π–ø–ª–∞–π–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```
–®–ê–ì 1: –ê–Ω–∞–ª–∏–∑ –ë–î (10-30 —Å–µ–∫)
   ‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏–∑ JDBC URL
   ‚îú‚îÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
   ‚îú‚îÄ –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫, —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö, –∏–Ω–¥–µ–∫—Å—ã
   ‚îî‚îÄ LLM –∞–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ (WHERE, JOIN, GROUP BY)

–®–ê–ì 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DDL (<1 —Å–µ–∫, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
   ‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å—Ö–µ–º—ã: optimized_YYYYMMDDHHMMSS_HASH
   ‚îú‚îÄ ICEBERG —Ñ–æ—Ä–º–∞—Ç —Å –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ (–∏–∑ WHERE –ø–æ –¥–∞—Ç–∞–º)
   ‚îú‚îÄ –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è (–∏–∑ JOIN –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤)
   ‚îî‚îÄ –ö–æ–º–ø—Ä–µ—Å—Å–∏—è ZSTD –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è

–®–ê–ì 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π (5-30 —Å–µ–∫, —á–µ—Ä–µ–∑ LLM)
   ‚îú‚îÄ INSERT INTO –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã SELECT * FROM —Å—Ç–∞—Ä—ã—Ö
   ‚îî‚îÄ SELECT COUNT(*) –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

–®–ê–ì 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (5-20 —Å–µ–∫, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ ThreadPool)
   ‚îú‚îÄ –ó–∞–º–µ–Ω–∞ –ø—É—Ç–µ–π —Ç–∞–±–ª–∏—Ü (old.schema ‚Üí new.optimized_schema)
   ‚îú‚îÄ SELECT * ‚Üí —è–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (—ç–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞)
   ‚îú‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ LIMIT 10000 –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–æ–∫
   ‚îî‚îÄ Partition pruning ('2024-01-01' ‚Üí DATE '2024-01-01')

–®–ê–ì 5: –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (5-10 —Å–µ–∫, –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –º–æ–¥–µ–ª—å)
   ‚îú‚îÄ DDL –∫–∞—á–µ—Å—Ç–≤–æ (0-25 –±–∞–ª–ª–æ–≤)
   ‚îú‚îÄ –ú–∏–≥—Ä–∞—Ü–∏–∏ (0-25 –±–∞–ª–ª–æ–≤)
   ‚îú‚îÄ –ó–∞–ø—Ä–æ—Å—ã (0-25 –±–∞–ª–ª–æ–≤)
   ‚îú‚îÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (0-15 –±–∞–ª–ª–æ–≤)
   ‚îî‚îÄ –•—Ä–∞–Ω–µ–Ω–∏–µ (0-10 –±–∞–ª–ª–æ–≤)
```

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 30-90 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Ç–∏–ø–∏—á–Ω–æ–π —Å—Ö–µ–º—ã (5-20 —Ç–∞–±–ª–∏—Ü)

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É –±–µ–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DDL –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## ü§ñ LLM –ú–æ–¥–µ–ª–∏

### –ú–æ–¥–µ–ª—å –∞–Ω–∞–ª–∏–∑–∞: nvidia/nemotron-nano-9b-v2

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** 9 –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** 128K —Ç–æ–∫–µ–Ω–æ–≤
- **–°–∫–æ—Ä–æ—Å—Ç—å (L4):** 50-80 tokens/sec
- **–†–∞–∑–º–µ—Ä:** 18 GB (FP16), 9 GB (INT8)
- **–ö–∞—á–µ—Å—Ç–≤–æ:** –°–æ–ø–æ—Å—Ç–∞–≤–∏–º–æ —Å GPT-3.5 –Ω–∞ SQL –∑–∞–¥–∞—á–∞—Ö

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—á–∞—è –º–æ–¥–µ–ª—å

**–ü–æ—á–µ–º—É –≤—ã–±—Ä–∞–Ω–∞:**
- ‚úÖ **–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ–¥–Ω–æ–π L4 GPU (24GB VRAM)
- ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è** ‚Äî –Ω–∏–∑–∫–∞—è latency –¥–ª—è production
- ‚úÖ **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è** ‚Äî –æ–±—É—á–µ–Ω–∞ –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Function calling** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON
- ‚úÖ **–û—Ç–∫—Ä—ã—Ç–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è** ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

---

### –ú–æ–¥–µ–ª—å –æ—Ü–µ–Ω–∫–∏: google/gemini-2.5-flash-preview

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** 1M+ —Ç–æ–∫–µ–Ω–æ–≤
- **–°–∫–æ—Ä–æ—Å—Ç—å:** 100-200 tokens/sec
- **–ö–∞—á–µ—Å—Ç–≤–æ:** State-of-the-art

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**

–ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥–µ–ª–∏ (nvidia/nemotron) –ø–æ 5 –∫—Ä–∏—Ç–µ—Ä–∏—è–º:

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –í–µ—Å | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç |
|----------|-----|---------------|
| **DDL –∫–∞—á–µ—Å—Ç–≤–æ** | 25% | –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–π, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏, —Ñ–æ—Ä–º–∞—Ç–∞ |
| **–ú–∏–≥—Ä–∞—Ü–∏–∏** | 25% | –ü–æ–ª–Ω–æ—Ç–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–ª–∏—á–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ |
| **–ó–∞–ø—Ä–æ—Å—ã** | 25% | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | 15% | –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ |
| **–•—Ä–∞–Ω–µ–Ω–∏–µ** | 10% | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞ |

**–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:**
1. üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã LLM
2. üîç **Debugging** ‚Äî –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ (–æ—Ü–µ–Ω–∫–∞ < 50)
3. üìà **–¢—Ä–µ–Ω–¥—ã** ‚Äî –¥–∏–Ω–∞–º–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
4. üêõ **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞** ‚Äî –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ—á–µ–º—É –Ω–∏–∑–∫–∞—è –æ—Ü–µ–Ω–∫–∞
5. ‚öôÔ∏è **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ `logs/sql_agent_*.log`
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `task_logs/{task_id}.json` (–ø–æ–ª–µ `quality_score`)
- ‚ùå **–ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è** —á–µ—Ä–µ–∑ API `/getresult` (—Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó)

**–ü—Ä–∏–º–µ—Ä –æ—Ü–µ–Ω–∫–∏ –∏–∑ –ª–æ–≥–æ–≤:**
```
üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞: 82/100
   üìã DDL –∫–∞—á–µ—Å—Ç–≤–æ: 20/25
   üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏: 22/25
   ‚ö° –ó–∞–ø—Ä–æ—Å—ã: 21/25
   ‚è±Ô∏è  –í—Ä–µ–º—è: 12/15
   üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ: 7/10
```

---

## üì° API Reference

### Workflow

```
POST /new          ‚Üí  {"taskid": "uuid"}           (<100ms)
   ‚Üì
GET /status        ‚Üí  {"status": "RUNNING/DONE"}   (polling –∫–∞–∂–¥—ã–µ 2-5 —Å–µ–∫)
   ‚Üì
GET /getresult     ‚Üí  {ddl, migrations, queries}   (–∫–æ–≥–¥–∞ DONE)
```

---

### POST /new ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

**Request:**
```json
{
  "url": "jdbc:trino://localhost:8080?catalog=mydb",
  "ddl": [
    {"statement": "CREATE TABLE mydb.public.users (id INT, name VARCHAR(100), created_at DATE)"}
  ],
  "queries": [
    {
      "queryid": "user-search",
      "query": "SELECT * FROM mydb.public.users WHERE created_at > '2024-01-01'",
      "runquantity": 500,
      "executiontime": 12
    }
  ]
}
```

**–ü–æ–ª—è –∑–∞–ø—Ä–æ—Å–∞:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑. | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------|----------|
| `url` | string | ‚úÖ | JDBC URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î |
| `ddl` | array | ‚úÖ | –ú–∞—Å—Å–∏–≤ DDL statements —Å **–ø–æ–ª–Ω—ã–º –ø—É—Ç–µ–º** `catalog.schema.table` |
| `ddl[].statement` | string | ‚úÖ | –¢–µ–∫—Å—Ç CREATE TABLE –∫–æ–º–∞–Ω–¥—ã |
| `queries` | array | ‚úÖ | –ú–∞—Å—Å–∏–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ |
| `queries[].queryid` | string | ‚úÖ | **ID –∑–∞–ø—Ä–æ—Å–∞ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è!)** |
| `queries[].query` | string | ‚úÖ | –¢–µ–∫—Å—Ç SQL –∑–∞–ø—Ä–æ—Å–∞ |
| `queries[].runquantity` | number | ‚úÖ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π (–¥–ª—è —Ñ–æ—Ä–º—É–ª—ã –æ—Ü–µ–Ω–∫–∏ Œît) |
| `queries[].executiontime` | number | ‚ö†Ô∏è | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |

**Response:**
```json
{
  "taskid": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
}
```

**HTTP –∫–æ–¥—ã:**
- `200` ‚Äî –ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å
- `400` ‚Äî –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è)
- `500` ‚Äî –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ (–æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞, –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** 
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ DDL –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø–æ–ª–Ω—ã–π –ø—É—Ç—å** `catalog.schema.table`
- `queryid` –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–∏—Å—Ç–µ–º–æ–π –æ—Ü–µ–Ω–∫–∏ –õ–¶–¢ 2025 ‚Äî **—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!**
- –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ —Ñ–æ–Ω–µ (–æ—Ç–≤–µ—Ç < 100ms)

---

### GET /status ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.

**Request:**
```
GET /status?task_id={taskid}
```

**Response:**
```json
{
  "status": "RUNNING"  // –∏–ª–∏ "DONE", "FAILED"
}
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `RUNNING` ‚Äî –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ 2-5 —Å–µ–∫—É–Ω–¥)
- `DONE` ‚Äî –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
- `FAILED` ‚Äî –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ (–¥–µ—Ç–∞–ª–∏ –≤ `/getresult`)

**HTTP –∫–æ–¥—ã:**
- `200` ‚Äî –°—Ç–∞—Ç—É—Å –ø–æ–ª—É—á–µ–Ω
- `404` ‚Äî –ó–∞–¥–∞—á–∞ —Å —Ç–∞–∫–∏–º ID –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- `400` ‚Äî –ü–∞—Ä–∞–º–µ—Ç—Ä `task_id` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

---

### GET /getresult ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (DDL, –º–∏–≥—Ä–∞—Ü–∏–∏, –∑–∞–ø—Ä–æ—Å—ã).

**Request:**
```
GET /getresult?task_id={taskid}
```

**Response (–∫–æ–≥–¥–∞ DONE):**
```json
{
  "ddl": [
    {"statement": "CREATE SCHEMA mydb.optimized_20241018151234_a3f2b1"},
    {
      "statement": "CREATE TABLE mydb.optimized_20241018151234_a3f2b1.users (\n  id INTEGER,\n  name VARCHAR(100),\n  created_at DATE\n) WITH (\n  format = 'ICEBERG',\n  partitioning = ARRAY['created_at'],\n  clustering = ARRAY['id'],\n  'write.compression-codec' = 'ZSTD'\n)"
    }
  ],
  "migrations": [
    {"statement": "INSERT INTO mydb.optimized_20241018151234_a3f2b1.users SELECT * FROM mydb.public.users"},
    {"statement": "SELECT COUNT(*) as validation FROM mydb.optimized_20241018151234_a3f2b1.users"}
  ],
  "queries": [
    {
      "queryid": "user-search",
      "query": "SELECT id, name, created_at FROM mydb.optimized_20241018151234_a3f2b1.users WHERE created_at >= DATE '2024-01-01' LIMIT 10000"
    }
  ]
}
```

**HTTP –∫–æ–¥—ã:**
- `200` ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ
- `202` ‚Äî –ó–∞–¥–∞—á–∞ –µ—â—ë –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (–ø–æ–¥–æ–∂–¥–∏—Ç–µ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ)
- `404` ‚Äî –ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- `500` ‚Äî –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π (–¥–µ—Ç–∞–ª–∏ –≤ response body)

---

**‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó –õ–¶–¢ 2025):**

**1. –ü–µ—Ä–≤–∞—è DDL –∫–æ–º–∞–Ω–¥–∞ ‚Äî –≤—Å–µ–≥–¥–∞ CREATE SCHEMA:**
```sql
CREATE SCHEMA catalog.optimized_TIMESTAMP_HASH
```

**2. –í—Å–µ –ø—É—Ç–∏ ‚Äî –ø–æ–ª–Ω—ã–µ (catalog.schema.table):**
```sql
-- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
CREATE TABLE catalog.optimized_schema.table1 (...)
INSERT INTO catalog.optimized_schema.table1 SELECT * FROM catalog.public.table1
SELECT * FROM catalog.optimized_schema.table1

-- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–ø—Ä–æ–≤–∞–ª–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –õ–¶–¢ 2025)
CREATE TABLE table1 (...)
SELECT * FROM table1
```

**3. queryid —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```json
// –í—Ö–æ–¥–Ω–æ–π –∑–∞–ø—Ä–æ—Å
{"queryid": "0197a0b2-2284-7af8-9012-fcb21e1a9785", "query": "SELECT ..."}

// –í—ã—Ö–æ–¥–Ω–æ–π –∑–∞–ø—Ä–æ—Å (queryid –ò–î–ï–ù–¢–ò–ß–ï–ù!)
{"queryid": "0197a0b2-2284-7af8-9012-fcb21e1a9785", "query": "SELECT ... (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)"}
```

**4. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –õ–¶–¢ 2025):**
1. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Å–µ DDL (–≤ –ø–æ—Ä—è–¥–∫–µ –º–∞—Å—Å–∏–≤–∞) ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
2. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Å–µ migrations (–≤ –ø–æ—Ä—è–¥–∫–µ –º–∞—Å—Å–∏–≤–∞) ‚Üí –ø–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö
3. –ò–∑–º–µ—Ä—è–µ—Ç—Å—è –≤—Ä–µ–º—è queries ‚Üí –æ—Ü–µ–Ω–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π
4. **–¢–∞–π–º–∞—É—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å: 10 –º–∏–Ω—É—Ç** (–µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω ‚Üí –≤—Ä–µ–º—è = 600 —Å–µ–∫)

---

### GET /health ‚Äî Health Check

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

```bash
curl http://localhost:8001/health
```

```json
{
  "status": "healthy",
  "version": "1.2.0",
  "uptime_seconds": 3600,
  "components": {
    "api": "healthy",
    "task_manager": "healthy",
    "llm": {
      "status": "configured",
      "provider": "local",
      "model": "nvidia/nemotron-nano-9b-v2"
    }
  },
  "tasks": {
    "total": 156,
    "running": 3,
    "completed": 142,
    "failed": 4
  }
}
```

---

### GET /metrics ‚Äî –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞.

```bash
curl http://localhost:8001/metrics
```

**–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:**
- Uptime —Å–µ—Ä–≤–∏—Å–∞ (—Å–µ–∫—É–Ω–¥—ã, –º–∏–Ω—É—Ç—ã, —á–∞—Å—ã)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á (total, running, queued, completed, failed)
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ (—Ä–∞–∑–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø–∞–º (timeout, LLM, validation, database)
- –°—Ç–∞—Ç—É—Å LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Python (–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)

```python
import requests
import time

# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
response = requests.post("http://localhost:8001/new", json={
    "url": "jdbc:trino://localhost:8080?catalog=mydb",
    "ddl": [
        {"statement": "CREATE TABLE mydb.public.users (id INT, name VARCHAR(100), created_at DATE)"}
    ],
    "queries": [
        {
            "queryid": "user-search",
            "query": "SELECT * FROM mydb.public.users WHERE created_at > '2024-01-01'",
            "runquantity": 500,
            "executiontime": 12
        }
    ]
})

task_id = response.json()["taskid"]
print(f"‚úÖ –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞: {task_id}")

# –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (polling)
while True:
    status_response = requests.get(f"http://localhost:8001/status?task_id={task_id}")
    status = status_response.json()["status"]
    print(f"üìä –°—Ç–∞—Ç—É—Å: {status}")
    
    if status == "DONE":
        break
    elif status == "FAILED":
        print("‚ùå –ó–∞–¥–∞—á–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å")
        exit(1)
    
    time.sleep(2)  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
result = requests.get(f"http://localhost:8001/getresult?task_id={task_id}").json()

print(f"\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç:")
print(f"   DDL –∫–æ–º–∞–Ω–¥: {len(result['ddl'])}")
print(f"   –ú–∏–≥—Ä–∞—Ü–∏–π: {len(result['migrations'])}")
print(f"   –ó–∞–ø—Ä–æ—Å–æ–≤: {len(result['queries'])}")
print(f"\nüìã –ù–æ–≤–∞—è —Å—Ö–µ–º–∞: {result['ddl'][0]['statement']}")
```

### Bash —Å–∫—Ä–∏–ø—Ç

```bash
#!/bin/bash

# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏–∑ —Ñ–∞–π–ª–∞
TASK_ID=$(curl -s -X POST http://localhost:8001/new \
  -H "Content-Type: application/json" \
  -d @datasets/linear_schema.json | jq -r .taskid)

echo "üìù Task ID: $TASK_ID"

# –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
while true; do
  STATUS=$(curl -s "http://localhost:8001/status?task_id=$TASK_ID" | jq -r .status)
  echo "üìä –°—Ç–∞—Ç—É—Å: $STATUS ($(date +%H:%M:%S))"
  
  if [ "$STATUS" = "DONE" ]; then
    echo "‚úÖ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
    break
  elif [ "$STATUS" = "FAILED" ]; then
    echo "‚ùå –ó–∞–¥–∞—á–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å"
    exit 1
  fi
  
  sleep 2
done

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
curl -s "http://localhost:8001/getresult?task_id=$TASK_ID" | jq . > result_${TASK_ID}.json
echo "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ result_${TASK_ID}.json"

# –í—ã–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
echo ""
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:"
echo "   DDL –∫–æ–º–∞–Ω–¥:  $(jq '.ddl | length' result_${TASK_ID}.json)"
echo "   –ú–∏–≥—Ä–∞—Ü–∏–π:    $(jq '.migrations | length' result_${TASK_ID}.json)"
echo "   –ó–∞–ø—Ä–æ—Å–æ–≤:    $(jq '.queries | length' result_${TASK_ID}.json)"
```

---

## üö¢ Production Deployment

### üåê –ì–æ—Ç–æ–≤—ã–π Production —Å–µ—Ä–≤–µ—Ä

**SQL-agent —É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ!**

**URL:** https://skripkahack.ru  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready  
**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** 4 CPU, 3 GB RAM, 6 workers

#### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

```bash
# Health check
curl https://skripkahack.ru/health

# –ú–µ—Ç—Ä–∏–∫–∏
curl https://skripkahack.ru/metrics

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
curl -X POST https://skripkahack.ru/new \
  -H "Content-Type: application/json" \
  -d @datasets/linear_schema.json
```

#### –î–æ—Å—Ç—É–ø–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

- **DEPLOYMENT.md** ‚Äî –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- **QUICKSTART.md** ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API
- **LOGS_GUIDE.md** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ª–æ–≥–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞
- **SERVER_RESOURCES.md** ‚Äî —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ—Å—É—Ä—Å–∞–º

#### –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:

```bash
# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)
./deploy_to_server.sh

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤
./configure_workers.sh 6

# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
./get_logs.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
./check_server.sh
```

#### SSH –¥–æ—Å—Ç—É–ø:

```bash
ssh root@31.172.73.121

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º
systemctl status sql-agent
systemctl restart sql-agent
journalctl -u sql-agent -f
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)
- ‚úÖ Nginx reverse proxy
- ‚úÖ Systemd –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –∫–∞–∂–¥—ã–π —á–∞—Å

---

### Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**Dockerfile:**
```dockerfile
FROM python:3.11-slim

WORKDIR /app

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
COPY . .

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –ª–æ–≥–æ–≤
RUN mkdir -p logs task_logs

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
ENV PORT=8001

# –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞
EXPOSE 8001

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD python -c "import requests; requests.get('http://localhost:8001/health').raise_for_status()"

# –ó–∞–ø—É—Å–∫
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001"]
```

**–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫:**
```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t sql-agent:1.2.0 .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -d \
  --name sql-agent \
  -p 8001:8001 \
  -e OPEN_ROUTER=your-api-key \
  -v $(pwd)/logs:/app/logs \
  -v $(pwd)/task_logs:/app/task_logs \
  --restart unless-stopped \
  sql-agent:1.2.0

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker logs -f sql-agent

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
curl http://localhost:8001/health
```

---

### Systemd (Linux)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ SQL-agent –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã.

**1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo mkdir -p /opt/sql-agent
sudo chown your-user:your-user /opt/sql-agent

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
cd /opt/sql-agent
git clone <repository-url> .

# –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
echo "OPEN_ROUTER=your-api-key" > .env
```

**2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ `/etc/systemd/system/sql-agent.service`:**

```ini
[Unit]
Description=SQL-agent REST API for Database Optimization
After=network.target
Wants=network-online.target

[Service]
Type=simple
User=your-user
Group=your-user
WorkingDirectory=/opt/sql-agent
Environment="PATH=/opt/sql-agent/venv/bin"
EnvironmentFile=/opt/sql-agent/.env
ExecStart=/opt/sql-agent/venv/bin/uvicorn main:app --host 127.0.0.1 --port 8001
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=sql-agent

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/opt/sql-agent/logs /opt/sql-agent/task_logs

[Install]
WantedBy=multi-user.target
```

**3. –ê–∫—Ç–∏–≤–∞—Ü–∏—è:**
```bash
sudo systemctl daemon-reload
sudo systemctl enable sql-agent
sudo systemctl start sql-agent

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status sql-agent

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo journalctl -u sql-agent -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart sql-agent
```

---

### Kubernetes

**Deployment:**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sql-agent
  namespace: default
spec:
  replicas: 3
  selector:
    matchLabels:
      app: sql-agent
  template:
    metadata:
      labels:
        app: sql-agent
    spec:
      containers:
      - name: sql-agent
        image: your-registry/sql-agent:1.2.0
        ports:
        - containerPort: 8001
          name: http
        env:
        - name: OPEN_ROUTER
          valueFrom:
            secretKeyRef:
              name: sql-agent-secrets
              key: api-key
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "2000m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8001
          initialDelaySeconds: 10
          periodSeconds: 30
          timeoutSeconds: 5
        readinessProbe:
          httpGet:
            path: /health
            port: 8001
          initialDelaySeconds: 5
          periodSeconds: 10
```

**Service:**
```yaml
apiVersion: v1
kind: Service
metadata:
  name: sql-agent-service
spec:
  type: LoadBalancer
  selector:
    app: sql-agent
  ports:
  - port: 80
    targetPort: 8001
    protocol: TCP
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ secret –¥–ª—è API key
kubectl create secret generic sql-agent-secrets \
  --from-literal=api-key=your-api-key

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml

# –ü—Ä–æ–≤–µ—Ä–∫–∞
kubectl get pods -l app=sql-agent
kubectl get services
kubectl logs -f deployment/sql-agent
```

---

### Nginx (HTTPS —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—è)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `/etc/nginx/sites-available/sql-agent`:**

```nginx
# HTTP ‚Üí HTTPS redirect
server {
    listen 80;
    server_name sql-agent.yourdomain.com;
    return 301 https://$server_name$request_uri;
}

# HTTPS server
server {
    listen 443 ssl http2;
    server_name sql-agent.yourdomain.com;
    
    # SSL certificates (Let's Encrypt)
    ssl_certificate /etc/letsencrypt/live/sql-agent.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/sql-agent.yourdomain.com/privkey.pem;
    
    # SSL settings
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # Proxy to application
    location / {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeouts –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        proxy_read_timeout 300s;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
    }
    
    # Health check endpoint (–±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
    location /health {
        proxy_pass http://127.0.0.1:8001/health;
        access_log off;
    }
}
```

**–ê–∫—Ç–∏–≤–∞—Ü–∏—è:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–ª–∏–Ω–∫–∞
sudo ln -s /etc/nginx/sites-available/sql-agent /etc/nginx/sites-enabled/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
sudo systemctl reload nginx

# –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (Let's Encrypt)
sudo certbot --nginx -d sql-agent.yourdomain.com
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `logs/`  
**–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞:** `sql_agent_YYYYMMDD_HHMMSS.log`  
**–†–æ—Ç–∞—Ü–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–π —á–∞—Å

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
```bash
# –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/sql_agent_*.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
grep ERROR logs/sql_agent_$(date +%Y%m%d)_*.log

# –û—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –≤—Å–µ—Ö –∑–∞–¥–∞—á
grep "–ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞" logs/sql_agent_*.log

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
tail -100 logs/sql_agent_*.log
```

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
- `INFO` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `WARNING` ‚Äî –ø—Ä–æ–±–ª–µ–º—ã —Å –ë–î (401, Connection refused), retry –ø–æ–ø—ã—Ç–∫–∏
- `ERROR` ‚Äî –æ—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ç–∞–π–º–∞—É—Ç—ã, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- `DEBUG` ‚Äî –¥–µ—Ç–∞–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ SQL, –ø—Ä–æ–º–ø—Ç—ã –∫ LLM

---

### –ò—Å—Ç–æ—Ä–∏—è –∑–∞–¥–∞—á

**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `task_logs/`  
**–§–æ—Ä–º–∞—Ç:** `{task_id}.json`

–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∑–∞–¥–∞—á–∏:
```json
{
  "task_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "timestamp": "2025-10-18T15:17:24.123456",
  "input": {
    "url": "jdbc:trino://localhost:8080?catalog=mydb",
    "ddl": [...],
    "queries": [...]
  },
  "output": {
    "ddl": [...],
    "migrations": [...],
    "queries": [...],
    "quality_score": 82
  },
  "error": null
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏
cat task_logs/a1b2c3d4-....json | jq '.output.quality_score'
# ‚Üí 82

# –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞ –≤—Å–µ—Ö –∑–∞–¥–∞—á
jq '.output.quality_score' task_logs/*.json | \
  awk '{sum+=$1; count++} END {print "–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞:", sum/count}'
# ‚Üí –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: 78.5

# –ó–∞–¥–∞—á–∏ —Å –Ω–∏–∑–∫–æ–π –æ—Ü–µ–Ω–∫–æ–π (< 60)
for f in task_logs/*.json; do
  score=$(jq '.output.quality_score' "$f")
  if [ "$score" -lt 60 ]; then
    echo "$f: $score"
  fi
done
```

**–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞:** –ó–∞–¥–∞—á–∏ —Å—Ç–∞—Ä—à–µ 72 —á–∞—Å–æ–≤ (DONE –∏–ª–∏ FAILED) —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–π —á–∞—Å.

---

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω"

**–û—à–∏–±–∫–∞:**
```
ValueError: API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ OPEN_ROUTER –≤ .env —Ñ–∞–π–ª–µ
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–∞
ls -la .env

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
cat .env | grep OPEN_ROUTER

# –°–æ–∑–¥–∞–Ω–∏–µ .env –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
echo "OPEN_ROUTER=your-api-key" > .env

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
python main.py
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: "Connection refused" –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ –ë–î

**–°–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö:**
```
‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î (Connection refused).
   –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü.
```

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É –±–µ–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ë–î.

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–µ DDL (—Ç–∏–ø—ã –∫–æ–ª–æ–Ω–æ–∫, –Ω–∞–∑–≤–∞–Ω–∏—è)
- –ü–∞—Ç—Ç–µ—Ä–Ω–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (WHERE, JOIN, GROUP BY)
- –≠–≤—Ä–∏—Å—Ç–∏–∫–∞—Ö (–¥–∞—Ç—ã ‚Üí –ø–∞—Ä—Ç–∏—Ü–∏–∏, ID ‚Üí –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è)

**–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ë–î:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ë–î: `telnet host port`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ JDBC URL –≤ –∑–∞–ø—Ä–æ—Å–µ
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ë–î –∑–∞–ø—É—â–µ–Ω–∞

---

### –ü—Ä–æ–±–ª–µ–º–∞: "–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞"

**–û—à–∏–±–∫–∞:**
```json
{
  "error": "Internal Server Error",
  "detail": "–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞. –ú–∞–∫—Å–∏–º—É–º 100 –∑–∞–¥–∞—á..."
}
```

**–†–µ—à–µ–Ω–∏–µ 1:** –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏
curl http://localhost:8001/metrics | jq '.queue'

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
watch -n 5 'curl -s http://localhost:8001/metrics | jq ".queue"'
```

**–†–µ—à–µ–Ω–∏–µ 2:** –£–≤–µ–ª–∏—á—å—Ç–µ —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `sql_agent/api.py`, —Å—Ç—Ä–æ–∫–∞ ~164:
```python
task_manager = SimpleTaskManager(
    max_queue_size=500,  # –ë—ã–ª–æ 100
    max_workers=10,
    task_timeout_minutes=15,
    ...
)
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å.

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–¥–∞—á–∞ –∑–∞—Å—Ç—Ä—è–ª–∞ –≤ "RUNNING"

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –¢–∞–π–º–∞—É—Ç (15 –º–∏–Ω—É—Ç) ‚Äî –∑–∞–¥–∞—á–∞ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–∞—è
2. LLM —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∑–∞–¥–∞—á–∏
grep "task_id: your-task-id" logs/sql_agent_*.log | tail -50

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ LLM
curl http://localhost:8000/v1/models  # –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ vLLM

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫
curl http://localhost:8001/metrics | jq '.tasks'
```

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞–∑–¥–µ–ª–∏—Ç–µ –±–æ–ª—å—à—É—é —Å—Ö–µ–º—É (40+ —Ç–∞–±–ª–∏—Ü) –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–Ω—å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ 10-15 —Ç–∞–±–ª–∏—Ü)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ vLLM —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ GPU

---

### –ü—Ä–æ–±–ª–µ–º–∞: –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü—Ä–æ—Ü–µ—Å—Å python –∏—Å–ø–æ–ª—å–∑—É–µ—Ç > 4GB RAM
- System OOM killer —É–±–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
top -p $(pgrep -f "python main.py")

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
ps aux | grep "python main.py" | grep -v grep
```

**–†–µ—à–µ–Ω–∏–µ:**

**–í–∞—Ä–∏–∞–Ω—Ç 1:** –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `sql_agent/api.py`:
```python
task_manager = SimpleTaskManager(
    max_workers=5,  # –ë—ã–ª–æ 10
    ...
)
```

**–í–∞—Ä–∏–∞–Ω—Ç 2:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ Docker
```bash
docker run --memory=2g --memory-swap=2g sql-agent:1.2.0
```

**–í–∞—Ä–∏–∞–Ω—Ç 3:** –£–≤–µ–ª–∏—á—å—Ç–µ RAM —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ swap

---

## ‚ùì FAQ

### –ü–æ—á–µ–º—É —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã, –∞ –Ω–µ –æ–¥–Ω–∞ "optimized"?

**–û—Ç–≤–µ—Ç:** –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –≥–∏–±–∫–æ—Å—Ç–∏.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Ä–∏—Å–∫–∞ –¥–ª—è production
- ‚úÖ **–û—Ç–∫–∞—Ç** ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
- ‚úÖ **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Å—Ä–∞–≤–Ω–∏—Ç—å 2-3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- ‚úÖ **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** ‚Äî –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É —á–∞—Å—Ç—è–º–∏ (10% ‚Üí 50% ‚Üí 100%)

**–ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è:**
```sql
-- –°—Ç–∞—Ä–∞—è —Å—Ö–µ–º–∞ (production)
SELECT * FROM mydb.public.orders WHERE ...

-- –ù–æ–≤–∞—è —Å—Ö–µ–º–∞ 1 (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
SELECT * FROM mydb.optimized_20241018_v1.orders WHERE ...

-- –ù–æ–≤–∞—è —Å—Ö–µ–º–∞ 2 (A/B —Ç–µ—Å—Ç —Å –¥—Ä—É–≥–∏–º–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏)
SELECT * FROM mydb.optimized_20241018_v2.orders WHERE ...
```

---

### –ß—Ç–æ –µ—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞?

**–û—Ç–≤–µ—Ç:** –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É –±–µ–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ë–î!

```
‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ë–î (401 Unauthorized).
   –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –±–∞–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å—Ö–µ–º—ã.
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–µ DDL (—Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫)
- –ü–∞—Ç—Ç–µ—Ä–Ω–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (WHERE, JOIN, GROUP BY, ORDER BY)
- –≠–≤—Ä–∏—Å—Ç–∏–∫–∞—Ö (–¥–∞—Ç–∞ ‚Üí –ø–∞—Ä—Ç–∏—Ü–∏—è, ID ‚Üí –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è)
- Best practices –¥–ª—è Trino/ICEBERG

---

### –ö–∞–∫ –¥–æ–ª–≥–æ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–¥–∞—á?

**–û—Ç–≤–µ—Ç:** 72 —á–∞—Å–∞ (3 –¥–Ω—è).

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–¥–∞—á–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º DONE –∏–ª–∏ FAILED –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ–π –æ—á–∏—Å—Ç–∫–∏.

**–î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ª–æ–∫–∞–ª—å–Ω–æ
curl "http://localhost:8001/getresult?task_id={id}" > results/my_optimization.json

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ task_logs
cp task_logs/{task_id}.json backups/
```

---

### –ú–æ–∂–Ω–æ –ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ë–î –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?

**–û—Ç–≤–µ—Ç:** –î–∞! –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –î–æ 100 –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –î–æ 10 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ (—Å–≤–æ—è —Å—Ö–µ–º–∞, —Å–≤–æ–∏ —Ä–µ—Å—É—Ä—Å—ã)

**–ü—Ä–∏–º–µ—Ä ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è 5 —Ä–∞–∑–Ω—ã—Ö –ë–î –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:**
```python
tasks = []
databases = [db1_schema, db2_schema, db3_schema, db4_schema, db5_schema]

for db_data in databases:
    response = requests.post("http://localhost:8001/new", json=db_data)
    tasks.append(response.json()["taskid"])

print(f"–ó–∞–ø—É—â–µ–Ω–æ {len(tasks)} –∑–∞–¥–∞—á –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ")
# –í—Å–µ 5 –∑–∞–¥–∞—á –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!
```

---

### –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ queryid?

**–û—Ç–≤–µ—Ç:** –î–∞, **–≤—Å–µ–≥–¥–∞ –∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π!**

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¢–ó. –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –õ–¶–¢ 2025 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç queryid –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```json
// –í—Ö–æ–¥–Ω–æ–π –∑–∞–ø—Ä–æ—Å
{
  "queryid": "0197a0b2-2284-7af8-9012-fcb21e1a9785",
  "query": "SELECT * FROM table WHERE ..."
}

// –í—ã—Ö–æ–¥–Ω–æ–π –∑–∞–ø—Ä–æ—Å (queryid –ò–î–ï–ù–¢–ò–ß–ï–ù!)
{
  "queryid": "0197a0b2-2284-7af8-9012-fcb21e1a9785",
  "query": "SELECT col1, col2 FROM optimized_table WHERE ... LIMIT 10000"
}
```

**–ë–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è queryid —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª—è—Ç—Å—è:**
```bash
pytest tests/test_api_structure.py::test_queryid_preservation
# FAILED - queryid –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω
```

---

### –û–±–ª–∞—á–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π vLLM ‚Äî —á—Ç–æ –≤—ã–±—Ä–∞—Ç—å?

| –§–∞–∫—Ç–æ—Ä | –û–±–ª–∞—á–Ω—ã–π | vLLM –Ω–∞ L4 | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|----------|------------|--------------|
| **Latency** | 200-500ms | **50-100ms** | vLLM –±—ã—Å—Ç—Ä–µ–µ –≤ 3-5x |
| **Throughput** | ~10 –∑–∞–¥–∞—á/–º–∏–Ω | **30-50 –∑–∞–¥–∞—á/–º–∏–Ω** | vLLM –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–µ–µ –≤ 3-5x |
| **–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å** | –î–∞–Ω–Ω—ã–µ –≤ –æ–±–ª–∞–∫–µ | **–í—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ** | vLLM –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç** | –¢—Ä–µ–±—É–µ—Ç—Å—è | –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è | vLLM —Ä–∞–±–æ—Ç–∞–µ—Ç offline |
| **–ù–∞—Å—Ç—Ä–æ–π–∫–∞** | 5 –º–∏–Ω—É—Ç | 1-2 —á–∞—Å–∞ | –û–±–ª–∞–∫–æ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—á–∞—Ç—å |
| **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** | 99.9% uptime | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ñ—Ä—ã | –û–±–ª–∞–∫–æ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- **–ü—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí –æ–±–ª–∞—á–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä (–±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç)
- **Production —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π** (50+ –∑–∞–¥–∞—á/—á–∞—Å) ‚Üí vLLM
- **–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–±–∞–Ω–∫–∏, –º–µ–¥–∏—Ü–∏–Ω–∞) ‚Üí **—Ç–æ–ª—å–∫–æ vLLM**
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –±—é–¥–∂–µ—Ç** ‚Üí –æ–±–ª–∞—á–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä (pay-as-you-go)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö 19 —Ç–µ—Å—Ç–æ–≤
pytest tests/ -v

# –†–µ–∑—É–ª—å—Ç–∞—Ç: ==================== 19 passed in 2.5 minutes ====================
```

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:**
- ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ API –æ—Ç–≤–µ—Ç–æ–≤** ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó –õ–¶–¢ 2025
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** ‚Äî Pydantic –º–æ–¥–µ–ª–∏
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî 400, 404, 500 –∫–æ–¥—ã
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ queryid** ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¢–ó
- ‚úÖ **–ü–æ–ª–Ω—ã–µ –ø—É—Ç–∏** ‚Äî `catalog.schema.table` –≤–µ–∑–¥–µ
- ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π** ‚Äî `quality_score`, `_meta`
- ‚úÖ **–ü–µ—Ä–≤–∞—è DDL –∫–æ–º–∞–Ω–¥–∞** ‚Äî CREATE SCHEMA
- ‚úÖ **Global exception handler** ‚Äî –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

**–ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:**
```bash
pytest tests/test_api_structure.py::TestAPIStructure::test_queryid_preservation -v
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ LLM (—Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ API):**
```bash
pytest tests/ -v -k "not slow"
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

| –°—Ö–µ–º–∞ | –¢–∞–±–ª–∏—Ü—ã | –ó–∞–ø—Ä–æ—Å—ã | –û–±–ª–∞—á–Ω—ã–π LLM | vLLM –Ω–∞ L4 | –£—Å–∫–æ—Ä–µ–Ω–∏–µ |
|-------|---------|---------|--------------|------------|-----------|
| **–ü—Ä–æ—Å—Ç–∞—è** | 1-5 | <10 | 30-60 —Å–µ–∫ | **20-40 —Å–µ–∫** | 1.5-2x |
| **–°—Ä–µ–¥–Ω—è—è** | 10-20 | 10-20 | 1-2 –º–∏–Ω | **45-90 —Å–µ–∫** | 1.5-2x |
| **–°–ª–æ–∂–Ω–∞—è** | 40+ | 20+ | 3-4 –º–∏–Ω | **2-3 –º–∏–Ω** | 1.5x |

**–§–∞–∫—Ç–æ—Ä—ã, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –≤—Ä–µ–º—è:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü (–∫–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–∞—Ä—Å–∏–Ω–≥, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ë–î (—Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ 10-20%)
- Retry –ø–æ–ø—ã—Ç–∫–∏ LLM (–ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º JSON)

### –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –ó–∞–¥–∞—á/–º–∏–Ω—É—Ç—É | –ó–∞–¥–∞—á/—á–∞—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|--------------|--------------|-----------|------------|
| –û–±–ª–∞—á–Ω—ã–π LLM | ~10 | ~600 | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ latency –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ |
| vLLM –Ω–∞ L4 | **30-50** | **1800-3000** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ GPU throughput |
| vLLM –Ω–∞ L40S | **50-80** | **3000-4800** | –î–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ |

---

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è

**üé® Frontend:**
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] Dashboard —Å –∏—Å—Ç–æ—Ä–∏–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π (–¥–æ/–ø–æ—Å–ª–µ)

**üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ClickHouse, BigQuery, Snowflake
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è EXPLAIN ANALYZE –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- [ ] Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á

**‚ö° –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

**üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [ ] –ë–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–Ω–¥—É—Å—Ç—Ä–∏–π
- [ ] –í–∏–¥–µ–æ-—Ç—É—Ç–æ—Ä–∏–∞–ª—ã
- [ ] –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ö–∞–∫ –Ω–∞—á–∞—Ç—å –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–∏—Ç—å

```bash
# 1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ GitHub

# 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
git clone https://github.com/your-username/sql-agent.git
cd sql-agent

# 3. –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
git checkout -b feature/your-feature-name

# 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 5. –í–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
pytest tests/ -v

# 6. –ö–æ–º–º–∏—Ç –∏ push
git add .
git commit -m "feat: –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–π —Ñ–∏—á–∏"
git push origin feature/your-feature-name

# 7. –°–æ–∑–¥–∞–Ω–∏–µ Pull Request –Ω–∞ GitHub
```

---

## üèÜ –û –ø—Ä–æ–µ–∫—Ç–µ

### –ò—Å—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è **–õ–¶–¢ 2025** (–õ–∏–¥–µ—Ä—ã –¶–∏—Ñ—Ä–æ–≤–æ–π –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏) ‚Äî –≤—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –∫–æ–Ω–∫—É—Ä—Å–∞ IT-—Ä–µ—à–µ–Ω–∏–π.

**–ó–∞–¥–∞—á–∞ –∫–æ–Ω–∫—É—Ä—Å–∞:** –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Data Lakehouse

**–ú–æ—Ç–∏–≤–∞—Ü–∏—è:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î ‚Äî —ç—Ç–æ "—á–µ—Ä–Ω–∞—è –º–∞–≥–∏—è", –¥–æ—Å—Ç—É–ø–Ω–∞—è —Ç–æ–ª—å–∫–æ senior DBA —Å –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º. –ú—ã –¥–µ–º–æ–∫—Ä–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–ª–∏ —ç—Ç—É —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É —Å –ø–æ–º–æ—â—å—é AI, —Å–¥–µ–ª–∞–≤ –µ—ë –¥–æ—Å—Ç—É–ø–Ω–æ–π –ª—é–±–æ–º—É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.

**–§–∏–ª–æ—Å–æ—Ñ–∏—è –ø—Ä–æ–µ–∫—Ç–∞:**
- üéØ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã** ‚Äî AI –¥–µ–ª–∞–µ—Ç —Ç–æ, —á—Ç–æ —Ä–∞–Ω—å—à–µ —Ç—Ä–µ–±–æ–≤–∞–ª–æ years of experience
- üîì **–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å** ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏
- üöÄ **–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å** ‚Äî production-ready —Ä–µ—à–µ–Ω–∏–µ, –∞ –Ω–µ proof-of-concept
- üñ•Ô∏è **–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ GPU –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–±–ª–∞–∫–æ

---

## üìã –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –¢–ó –õ–¶–¢ 2025

### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|------------|--------|------------|
| **REST API** —Å 3 endpoints | ‚úÖ | POST /new, GET /status, GET /getresult |
| **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** | ‚úÖ | –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á, –¥–æ 10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ |
| **–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞** (url, ddl, queries) | ‚úÖ | –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic |
| **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞** (ddl, migrations, queries) | ‚úÖ | –¢–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| **–¢–∞–π–º–∞—É—Ç 15 –º–∏–Ω—É—Ç** | ‚úÖ | –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ task_manager (—Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó) |
| **–°—Ç–∞—Ç—É—Å—ã** (RUNNING, DONE, FAILED) | ‚úÖ | –í—Å–µ 3 —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã |

### ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ –¢–ó

**1. –ü–æ–ª–Ω—ã–µ –ø—É—Ç–∏ –∫ —Ç–∞–±–ª–∏—Ü–∞–º** ‚ö†Ô∏è **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û**

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã **–æ–±—è–∑–∞–Ω—ã** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç `catalog.schema.table`:
```sql
-- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (–ø—Ä–æ–π–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É)
CREATE TABLE mydb.optimized_schema.users (...)
INSERT INTO mydb.optimized_schema.users SELECT * FROM mydb.public.users
SELECT * FROM mydb.optimized_schema.users WHERE ...

-- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–ø—Ä–æ–≤–∞–ª–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –õ–¶–¢ 2025)
CREATE TABLE users (...)
INSERT INTO users SELECT * FROM public.users
SELECT * FROM users WHERE ...
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:** –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –õ–¶–¢ 2025 –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ Trino. –ë–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π ‚Üí –±–∞–ª–ª = 0.

---

**2. –ü–µ—Ä–≤–∞—è DDL –∫–æ–º–∞–Ω–¥–∞ ‚Äî CREATE SCHEMA** ‚ö†Ô∏è **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û**

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É:
```sql
-- –í—Å–µ–≥–¥–∞ –ø–µ—Ä–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –≤ –º–∞—Å—Å–∏–≤–µ ddl[]
CREATE SCHEMA catalog.optimized_20241018151234_a3f2b1
```

**–§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ —Å—Ö–µ–º—ã:**
- `optimized_` ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å
- `20241018151234` ‚Äî timestamp (–¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏)
- `_a3f2b1` ‚Äî hash –æ—Ç –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏)

---

**3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ queryid** ‚ö†Ô∏è **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û**

–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ queryid **–æ–±—è–∑–∞–Ω—ã** —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö:

```json
// –í—Ö–æ–¥–Ω–æ–π –∑–∞–ø—Ä–æ—Å
{
  "queryid": "0197a0b2-2284-7af8-9012-fcb21e1a9785",
  "query": "SELECT * FROM mydb.public.users WHERE created_at > '2024-01-01'",
  "runquantity": 500
}

// –í—ã—Ö–æ–¥–Ω–æ–π –∑–∞–ø—Ä–æ—Å (queryid –ò–î–ï–ù–¢–ò–ß–ï–ù!)
{
  "queryid": "0197a0b2-2284-7af8-9012-fcb21e1a9785",
  "query": "SELECT id, name, created_at FROM mydb.optimized_schema.users WHERE created_at >= DATE '2024-01-01' LIMIT 10000"
}
```

**–ü–æ—á–µ–º—É –∫—Ä–∏—Ç–∏—á–Ω–æ:** –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –õ–¶–¢ 2025 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç queryid –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –ë–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è queryid –∑–∞–ø—Ä–æ—Å –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω ‚Üí –ø–æ—Ç–µ—Ä—è –±–∞–ª–ª–æ–≤.

---

### ‚úÖ –ó–∞–ø—Ä–µ—Ç—ã (—Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó)

| –ó–∞–ø—Ä–µ—Ç | –ü—Ä–∏—á–∏–Ω–∞ | –°–æ–±–ª—é–¥–µ–Ω–∏–µ |
|--------|---------|------------|
| ‚ùå **MATERIALIZED VIEW** | Trino –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç | ‚úÖ –ù–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è |
| ‚ùå **CREATE USER** | –õ—é–±–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞ | ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç |
| ‚ùå **CREATE ROLE** | –õ—é–±–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞ | ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç |
| ‚ùå **GRANT/REVOKE** | –õ—é–±–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞ | ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç |

**–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è ‚Üí –∑–∞–¥–∞—á–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å FAILED.

---

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¢–ó

| –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|--------------|--------|--------|
| **Unit-—Ç–µ—Å—Ç—ã** | ‚úÖ | 19/19 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ |
| **LLM –Ω–∞ Nvidia L4** | ‚úÖ | –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ vLLM |
| **Online –º–æ–¥–µ–ª–∏** | ‚úÖ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–ª–∞—á–Ω—ã—Ö LLM –¥–ª—è –æ—Ç–±–æ—Ä–æ—á–Ω–æ–≥–æ —ç—Ç–∞–ø–∞ |

---

### üìä –¶–µ–ª–µ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ (–∏–∑ –¢–ó)

**–ö–ª–∞—Å—Ç–µ—Ä Trino –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä:** 1 —É–∑–µ–ª, 4 CPU, 16GB RAM
- **Workers:** 3 —É–∑–ª–∞, 4 CPU, 16GB RAM –∫–∞–∂–¥—ã–π
- **JVM Heap:** 14GB –Ω–∞ coordinator, 14GB –Ω–∞ –∫–∞–∂–¥—ã–π worker
- **query.maxMemory:** 32GB (–æ–±—â–∏–π –ª–∏–º–∏—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å)
- **query.maxMemoryPerNode:** 7GB (–ª–∏–º–∏—Ç –Ω–∞ —É–∑–µ–ª)

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç —ç—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Å–Ω–∏–∂–µ–Ω–∏–µ scan volume (–º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏ –Ω–∞ scan)
- **–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è** ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ JOIN (–º–µ–Ω—å—à–µ shuffle –æ–ø–µ—Ä–∞—Ü–∏–π)
- **ICEBERG —Ñ–æ—Ä–º–∞—Ç** ‚Äî –Ω–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º Trino
- **–ö–æ–º–ø—Ä–µ—Å—Å–∏—è ZSTD** ‚Äî —ç–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ –∏ I/O

---

### üéØ –§–æ—Ä–º—É–ª—ã –æ—Ü–µ–Ω–∫–∏ (–∏–∑ –¢–ó –õ–¶–¢ 2025)

**–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–≤–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è:**

**1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
```
Œît = Œ£(A - T) √ó Q / Œ£(A √ó Q)

–≥–¥–µ:
A ‚Äî –∏—Å—Ö–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (—Å–µ–∫)
T ‚Äî –≤—Ä–µ–º—è –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Å–µ–∫)
Q ‚Äî —á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (runquantity)
n ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
```

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞:**
```
–ó–∞–ø—Ä–æ—Å 1: A=12—Å–µ–∫, T=2—Å–µ–∫, Q=500 ‚Üí (12-2)√ó500 = 5000
–ó–∞–ø—Ä–æ—Å 2: A=8—Å–µ–∫, T=1—Å–µ–∫, Q=200 ‚Üí (8-1)√ó200 = 1400

–°—É–º–º–∞ —É–ª—É—á—à–µ–Ω–∏–π: 5000 + 1400 = 6400
–°—É–º–º–∞ –±–∞–∑–æ–≤–∞—è: 12√ó500 + 8√ó200 = 7600

Œît = 6400 / 7600 = 0.842 (84.2% —É–ª—É—á—à–µ–Ω–∏–µ!)
```

**2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö:**
```
Œîs = (S - C) / S

–≥–¥–µ:
S ‚Äî –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö –¥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (bytes)
C ‚Äî –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (bytes)
```

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞:**
```
–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: S = 1000 GB
–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (ZSTD): C = 350 GB

Œîs = (1000 - 350) / 1000 = 0.65 (65% —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞!)
```

**3. –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞:**
```
R = Œît + Œîs

–≥–¥–µ R ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–ª –∫–æ–º–∞–Ω–¥—ã
```

**SQL-agent –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –û–ë–ê –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:**
- ‚ö° –í—Ä–µ–º—è (—á–µ—Ä–µ–∑ –ø–∞—Ä—Ç–∏—Ü–∏–∏, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤)
- üíæ –ú–µ—Å—Ç–æ (—á–µ—Ä–µ–∑ –∫–æ–º–ø—Ä–µ—Å—Å–∏—é ZSTD, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ)

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

**MIT License** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –∏ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.

```
Copyright (c) 2025 SQL-agent Team

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
```

---

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- **Nvidia** ‚Äî –∑–∞ –º–æ–¥–µ–ª—å nemotron-nano-9b-v2 –¥–ª—è SQL –∞–Ω–∞–ª–∏–∑–∞
- **Google** ‚Äî –∑–∞ –º–æ–¥–µ–ª—å Gemini –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
- **vLLM Team** ‚Äî –∑–∞ –æ—Ç–ª–∏—á–Ω—ã–π inference engine
- **FastAPI** ‚Äî –∑–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –±—ã—Å—Ç—Ä—ã–π web framework
- **SQLglot** ‚Äî –∑–∞ –º–æ—â–Ω—ã–π SQL –ø–∞—Ä—Å–µ—Ä
- **–°–æ–æ–±—â–µ—Å—Ç–≤–æ –õ–¶–¢ 2025** ‚Äî –∑–∞ –º–æ—Ç–∏–≤–∞—Ü–∏—é –∏ —Ñ–∏–¥–±–µ–∫

---

<div align="center">

### üöÄ –ì–æ—Ç–æ–≤—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å?

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–æ–±–ª–∞—á–Ω—ã–π LLM)**
```bash
pip install -r requirements.txt
echo "OPEN_ROUTER=your-api-key" > .env
python main.py
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ GPU**
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: vLLM —Å–µ—Ä–≤–µ—Ä
python -m vllm.entrypoints.openai.api_server \
  --model nvidia/nemotron-nano-9b-v2 \
  --port 8000

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: SQL-agent
export OPENAI_API_BASE=http://localhost:8000/v1
export OPENAI_API_KEY=EMPTY
python main.py
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
curl http://localhost:8001/health
curl -X POST http://localhost:8001/new -d @datasets/linear_schema.json
```

---

**[‚≠ê Star –Ω–∞ GitHub](../../stargazers)** ‚Ä¢ **[üêõ Issues](../../issues)** ‚Ä¢ **[üí¨ Discussions](../../discussions)**

–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è **–õ–¶–¢ 2025**

**–í–µ—Ä—Å–∏—è:** 1.2.0 | **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 18.10.2025 | **–ö–æ–¥:** ~3800 —Å—Ç—Ä–æ–∫ | **–¢–µ—Å—Ç—ã:** 19/19 ‚úÖ

</div>
